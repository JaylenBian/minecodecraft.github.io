<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[KickStart 2018 Round Hé¢˜è§£]]></title>
    <url>%2F2019%2F11%2F22%2FKickStart%202019%20Round%20H%E9%A2%98%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[H-index é¢˜ç›®é“¾æŽ¥ é¢˜ç›®å¤§æ„è®¡ç®—å­¦æœ¯HæŒ‡æ•°ã€‚å¦‚æžœä¸€ä¸ªäººæœ‰xç¯‡è®ºæ–‡å„è‡ªè¢«å¼•ç”¨è‡³å°‘xæ¬¡ï¼Œé‚£ä¹ˆæœ€å¤§å¯èƒ½çš„xå³ä¸ºå®ƒçš„HæŒ‡æ•°ã€‚ æ€è·¯ä¼˜åŒ–æ±‚hæŒ‡æ•°è¿‡ç¨‹ï¼Œæœ€åˆintuitive solutionåªæƒ³åˆ°äº†äºŒåˆ†æŸ¥æ‰¾åˆé€‚çš„xï¼Œè€Œæ±‚è§£xçš„è¿‡ç¨‹å¹¶æ²¡æœ‰ä¼˜åŒ–ã€‚å®žé™…å¾ˆç®€å•ï¼šé€šè¿‡æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å¤§äºŽxçš„æ€»æ•°ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;vector&gt;#include &lt;iostream&gt;using namespace std;int N, M, tmp;int MAXN = 1e5+10;vector&lt;int&gt; a (MAXN+1);void update(int data, int idx) &#123; while (idx &lt;= MAXN) &#123; a[idx] += data; idx += -idx &amp; idx; &#125;&#125;int query(int idx) &#123; int res = 0; while (idx) &#123; res += a[idx]; idx -= -idx &amp; idx; &#125; return res;&#125;int bisearch(int idx) &#123; int l = 0, r = MAXN-1; while (l &lt; r) &#123; int mid = l + (r-l) / 2, cnt = idx + 1 - query(mid-1); if (cnt &gt;= mid) l = mid + 1; else r = mid; &#125; return l-1;&#125;int main(int argc, const char * argv[]) &#123; cin &gt;&gt; N; for (int kase = 1; kase &lt;= N; ++kase) &#123; cin &gt;&gt; M; cout &lt;&lt; "Case #" &lt;&lt; kase &lt;&lt; ":"; fill(begin(a), end(a), 0); for (int i = 0; i &lt; M; ++i) &#123; cin &gt;&gt; tmp; update(1, tmp); cout &lt;&lt; " " &lt;&lt; bisearch(i); &#125; cout &lt;&lt; endl; &#125; return 0;&#125; Diagonal Puzzle é¢˜ç›®é“¾æŽ¥ é¢˜ç›®å¤§æ„ç¿»ç‰Œæ¸¸æˆï¼Œæ¯æ¬¡ç¿»ä¸€ä¸ªæ–œçº¿ï¼Œæ±‚æœ€å°‘ç»è¿‡å¤šå°‘æ­¥å¯ä»¥æŠŠæ£‹ç›˜é‡Œçš„æ ¼å­ç¿»ä¸ºé»‘è‰²ã€‚ æ€è·¯æ„Ÿè§‰è¿™é“é¢˜æ¯”è¾ƒéš¾ï¼Œä¸€é“DFSé¢˜ç›®ï¼Œä½†éœ€è¦ä¸€äº›æ•°æ®é¢„å¤„ç†ï¼š æŠŠæ¯ä¸ªæ ¼å­æ‰€å¤„çš„æ­£åæ–œçº¿æ ‡å·ï¼Œä½¿å¾—æ¯æ¡æ–œçº¿ä¸Šçš„æ ¼å­ç¼–å·ä¸€è‡´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºŽn=3çš„æƒ…å†µï¼Œæœ‰æ­¤ç¼–å·ï¼š ç”±ä¸Šå›¾ä¸éš¾çœ‹å‡ºï¼Œæ¯ä¸ªæ ¼å­éƒ½æ˜¯æ­£åæ–œçº¿çš„ç„¦ç‚¹ï¼Œæ•…ç”¨æ•°ç»„Gç»´æŠ¤å…¶ç›¸äº¤çº¿çš„ç¼–å·åŠç„¦ç‚¹æ˜¯å¦ä¸ºé»‘è‰²ã€‚ DFSæ¯ä¸ªç„¦ç‚¹ï¼Œå†³å®šæ˜¯å¦ç¿»å½“å‰è¿™ä¸ªæ–œçº¿çš„ç‰Œã€‚ç”±äºŽä¸€å®šæœ‰è§£ï¼Œä¸”æ•´ä¸ªDFSçš„ç­–ç•¥åªä¸Žæ˜¯å¦ç¿»ç¬¬ä¸€ä¸ªç‰Œæœ‰å…³ï¼Œæ•…æˆ‘ä»¬ç”¨cntæ•°ç»„è®°å½• æ‰€åˆ°äº¤ç‚¹çš„ç¿»/ä¸ç¿»çš„æ¬¡æ•°ï¼Œä¸¤è€…äº¤æ¢å³ä¸ºå¦ä¸€ç§æƒ…å†µï¼ˆå³æ˜¯å¦ç¿»ç¬¬ä¸€ä¸ªç‰Œï¼‰ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#include &lt;vector&gt;#include &lt;iostream&gt;#include &lt;algorithm&gt;using namespace std;int T, N;const int MAXN = 500;vector&lt;string&gt; mat (101, "");vector&lt;bool&gt; vis (MAXN, false);vector&lt;vector&lt;pair&lt;int, bool&gt;&gt;&gt; G (MAXN, vector&lt;pair&lt;int, bool&gt;&gt; ());vector&lt;int&gt; cnt (2, 0); // 0: step for not change, 1: step for changevoid dfs(int idx, bool changed) &#123; vis[idx] = true; cnt[changed]++; for (auto&amp; pir: G[idx]) &#123; if (!vis[pir.first]) dfs(pir.first, pir.second ^ changed); &#125;&#125;int main(int argc, const char * argv[]) &#123; cin &gt;&gt; T; for (int kase = 1; kase &lt;= T; ++kase) &#123; cin &gt;&gt; N; for (int i = 0; i &lt; N; ++i) cin &gt;&gt; mat[i]; for_each(G.begin(), G.end(), [](auto&amp; pirs) &#123; pirs.clear(); &#125;); fill(vis.begin(), vis.end(), false); for (int i = 0; i &lt; N; ++i) &#123; for (int j = 0; j &lt; N; ++j) &#123; int lidx = i + j, ridx = N + (N+i-1) + (N-j-1); G[lidx].emplace_back(ridx, mat[i][j] == '.'); G[ridx].emplace_back(lidx, mat[i][j] == '.'); &#125; &#125; int pircnt = 2 * (2 * N - 1), res = 0; for (int i = 0; i &lt; pircnt; ++i) &#123; if (!vis[i]) &#123; cnt[0] = cnt[1] = 0; dfs(i, false); res += min(cnt[0], cnt[1]); &#125; &#125; cout &lt;&lt; "Case #" &lt;&lt; kase &lt;&lt; ": " &lt;&lt; res &lt;&lt; endl; &#125; return 0;&#125; Elevanagram é¢˜ç›®é“¾æŽ¥ é¢˜ç›®å¤§æ„ç»™ä½ è‹¥å¹²ä¸ª0~9çš„æ•°å­—ï¼Œæ¯ä¸ªæ•°å­—æ•°é‡ä¸º Ai, iâˆˆ[0,9]ã€‚è®©ä½ æŽ’åˆ—è¿™äº›æ•°å­—ï¼Œä½¿å…¶æŒ‰a+b-c+d-e+â€¦è¿™æ ·çš„åŠ å‡äº¤æ›¿å¾—å‡ºçš„æœ€ç»ˆè§£ä¸º11çš„å€æ•°ã€‚ æ€è·¯è¿™é“é¢˜ç›¸å¯¹ç¬¬äºŒé¢˜ç®€å•äº›ï¼Œå¯ä»¥é€šè¿‡dpè§£å†³ï¼Œä½†éœ€è¦æ»šåŠ¨æ•°ç»„é™ç»´ã€‚dp[type][j][k]ä»£è¡¨å¯¹äºŽå½“å‰æ•°å­—iï¼Œå¯¹jä¸ªæ‰§è¡ŒåŠ æ³•ã€å¯¹A[i]-jä¸ªæ‰§è¡Œå‡æ³•æ—¶ï¼Œæ˜¯å¦å­˜åœ¨mod 11åŽç»“æžœä¸ºkçš„æƒ…å†µã€‚ç”±äºŽæœ€ç»ˆä¼šæœ‰ æ€»æ•°/2 ä¸ªæ‰§è¡ŒåŠ æ³•çš„ï¼Œæ•…dp[type][sum/2][0]å³ä¸ºåˆ’åˆ†ä¸€åŠçš„æ•°æ‰§è¡ŒåŠ æ³•ã€å¦ä¸€åŠæ‰§è¡Œå‡æ³•åŽï¼Œmod 11ä¸º0çš„æƒ…å†µæ˜¯å¦å­˜åœ¨ï¼Œå³ä¸ºé¢˜è§£ã€‚ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#include &lt;vector&gt;#include &lt;iostream&gt;#include &lt;algorithm&gt;using namespace std;int T;const int MAXN = 1000;vector&lt;int&gt; A (10, 0);vector&lt;vector&lt;vector&lt;bool&gt;&gt;&gt; dp;int main(int argc, const char * argv[]) &#123; cin &gt;&gt; T; for (int kase = 1; kase &lt;= T; ++kase) &#123; cout &lt;&lt; "Case #" &lt;&lt; kase &lt;&lt; ": "; int tot = 0; for (int i = 1; i &lt;= 9; ++i) &#123; cin &gt;&gt; A[i]; // if large than 21/22, the overflow value is no need to be calculate A[i] = min(A[i], 20 + (A[i] &amp; 1)); tot += A[i]; &#125; dp = vector&lt;vector&lt;vector&lt;bool&gt;&gt;&gt; (2, vector&lt;vector&lt;bool&gt;&gt; (MAXN+10, vector&lt;bool&gt; (11, false))); int type = 0; dp[type][0][0] = true; for (int i = 1; i &lt;= 9; ++i) &#123; type = 1-type; for (auto&amp; subarr: dp[type]) fill(subarr.begin(), subarr.end(), false); for (int lcnt = 0; lcnt &lt;= A[i]; ++lcnt) &#123; for (int rcnt = 0; rcnt &lt; MAXN-lcnt; ++rcnt) &#123; for (int premod = 0; premod &lt;= 10; ++premod) &#123; int curmod = (premod + lcnt * i - (A[i]-lcnt) * i + 11) % 11; while (curmod &lt; 0) curmod += 11; dp[type][lcnt + rcnt][curmod] = dp[1-type][rcnt][premod] || dp[type][lcnt + rcnt][curmod]; &#125; &#125; &#125; &#125; cout &lt;&lt; (dp[type][tot &gt;&gt; 1][0] ? "YES" : "NO") &lt;&lt; endl;; &#125; return 0;&#125;]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>KickStart</tag>
        <tag>åˆ·é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KickStart 2018 Round Aé¢˜è§£]]></title>
    <url>%2F2018%2F08%2F10%2FKickStart%202018%20Round%20A%E9%A2%98%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[Even Digits é¢˜ç›®é“¾æŽ¥ é¢˜ç›®å¤§æ„ç»™å®šä¸€ä¸ªæ•°å­—nï¼Œæ‰¾åˆ°ç›¸é‚»æœ€è¿‘çš„æ‰€æœ‰å…ƒç´ ç”±å¶æ•°æž„æˆçš„æ•°å­—ï¼Œå¦‚22099ï¼Œåˆ™ä¸º22088ã€‚ æ€è·¯é¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ•°aåŠä¸€ä¸ªæ¯”å®ƒå°çš„æ•°bï¼Œæ¯”è¾ƒå·®å€¼å³å¯ã€‚å…¶ä¸­ï¼Œbå¯ä»¥é€šè¿‡æ‰¾åˆ°æœ€é«˜å…ƒç´ ä¸ºå¥‡æ•°çš„ä½ï¼Œå°†å…¶å‡1ï¼Œå¹¶å°†ä¹‹åŽæ‰€æœ‰ä½Žä½å…¨éƒ¨èµ‹å€¼ä¸º8å®Œæˆã€‚aåˆ™å¯ä»¥é€šè¿‡æ‰¾åˆ°æœ€é«˜å…ƒç´ ä¸ºå¥‡æ•°çš„ä½ï¼Œå°†å…¶åŠ 1ï¼Œå¹¶å°†ä¹‹åŽæ‰€æœ‰ä½Žä½å…¨éƒ¨èµ‹å€¼ä¸º0å®Œæˆï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„è¿›ä½ã€‚æ±‚è§£açš„è¿‡ç¨‹æœ‰ä¸€ä¸ªä¼˜åŒ–ç‚¹ï¼šå¦‚æžœéœ€è¦è¿›ä½ï¼ˆé¦–ä¸ªå¥‡æ•°ä½æ˜¯9ï¼‰ï¼Œ(a-n) ä¸€å®šå¤§äºŽ (n-b)ã€‚å› ä¸ºå¯¹äºŽé¦–å­—æ¯ä¸º9çš„kä½æ•°ï¼Œ(a-n)ä¸€å®šå¤§äºŽ(10^k+1)ï¼Œè€Œ(n-b)åˆ™ä¸ä¼šå¤§äºŽ(10^k+1)ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980#include &lt;cstdio&gt;#include &lt;string&gt;#include &lt;cstring&gt;#include &lt;iostream&gt;#define ull unsigned long longusing namespace std;const int MAXN = 20;ull toNumber(char *str) &#123; ull res = 0; for (int i = strlen(str)-1; i &gt;= 0; --i) &#123; res = res * 10 + (str[i] - '0'); &#125; return res;&#125;char * toStr(ull n) &#123; char *str = new char[MAXN]; for (int i = 0; i &lt; MAXN; ++i) str[i] = '0'; int len = 0; while (n != 0) &#123; str[len++] = (n % 10) + '0'; n /= 10; &#125; str[len] = '\0'; return str;&#125;char * getLower(char *num) &#123; int len = strlen(num) - 1; for (; len &gt;= 0; --len) &#123; if ((num[len] - '0') &amp; 1) &#123; num[len--]--; break; &#125; &#125; while (len &gt;= 0) num[len--] = '8'; return num;&#125;char *getUpper(char *num) &#123; // æœ‰ä¼˜åŒ–ç‚¹ï¼Œé¦–ä½ä¸º9æ—¶å¯ä»¥ç›´æŽ¥è¿”å›žINT_MAX int p = strlen(num) - 1; for (; p &gt;= 0; --p) &#123; if ((num[p] - '0') &amp; 1) &#123; for (int i = 0; i &lt; p; ++i) num[i] = '0'; if (num[p] == '9') &#123; num[p]++; num[p+1]++; num[p+2] = '\0'; return getUpper(num); &#125; num[p]++; break; &#125; &#125; return num;&#125;ull solve(ull n) &#123; ull a = toNumber(getLower(toStr(n))); ull b = toNumber(getUpper(toStr(n))); return min(n-a, b-n);&#125;int main(int argc, const char * argv[]) &#123; int T; ull n; scanf("%d", &amp;T); for (int kase = 1; kase &lt;= T; ++kase) &#123; scanf("%ld", &amp;n); printf("Case #%d: %llu\n", kase, solve(n)); &#125; return 0;&#125; Lucky Dip é¢˜ç›®é“¾æŽ¥ é¢˜ç›®å¤§æ„è¢‹å­ä¸­æœ‰Nä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“å€¼Viå…ƒï¼ŒçŽ°åœ¨é€‰æ‰‹ä»Žä¸­å–ä¸€ä¸ªç‰©å“ï¼Œå…±æœ‰kæ¬¡æ”¾å›žæœºä¼šã€‚å°½å¯èƒ½å–å‡ºå•†å“ä»·å€¼æœ€å¤§ï¼Œæ±‚è¯¥æ•°å­¦æœŸæœ›ã€‚ æ€è·¯è€ƒè™‘ä¸€ç§æ”¾å›žç­–ç•¥ï¼Œä½¿å¾—ç‰©å“ä»·å€¼çš„æœŸæœ›æœ€å¤§ï¼Œåˆ™å¯ä»¥è€ƒè™‘å¦‚ä¸‹æ–¹æ¡ˆï¼šå½“æœ¬æ¬¡å–å‡ºå•†å“ä»·å€¼å¤§äºŽä¹‹å‰å‡ æ¬¡æœŸæœ›æ—¶ï¼Œä¿ç•™ï¼Œå¦åˆ™æ”¾å›žé‡æ–°å–ã€‚å³Kæ¬¡å¾ªçŽ¯ï¼Œæ¯æ¬¡å°†å•†å“ä»·æ ¼æŽ’åºåŽï¼Œä¾æ®ä¸Šæ¬¡çš„æ•°å­¦æœŸæœ›åˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä»·æ ¼ä½ŽäºŽæœŸæœ›çš„ä½¿ç”¨æœŸæœ›ä»·æ ¼ï¼ˆæ”¾å›žï¼‰ï¼Œé«˜äºŽçš„éƒ¨åˆ†ç”¨äºŽæ›´æ–°æœ¬æ¬¡æœŸæœ›ï¼ˆä¿ç•™ï¼‰ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šexp[i] = (smaller_count * exp[i-1] + sum_of_larger) / N;é¢„å…ˆæŽ’åºä¾¿äºŽäºŒåˆ†ï¼Œå¹¶è®¡ç®—å‰ç¼€å’Œã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940#include &lt;cstdio&gt;#include &lt;cmath&gt;#include &lt;iostream&gt;#include &lt;algorithm&gt;#define ll long longusing namespace std;const int MAXN = 2e4+10;int V[MAXN];double solve(int N, int K) &#123; sort(V, V+N); ll *sum = new ll[N+1]; sum[N] = 0; for (int i = N-1; i &gt;= 0; --i) sum[i] = sum[i+1] + V[i]; double *exp = new double[K+1]; exp[0] = (double) sum[0] / N; for (int i = 1; i &lt;= K; ++i) &#123; int larger = upper_bound(V, V+N, exp[i-1]) - V; exp[i] = (larger * exp[i-1] + sum[larger]) / N; &#125; return exp[K];&#125;int main(int argc, const char * argv[]) &#123; int T, N, K; scanf("%d", &amp;T); for (int kase = 1; kase &lt;= T; ++kase) &#123; scanf("%d %d", &amp;N, &amp;K); for (int i = 0; i &lt; N; ++i) &#123; scanf("%d", &amp;V[i]); &#125; printf("Case #%d: %.6lf\n", kase, solve(N, K)); &#125; return 0;&#125; Scrambled Words é¢˜ç›®é“¾æŽ¥ é¢˜ç›®å¤§æ„ç ”è¡¨ç©¶æ˜Ž,æ±‰å­—åºé¡ºå¹¶ä¸å®šä¸€å½±é˜…å“è¯»ã€‚äº‹è¯å®žæ˜Žäº†å½“ä½ çœ‹è¿™å®Œå¥è¯ä¹‹åŽæ‰å‘å­—çŽ°éƒ½ä¹±æ˜¯çš„ã€‚æ ¹æ®è¿™ä¸€çŽ°è±¡ï¼ŒScrmableåšå£«å°†ä¸€ä¸ªå•è¯çš„é¦–å°¾å­—æ¯ä¿æŒä¸å˜ï¼Œä¸­é—´å­—æ¯ä»»æ„ä¹±åºï¼Œç”Ÿæˆçš„å•è¯æˆä¸ºScrmable Wordï¼ŒçŽ°åœ¨æˆ‘ä»¬è®¤ä¸ºåŽŸå•è¯å’ŒScrmableå•è¯ä¸€æ ·å¯ä»¥é˜…è¯»ã€‚çŽ°åœ¨ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªå•è¯æ•°ç»„ï¼Œæ±‚å•è¯æ•°ç»„ä¸­æœ‰å¤šå°‘ä¸ªå•è¯å‡ºçŽ°åœ¨å­—ç¬¦ä¸²ä¸­ï¼ˆåŽŸå•è¯å’ŒScrmableå•è¯å‡å¯ï¼‰ã€‚ æ€è·¯é¦–å°¾ä¸å˜ï¼Œä¸­é—´å­—æ¯é¡ºåºä»»æ„ï¼Œåˆ™å¯ä»¥é€šè¿‡å°†å•è¯å“ˆå¸Œæ¥åŒ¹é…ï¼Œå“ˆå¸Œä¾æ®å­—æ¯è¡¨ä¸­æ¯ä¸ªå­—æ¯å‡ºçŽ°çš„æ¬¡æ•°ã€‚ç»Ÿè®¡æ¯ä¸ªå•è¯çš„é•¿åº¦ï¼ŒéåŽ†æ‰€æœ‰å­˜åœ¨çš„å•è¯é•¿åº¦ï¼Œä»Žå¤´åˆ°å°¾ä¾æ¬¡æžšä¸¾åŒºé—´ï¼Œå½“åŒºé—´å•è¯å“ˆå¸Œå­˜åœ¨åŒ¹é…æ—¶åˆ™å­˜åœ¨Scrmabledæˆ–Original Wordï¼ŒåŒ¹é…åŽç§»é™¤åŒ¹é…çš„å•è¯ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192#include &lt;cmath&gt;#include &lt;cstdio&gt;#include &lt;cstring&gt;#include &lt;iostream&gt;#include &lt;algorithm&gt;#include &lt;unordered_map&gt;#define ll long long#define ull unsigned long longusing namespace std;const int HASH_SEED = 123;const int MAXN = 1e5+10;const int MAXM = 1e6+10;int T, L, N, A, B, C, D;char S1, S2;char S[MAXM];int numSeed[MAXM];int alpha[26];ull getHash(char start, char end, int alpha[]) &#123; ull res = start * HASH_SEED + end; for (int i = 0; i &lt; 26; ++i) &#123; res = res * HASH_SEED + alpha[i]; &#125; return res;&#125;int solve() &#123; unordered_map&lt;ull, int&gt; hash; int lenArr[MAXN]; char tmpStr[MAXN]; int totLen = 0; scanf("%d", &amp;L); for (int i = 0; i &lt; L; ++i) &#123; scanf("%s", tmpStr); int len = strlen(tmpStr); memset(alpha, 0, sizeof(alpha)); for (int j = 1; j &lt; len-1; ++j) alpha[tmpStr[j] - 'a']++; hash[getHash(tmpStr[0], tmpStr[len-1], alpha)]++; lenArr[totLen++] = len; &#125; sort(lenArr, lenArr+totLen); totLen = unique(lenArr, lenArr+totLen) - lenArr; getchar(); scanf("%c %c %d %d %d %d %d", &amp;S1, &amp;S2, &amp;N, &amp;A, &amp;B, &amp;C, &amp;D); numSeed[0] = S[0] = S1; numSeed[1] = S[1] = S2; for (int i = 2; i &lt; N; ++i) &#123; numSeed[i] = ((ll) A * numSeed[i-1] + (ll) B * numSeed[i-2] + (ll) C) % (ll) D; S[i] = (char) (numSeed[i] % 26 + 97); &#125; S[N] = '\0'; int res = 0; ull substrHash; for (int i = 0; i &lt; totLen; ++i) &#123; int len = lenArr[i]; if (len &gt; N) continue; memset(alpha, 0, sizeof(alpha)); for (int j = 1; j &lt; len-1; ++j) alpha[S[j] - 'a']++; substrHash = getHash(S[0], S[len-1], alpha); if (hash.count(substrHash)) &#123; res += hash[substrHash]; hash.erase(substrHash); &#125; for (int j = len; j &lt; N; ++j) &#123; ++alpha[S[j - 1] -'a']; --alpha[S[j - len + 1] - 'a']; substrHash = getHash(S[j-len+1], S[j], alpha); if (hash.count(substrHash)) &#123; res += hash[substrHash]; hash.erase(substrHash); &#125; &#125; &#125; return res;&#125;int main(int argc, const char * argv[]) &#123; scanf("%d", &amp;T); for (int kase = 1; kase &lt;= T; ++kase) &#123; printf("Case #%d: %d\n", kase, solve()); &#125; return 0;&#125;]]></content>
      <categories>
        <category>é¢˜è§£</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>KickStart</tag>
        <tag>åˆ·é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NSURLProtocolæŽ¢ç©¶åŠå®žè·µ]]></title>
    <url>%2F2018%2F06%2F10%2FNSURLProtocol%E6%8E%A2%E7%A9%B6%E5%8F%8A%E5%AE%9E%E8%B7%B5%2F</url>
    <content type="text"><![CDATA[åˆè¯†NSURLProtocol åŠ URL Loading SystemHybridåº”ç”¨é€æ¸æ™®éï¼Œå¯¹äºŽiOSå¼€å‘ï¼ŒNSURLProtocolä¸ºå…¶æä¾›äº†è®¸å¤šé‡è¦çš„Hybridèƒ½åŠ›ã€‚è¯´åˆ°NSURLProtocolï¼Œé¦–å…ˆè¦æåˆ°URL Loading Systemï¼ŒåŽè€…æ”¯æŒç€æ•´ä¸ªAppè®¿é—®URLæŒ‡å®šå†…å®¹ã€‚æ ¹æ®æ–‡æ¡£é…å›¾ï¼Œå…¶ç»“æž„å¤§è‡´å¦‚ä¸‹ï¼š éƒ½æœ‰å“ªäº›ç½‘ç»œè¯·æ±‚ç»ç”±URL Loading Systemå‘¢ï¼Ÿ ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒåŒ…æ‹¬NSURLConnectionã€NSURLSessionç­‰å‡æ˜¯ç»ç”±è¯¥åŠ è½½ç³»ç»Ÿã€‚è€Œç›´æŽ¥ä½¿ç”¨CFNetworkçš„è¯·æ±‚å¹¶ä¸ç»è¿‡æ­¤ç³»ç»Ÿ(ASIHTTPRequestä½¿ç”¨CFNetwork)ï¼ŒåŒæ—¶ï¼ŒWKWebViewä½¿ç”¨äº†WebKitï¼Œä¹Ÿä¸ç»è¿‡è¯¥åŠ è½½ç³»ç»Ÿã€‚ åœ¨æ•´ä¸ªURL Loading Systemä¸­ï¼ŒNSURLProtocolå¹¶ä¸è´Ÿè´£ä¸»è¦å¤„ç†é€»è¾‘ï¼Œå…¶ä½œä¸ºä¸€ä¸ªå·¥å…·ç‹¬ç«‹äºŽURL Loadingçš„ä¸šåŠ¡é€»è¾‘ã€‚æ‹¦æˆªæ‰€æœ‰ç»ç”±URL Loading Systemçš„ç½‘ç»œè¯·æ±‚å¹¶å¤„ç†ï¼Œæ˜¯ä¸€ä¸ªå­˜åœ¨äºŽåˆ‡é¢çš„æŠ½è±¡ç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šè¿‡URLProtocolï¼Œå¯ä»¥æ‹¦æˆª/å¤„ç†URLConnectionã€URLSessionã€UIWebViewçš„è¯·æ±‚ï¼Œå¯¹äºŽWebKit(WKWebView)å¯ä»¥é€šè¿‡ä½¿ç”¨ç§æœ‰APIå®žçŽ°æ‹¦æˆªWKWebViewçš„è¯·æ±‚ã€‚åŒæ—¶ï¼ŒiOS11ä¹‹åŽæä¾›äº†WKURLSchemeHandlerå®žçŽ°æ‹¦æˆªé€»è¾‘ã€‚ ä½¿ç”¨URLProtocolURLä¸ºæŠ½è±¡ç±»ï¼Œéœ€è¦ç»§æ‰¿å¹¶å®žçŽ°ä»¥ä¸‹æ–¹æ³•ï¼š12345class func canInit(with request: URLRequest) -&gt; Boolclass func canonicalRequest(for request: URLRequest) -&gt; URLRequestinit(request: URLRequest, cachedResponse: CachedURLResponse?, client: URLProtocolClient?)func startLoading()func stopLoading() æ³¨å†ŒURLProtocolæƒ³è¦é€šè¿‡å­ç±»æ‹¦æˆªè¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œè¯¥ç±»1234// URLConnectionã€UIWebViewã€WKWebViewä½¿ç”¨URLProtocolçš„registerClass:æ–¹æ³•class func registerClass(_ protocolClass: AnyClass) -&gt; Bool// URLSession ä½¿ç”¨ URLSessionConfigurationçš„protocolClasseså±žæ€§var protocolClasses: [AnyClass]? &#123; get set &#125; æ‹¦æˆªè¯·æ±‚URLProtocolé€‰æ‹©æ˜¯å¦æ‹¦æˆªè¯·æ±‚çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼šfunc canInit(with request: URLRequest) -> Bool```1234567æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯¥requestä¸Šä¸‹æ–‡åˆ¤æ–­æ˜¯å¦è¦å¤„ç†ï¼Œå¦‚åˆ¤æ–­å½“å‰URL schemeï¼Œä»Žè€Œå¤„ç†æˆ‘ä»¬è‡ªå®šä¹‰çš„urlè¯·æ±‚ï¼Œå®žçŽ°å‰ç«¯å¯¹æœ¬åœ°æ²™ç›’çš„ç›´æŽ¥è¯»å–ã€‚åŽæ–‡å°†ä¼šæ¼”ç¤ºè¯¥å®žçŽ°æ–¹å¼ã€‚### å¤„ç†è¯·æ±‚æ‹¦æˆªè¯·æ±‚åŽï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦å¯¹è¯¥è¯·æ±‚è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯·æ±‚å†…å®¹ï¼Œå¯¹å…¶é‡æ–°åŒ…è£…ï¼Œç„¶åŽè¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚```class func canonicalRequest(for request: URLRequest) -&gt; URLRequest åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®åŽŸrequestçš„ä¸Šä¸‹æ–‡ï¼Œç”Ÿæˆä¸€ä¸ªæ–°requestå¹¶å¤‡ç”¨ã€‚ ä¸Šé¢æ˜¯URLProtocolçš„å…¥å£æ–¹æ³•ï¼Œä¸‹é¢åˆ™æ˜¯å…·ä½“å¤„ç†é€»è¾‘ï¼šå½“æˆ‘ä»¬æ‹¦æˆªäº†è¯·æ±‚æ—¶ï¼Œç³»ç»Ÿå°†ä¼šè¦æ±‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªURLProtocolå®žä¾‹ï¼Œå¹¶è´Ÿè´£æ‰€æœ‰åŠ è½½é€»è¾‘ã€‚å¦‚ä¸‹æ–¹æ³•åˆ™æ˜¯æ ¹æ®å½“å‰requestç”Ÿæˆä¸€ä¸ªURLProtocolå­ç±»å®žä¾‹ï¼Œè¿›è¡ŒåŽç»­å¤„ç†å·¥ä½œã€‚URLRequest, cachedResponse: CachedURLResponse?, client: URLProtocolClient?)```123æŽ¥ä¸‹æ¥è¿›å…¥æœ€é‡è¦çš„æ–¹æ³•ï¼Œ**æˆ‘ä»¬éœ€è¦åœ¨startLoadingæ–¹æ³•ä¸­å®žçŽ°æ‰€æœ‰è‡ªå®šä¹‰åŠ è½½é€»è¾‘**```func startLoading() å¸¸è§çš„å¤„ç†é€»è¾‘ï¼š æ ¹æ®å½“å‰RequeståŠä»»ä½•ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç”Ÿæˆæ–°çš„é€»è¾‘åŠè¯·æ±‚å¹¶å‘é€å‡ºåŽ»ã€‚ è§£æžè‡ªå®šä¹‰url schemeï¼Œè¯»å–æœ¬åœ°æ²™ç›’æ–‡ä»¶å¹¶è¿”å›žï¼Œå®žçŽ°å‰ç«¯urlç›´æŽ¥è¯»å–æ²™ç›’æ–‡ä»¶ URLProtocolClientåœ¨æˆ‘ä»¬æ‹¦æˆªå¹¶å¤„ç†è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦æŠŠå½“å‰çš„å¤„ç†æƒ…å†µåé¦ˆç»™URL Loading Systemï¼ŒURLProtocolçš„clientå¯¹è±¡åˆ™ä»£è¡¨äº†è¿™ä¸ªåé¦ˆä¿¡æ¯çš„æŽ¥å—è€…ã€‚æˆ‘ä»¬åº”åœ¨å¤„ç†è¿‡ç¨‹çš„é€‚å½“ä½ç½®ä½¿ç”¨è¿™äº›å›žè°ƒã€‚URLProtocolClientåè®®åŒ…å«å¦‚ä¸‹æ–¹æ³•12345678910111213141516/// ç¼“å­˜æ˜¯å¦å¯ç”¨func urlProtocol(_ protocol: URLProtocol, cachedResponseIsValid cachedResponse: CachedURLResponse)/// è¯·æ±‚å–æ¶ˆfunc urlProtocol(_ protocol: URLProtocol, didCancel challenge: URLAuthenticationChallenge)/// è¯·æ±‚å¤±è´¥func urlProtocol(_ protocol: URLProtocol, didFailWithError error: Error)/// æˆåŠŸåŠ è½½æ•°æ®func urlProtocol(_ protocol: URLProtocol, didLoad data: Data)/// æ”¶åˆ°èº«ä»½éªŒè¯è¯·æ±‚func urlProtocol(_ protocol: URLProtocol, didReceive challenge: URLAuthenticationChallenge)/// æŽ¥æ”¶åˆ°Responsefunc urlProtocol(_ protocol: URLProtocol, didReceive response: URLResponse, cacheStoragePolicy policy: URLCache.StoragePolicy)/// è¯·æ±‚è¢«é‡å®šå‘func urlProtocol(_ protocol: URLProtocol, wasRedirectedTo request: URLRequest, redirectResponse: URLResponse)/// åŠ è½½è¿‡ç¨‹ç»“æŸï¼Œè¯·æ±‚å®Œæˆfunc urlProtocolDidFinishLoading(_ protocol: URLProtocol) å®žæˆ˜åº”ç”¨URLProtocolæ‹¦æˆªå¸¸ç”¨äºŽ hybridåº”ç”¨çš„å‰ç«¯-å®¢æˆ·ç«¯äº¤äº’å¦‚å®žçŽ°ç½‘é¡µå¯¹æ²™ç›’æ–‡ä»¶è®¿é—®ã€æµè§ˆå™¨æ•°æ®æ‹¦æˆªç­‰ï¼Œä»¥ä¸‹ä»‹ç»ä¸¤ç§å¸¸è§caseï¼šå·¥ç¨‹ä»£ç å¯è§ï¼šæ­¤é“¾æŽ¥ Hybridåº”ç”¨Hybridåº”ç”¨è¾ƒä¸ºå¸¸è§ï¼Œç»å¸¸å­˜åœ¨ç½‘é¡µéœ€è¦è®¿é—®æœ¬åœ°ç›®å½•çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬å­˜å‚¨clientvarã€èŽ·å–å®¢æˆ·ç«¯cacheã€è®¿é—®æ²™ç›’æ–‡ä»¶ç­‰ã€‚è‹¥ä¸é€‚ç”¨URLProtocolï¼Œä¸Šè¿°è¿‡ç¨‹å¯ä»¥é€šè¿‡å‰ç«¯é€šçŸ¥å®¢æˆ·ç«¯æä¾›æŸèµ„æº-&gt;å®¢æˆ·ç«¯é€šè¿‡æŽ¥å£ä¼ è¾“èµ„æºè¿™ä¸€è¿‡ç¨‹å®žçŽ°ã€‚ä½†å­˜åœ¨é€‚é…å¤æ‚ï¼Œä¸¤è¿‡ç¨‹åˆ†ç¦»ç­‰é—®é¢˜ã€‚è€Œé€šè¿‡URLProtocolæ‹¦æˆªè¯·æ±‚ï¼Œå¯ä½¿è¿™ä¸€è¿‡ç¨‹å¯¹å‰ç«¯é€æ˜Žï¼Œå…¶æ— é¡»å…³å¿ƒæ•°æ®è¯·æ±‚é€»è¾‘ã€‚ ç¤ºä¾‹ä»£ç è§LocalFileç›®å½•123456789101112131415161718192021222324override func startLoading() &#123; if let urlStr = request.url?.absoluteString, let scheme = request.url?.scheme &#123; let startIndex = urlStr.index(urlStr.startIndex, offsetBy: scheme.count + 3) let endIndex = urlStr.endIndex let imagePath: String = String(urlStr[startIndex..&lt;endIndex]) if let image = UIImage(contentsOfFile: imagePath), let data = UIImagePNGRepresentation(image) &#123; // Logic of Success let response = HTTPURLResponse(url: self.request.url!, statusCode: 200, httpVersion: "1.1", headerFields: nil) self.client?.urlProtocol(self, didReceive: response!, cacheStoragePolicy: URLCache.StoragePolicy.notAllowed) self.client?.urlProtocol(self, didLoad: data) self.client?.urlProtocolDidFinishLoading(self) return &#125; &#125; // Logic of Failed let error = NSError(domain: NSURLErrorDomain, code: NSURLErrorCannotOpenFile, userInfo: nil) as Error self.client?.urlProtocol(self, didFailWithError: error) return&#125; ä¸Šè¿°ä»£ç æ‹¦æˆªäº†å‰ç«¯å¯¹äºŽmcimg://çš„ç½‘ç»œè¯·æ±‚ï¼ŒåŒæ—¶ä»ŽBundleä¸­æŸ¥æ‰¾è¯¥æ–‡ä»¶å¹¶è¿”å›žè¯·æ±‚ã€‚è¯¥é€»è¾‘åŒæ ·é€‚ç”¨äºŽä»Žæœ¬åœ°Cacheã€æŒä¹…åŒ–å­˜å‚¨ä¸­èŽ·å–ï¼Œå®žçŽ°äº†nativeèµ„æºèŽ·å–ä¸Žå‰ç«¯èµ„æºèŽ·å–è¿‡ç¨‹çš„è§£è€¦ã€‚ æ‹¦æˆªè¯·æ±‚æ•°æ®å¯¹äºŽåº”ç”¨å†…ç½®æµè§ˆå™¨ç­‰åœºæ™¯ï¼Œç»å¸¸éœ€è¦è®°å½•ç”¨æˆ·è®¿é—®äº†é‚£äº›ç½‘é¡µç­‰ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œå±é™©æç¤ºã€å…è´£æç¤ºã€æ•°æ®ç»Ÿè®¡ã€ç«žå“æ‹¦æˆªç­‰å·¥ä½œã€‚æ­¤è¿‡ç¨‹åŒæ ·å¯é€šè¿‡URLProtocolæ‹¦æˆªå®žçŽ° 12345678910override func startLoading() &#123; RequestInfoProtocol.requestInfoProtocolDict.insert(request.hashValue) NotificationCenter.default.post(name: NSNotification.Name.RequestInfoURL, object: request.url?.absoluteString) if let newRequest = (request as NSURLRequest).copy() as? URLRequest &#123; let newTask = session.dataTask(with: newRequest) newTask.resume() self.copiedTask = newTask &#125;&#125; ä¸Šè¿°ä»£ç å®žçŽ°äº†æ”¶åˆ°è¯·æ±‚æ—¶åšå‡ºå¤„ç†é€»è¾‘ï¼ˆå¦‚é€šçŸ¥ï¼‰ã€‚ä½†ç”±äºŽè¯¥è¯·æ±‚è¢«æ‹¦æˆªå°†æ— æ³•ç»§ç»­å‘è‡³ç›®çš„åœ°ï¼Œæ•…å¤åˆ¶è¯¥è¯·æ±‚å¹¶å‘èµ·ï¼ŒåŒæ—¶å®žçŽ°ä¸‹è¿°URLSessionæ–¹æ³•æ­£ç¡®è¿”å›žresponseã€‚ 123456789101112131415161718192021222324252627extension RequestInfoProtocol: URLSessionDataDelegate &#123; func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?) &#123; if let error = error &#123; self.client?.urlProtocol(self, didFailWithError: error) return &#125; self.client?.urlProtocolDidFinishLoading(self) &#125; func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data) &#123; self.client?.urlProtocol(self, didLoad: data) &#125; func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse, completionHandler: @escaping (URLSession.ResponseDisposition) -&gt; Void) &#123; self.client?.urlProtocol(self, didReceive: response, cacheStoragePolicy: .notAllowed) completionHandler(.allow) &#125; func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, willCacheResponse proposedResponse: CachedURLResponse, completionHandler: @escaping (CachedURLResponse?) -&gt; Void) &#123; completionHandler(proposedResponse) &#125; func urlSession(_ session: URLSession, task: URLSessionTask, willPerformHTTPRedirection response: HTTPURLResponse, newRequest request: URLRequest, completionHandler: @escaping (URLRequest?) -&gt; Void) &#123; self.client?.urlProtocol(self, wasRedirectedTo: request, redirectResponse: response) RequestInfoProtocol.requestInfoProtocolDict.remove(request.hashValue) let redirectError = NSError(domain: NSURLErrorDomain, code: NSUserCancelledError, userInfo: nil) task.cancel() self.client?.urlProtocol(self, didFailWithError: redirectError) &#125;&#125; ä¸Šè¿°ä»£ç å®žçŽ°äº†URLSessionDataDelegateï¼Œä¸»è¦ä½œç”¨æ˜¯å°†å·²å‘é€è¯·æ±‚æ‰€æ”¶åˆ°çš„å“åº”ï¼Œæ­£ç¡®è¿”å›žç»™è¯·æ±‚è€…ã€‚é€šè¿‡æ‹¦æˆªè¯·æ±‚ï¼Œå¹¶æŒ‰åºè¿”å›žäºŒæ¬¡ç¡®è®¤é¡µé¢ã€å±é™©æç¤ºé¡µé¢ç­‰ï¼Œå®žçŽ°äº†å†…ç½®æµè§ˆå™¨æ‹¦æˆªéœ€æ±‚ï¼Œå¹¶ä¿è¯äº†æµè§ˆå™¨çš„æ­£å¸¸è¿è¡Œã€‚ Tips: ä¸Šè¿°è¿‡ç¨‹éœ€è¦ä½¿ç”¨WebKitç§æœ‰APIï¼ŒWKWebViewåœ¨iOS 11å¼€æ”¾äº†WKURLSchemeHandlerï¼Œæµç¨‹ç±»ä¼¼URLProtocolã€‚]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>NSURLProtocol</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSçš„å‡ ç§å®šæ—¶å™¨åŠåŒºåˆ«]]></title>
    <url>%2F2018%2F01%2F13%2FiOS%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9A%E6%97%B6%E5%99%A8%E5%8F%8A%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸ç”¨åˆ°å®šæ—¶å™¨ï¼ŒiOSä¸ºæˆ‘ä»¬æä¾›äº†å¤šç§å®šæ—¶å™¨ï¼ŒåŒ…æ‹¬NSTimerã€CADisplayLinkã€GCDã€NSThread(performSelector:afterDelay:)ï¼Œå…¶æœ¬è´¨éƒ½æ˜¯é€šè¿‡RunLoopæ¥å®žçŽ°ï¼Œä½†GCDé€šè¿‡å…¶è°ƒåº¦æœºåˆ¶å¤§å¤§æé«˜äº†æ€§èƒ½ã€‚å®šæ—¶å™¨çš„ä½¿ç”¨ä¸­å®¹æ˜“å­˜åœ¨ä¸€äº›è¯¯åŒºï¼Œæ•…å†™æœ¬æ–‡æ€»ç»“ã€‚ æœ¬æ–‡å°†ä»‹ç»iOSçš„å‡ ç§å®šæ—¶å™¨ã€å®šæ—¶å™¨çš„ç«‹å³æ‰§è¡Œæ–¹æ³•ã€å†…å­˜æ³„éœ²é—®é¢˜ã€ä¸å‡†æ—¶é—®é¢˜ NSTimeriOSä¸­æœ€åŸºæœ¬çš„å®šæ—¶å™¨ï¼Œåœ¨Swiftä¸­ç§°ä¸ºTimerã€‚å…¶é€šè¿‡RunLoopæ¥å®žçŽ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¾ƒä¸ºå‡†ç¡®ï¼Œä½†å½“å½“å‰å¾ªçŽ¯è€—æ—¶æ“ä½œè¾ƒå¤šæ—¶ï¼Œä¼šå‡ºçŽ°å»¶è¿Ÿé—®é¢˜ã€‚åŒæ—¶ï¼Œä¹Ÿå—æ‰€åŠ å…¥çš„RunLoopçš„RunLoopModeå½±å“ï¼Œå…·ä½“å¯ä»¥å‚è€ƒRunLoopçš„ç‰¹æ€§ã€‚ åˆ›å»ºæž„é€ æ–¹æ³•ä¸»è¦åˆ†ä¸ºè‡ªåŠ¨å¯åŠ¨å’Œæ‰‹åŠ¨å¯åŠ¨ï¼Œæ‰‹åŠ¨å¯åŠ¨çš„æž„é€ æ–¹æ³•éœ€è¦æˆ‘ä»¬åœ¨åˆ›å»ºNSTimeråŽæ‰‹åŠ¨å¯åŠ¨å®ƒ: 1234567/// æž„é€ å¹¶å¼€å¯(å¯åŠ¨NSTimeræœ¬è´¨ä¸Šæ˜¯å°†å…¶åŠ å…¥RunLoopä¸­)// &quot;scheduledTimer&quot;å‰ç¼€çš„ä¸ºè‡ªåŠ¨å¯åŠ¨NSTimerçš„ï¼Œå¦‚:+ (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)interval repeats:(BOOL)repeats block:(void (^)(NSTimer *timer))block/// æž„é€ ä½†ä¸å¼€å¯// &quot;timer&quot;å‰ç¼€çš„ä¸ºåªæž„é€ ä¸å¯ç”¨çš„ï¼Œå¦‚:+ (NSTimer *)timerWithTimeInterval:(NSTimeInterval)interval repeats:(BOOL)repeats block:(void (^)(NSTimer *timer))block å‰é¢è¯´åˆ°ï¼Œå®šæ—¶å™¨çš„æœ¬è´¨æ˜¯åŠ å…¥åˆ°äº†RunLoopçš„Timeråˆ—è¡¨ä¸­ï¼Œä»Žè€Œéšç€è¿è¡Œå¾ªçŽ¯æ¥å®žçŽ°å®šæ—¶å™¨çš„åŠŸèƒ½ã€‚æ‰€ä»¥NSTimeré™¤äº†æž„é€ ï¼Œè¿˜éœ€è¦åŠ å…¥RunLoopã€‚å…³äºŽRunLoopç®€å•å®žç”¨å¯ä»¥è§æ–‡æœ«ã€‚ é‡Šæ”¾å®šæ—¶å™¨çš„é‡Šæ”¾ä¸€å®šè¦å…ˆå°†å…¶ç»ˆæ­¢ï¼Œè€ŒåŽæ‰èƒ½é”€æ¯å¯¹è±¡ã€‚å…·ä½“åŽŸå› ä¸‹æ–‡ä¼šè¯´ã€‚ 1- (void)invalidate; ç«‹å³æ‰§è¡Œ(fire)æˆ‘ä»¬å¯¹å®šæ—¶å™¨è®¾ç½®äº†å»¶æ—¶ä¹‹åŽï¼Œæœ‰æ—¶éœ€è¦è®©å®ƒç«‹åˆ»æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨fireæ–¹æ³•: 1- (void)fire; ä½†æ˜¯è¯¥æ–¹æ³•çš„ä½¿ç”¨éœ€è¦æ³¨æ„: fireæ–¹æ³•ä¸ä¼šæ”¹å˜é¢„å®šå‘¨æœŸæ€§è°ƒåº¦ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœæˆ‘ä»¬æŠŠTimerè®¾ç½®ä¸ºå¾ªçŽ¯è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»»ä½•æ—¶å€™è°ƒç”¨fireæ–¹æ³•ï¼Œä¸‹ä¸€æ¬¡è°ƒåº¦çš„æ—¶é—´ä»æ—§æ˜¯æŒ‰ç…§é¢„å®šæ—¶é—´ï¼Œè€ŒéžåŸºäºŽæœ¬æ¬¡æ‰§è¡Œçš„æ—¶é—´è®¡ç®—è€Œå¾—ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒä¸‹é¢çš„ðŸŒ°: 12345678910111213141516self.timer1 = [NSTimer timerWithTimeInterval:5.0 target:self selector:@selector(timerMethod1) userInfo:nil repeats:NO];[[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];self.timer2 = [NSTimer timerWithTimeInterval:5.0 target:self selector:@selector(timerMethod2) userInfo:nil repeats:NO];[[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];/* ......... */- (void)timerMethod1 &#123; static int timerIdx1 = 0; NSLog(@&quot;Timer Method1: %d&quot;, timerIdx1++);&#125;- (void)timerMethod2 &#123; static int timerIdx2 = 0; NSLog(@&quot;Timer Method2: %d&quot;, timerIdx2++);&#125; æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªNSTimerå¹¶åŠ å…¥åˆ°RUnLoopä¸­ï¼Œå…¶ç›®æ ‡æ–¹æ³•å’Œå…¶ä»–å±žæ€§å‡ç›¸åŒï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å‰è€…åªè¿è¡Œä¸€æ¬¡ã€‚ æˆ‘ä»¬åœ¨ç¬¬8ç§’æ—¶è°ƒç”¨fireæ–¹æ³•ï¼Œç»“æžœå¦‚ä½•å‘¢ï¼Ÿ timer1ç«‹å³æ‰§è¡Œï¼Œå¹¶ä¸”ç”±äºŽä»…æ‰§è¡Œä¸€æ¬¡ï¼Œå…¶ä»»åŠ¡ç»“æŸã€‚è€Œtimer2åœ¨ç¬¬8ç§’æ‰§è¡ŒåŽï¼Œä»æ—§åœ¨ç¬¬10ç§’æ‰§è¡Œï¼Œè¿™æ ·çš„ç»“æžœè¯´æ˜Žäº†fireæ–¹æ³•ä¸ä¼šæ”¹å˜é¢„å®šå‘¨æœŸæ€§è°ƒåº¦ã€‚ CADisplayLinkCADisplayLinkæ˜¯åŸºäºŽå±å¹•åˆ·æ–°çš„å‘¨æœŸï¼Œæ‰€ä»¥å…¶ä¸€èˆ¬å¾ˆå‡†æ—¶ï¼Œæ¯ç§’åˆ·æ–°60æ¬¡ã€‚å…¶æœ¬è´¨ä¹Ÿæ˜¯é€šè¿‡RunLoopï¼Œæ‰€ä»¥ä¸éš¾çœ‹å‡ºï¼Œå½“RunLoopé€‰æ‹©å…¶ä»–æ¨¡å¼æˆ–è¢«è€—æ—¶æ“ä½œè¿‡å¤šæ—¶ï¼Œä»æ—§ä¼šé€ æˆå»¶è¿Ÿã€‚ å…¶ä½¿ç”¨æ­¥éª¤ä¸º åˆ›å»ºCADisplayLink-&gt;æ·»åŠ è‡³RunLoopä¸­-&gt;ç»ˆæ­¢-&gt;é”€æ¯ã€‚ä»£ç å¦‚ä¸‹: 12345678// åˆ›å»ºCADisplayLinkCADisplayLink *disLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(linkMethod)];// æ·»åŠ è‡³RunLoopä¸­[disLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes];// ç»ˆæ­¢å®šæ—¶å™¨[disLink invalidate];// é”€æ¯å¯¹è±¡disLink = nil; ç”±äºŽå…¶å¹¶éžNSTimerçš„å­ç±»ï¼Œç›´æŽ¥ä½¿ç”¨NSRunLoopçš„æ·»åŠ Timeræ–¹æ³•æ— æ³•åŠ å…¥ï¼Œåº”ä½¿ç”¨CADisplayLinkè‡ªå·±çš„addToRunLoop:forMode:æ–¹æ³•ã€‚ åŒæ—¶ï¼Œç”±äºŽå…¶æ˜¯åŸºäºŽå±å¹•åˆ·æ–°çš„ï¼Œæ‰€ä»¥ä¹Ÿåº¦é‡å•ä½æ˜¯æ¯å¸§ï¼Œå…¶æä¾›äº†æ ¹æ®å±å¹•åˆ·æ–°æ¥è®¾ç½®é—´éš”çš„frameIntervalå±žæ€§ï¼Œå…¶å†³å®šäºŽå±å¹•åˆ·æ–°å¤šå°‘å¸§æ—¶è°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œé»˜è®¤ä¸º1ï¼Œå³1/60ç§’è°ƒç”¨ä¸€æ¬¡ã€‚ å¦‚æžœæˆ‘ä»¬æƒ³è¦è®¡ç®—å‡ºæ¯æ¬¡è°ƒç”¨çš„æ—¶é—´é—´éš”ï¼Œå¯ä»¥é€šè¿‡frameInterval * durationæ±‚å‡ºï¼ŒåŽè€…ä¸ºå±å¹•æ¯å¸§é—´éš”çš„åªè¯»å±žæ€§ã€‚ åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œé€‚å½“ä½¿ç”¨CADisplayLinkç”šè‡³æœ‰ä¼˜åŒ–ä½œç”¨ã€‚æ¯”å¦‚å¯¹äºŽéœ€è¦åŠ¨æ€è®¡ç®—è¿›åº¦çš„è¿›åº¦æ¡ï¼Œç”±äºŽèµ·è¿›åº¦åé¦ˆä¸»è¦æ˜¯ä¸ºäº†UIæ›´æ–°ï¼Œé‚£ä¹ˆå½“è®¡ç®—è¿›åº¦çš„é¢‘çŽ‡è¶…è¿‡å¸§æ•°æ—¶ï¼Œå°±é€ æˆäº†å¾ˆå¤šæ— è°“çš„è®¡ç®—ã€‚å¦‚æžœå°†è®¡ç®—è¿›åº¦çš„æ–¹æ³•ç»‘å®šåˆ°CADisplayLinkä¸Šæ¥è°ƒç”¨ï¼Œåˆ™åªåœ¨æ¯æ¬¡å±å¹•åˆ·æ–°æ—¶è®¡ç®—è¿›åº¦ï¼Œä¼˜åŒ–äº†æ€§èƒ½ã€‚MBProcessHUBåˆ™æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§ã€‚ GCDGCDå®šæ—¶å™¨æ˜¯dispatch_source_tç±»åž‹çš„å˜é‡ï¼Œå…¶å¯ä»¥å®žçŽ°æ›´åŠ ç²¾å‡†çš„å®šæ—¶æ•ˆæžœã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨: 1234567891011121314151617181920212223242526272829/** åˆ›å»ºå®šæ—¶å™¨å¯¹è±¡ * para1: DISPATCH_SOURCE_TYPE_TIMER ä¸ºå®šæ—¶å™¨ç±»åž‹ * para2-3: ä¸­é—´ä¸¤ä¸ªå‚æ•°å¯¹å®šæ—¶å™¨æ— ç”¨ * para4: æœ€åŽä¸ºåœ¨ä»€ä¹ˆè°ƒåº¦é˜Ÿåˆ—ä¸­ä½¿ç”¨ */_gcdTimer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, dispatch_get_global_queue(0, 0));/** è®¾ç½®å®šæ—¶å™¨ * para2: ä»»åŠ¡å¼€å§‹æ—¶é—´ * para3: ä»»åŠ¡çš„é—´éš” * para4: å¯æŽ¥å—çš„è¯¯å·®æ—¶é—´ï¼Œè®¾ç½®0å³ä¸å…è®¸å‡ºçŽ°è¯¯å·® * Tips: å•ä½å‡ä¸ºçº³ç§’ */dispatch_source_set_timer(_gcdTimer, DISPATCH_TIME_NOW, 2.0 * NSEC_PER_SEC, 0.0 * NSEC_PER_SEC);/** è®¾ç½®å®šæ—¶å™¨ä»»åŠ¡ * å¯ä»¥é€šè¿‡blockæ–¹å¼ * ä¹Ÿå¯ä»¥é€šè¿‡Cå‡½æ•°æ–¹å¼ */dispatch_source_set_event_handler(_gcdTimer, ^&#123; static int gcdIdx = 0; NSLog(@&quot;GCD Method: %d&quot;, gcdIdx++); NSLog(@&quot;%@&quot;, [NSThread currentThread]); if(gcdIdx == 5) &#123; // ç»ˆæ­¢å®šæ—¶å™¨ dispatch_suspend(_gcdTimer); &#125;&#125;);// å¯åŠ¨ä»»åŠ¡ï¼ŒGCDè®¡æ—¶å™¨åˆ›å»ºåŽéœ€è¦æ‰‹åŠ¨å¯åŠ¨dispatch_resume(_gcdTimer); GCDæ›´å‡†æ—¶çš„åŽŸå› é€šè¿‡è§‚å¯Ÿä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°GCDå®šæ—¶å™¨å®žé™…ä¸Šæ˜¯ä½¿ç”¨äº†dispatchæº(dispatch source)ï¼Œdispatchæºç›‘å¬ç³»ç»Ÿå†…æ ¸å¯¹è±¡å¹¶å¤„ç†ã€‚dispatchç±»ä¼¼ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œé€šè¿‡ç›‘å¬ç³»ç»Ÿå†…æ ¸å¯¹è±¡ï¼Œåœ¨ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®åŽè‡ªåŠ¨é€šçŸ¥ç›¸åº”çš„dispatché˜Ÿåˆ—æ‰§è¡Œï¼ŒåŽè€…å……å½“æ¶ˆè´¹è€…ã€‚é€šè¿‡ç³»ç»Ÿçº§è°ƒç”¨ï¼Œæ›´åŠ ç²¾å‡†ã€‚ å®šæ—¶å™¨ä¸å‡†æ—¶çš„é—®é¢˜åŠè§£å†³é€šè¿‡ä¸Šæ–‡çš„å™è¿°ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†å®šæ—¶å™¨ä¸å‡†æ—¶çš„åŽŸå› ï¼Œæ€»ç»“ä¸€ä¸‹ä¸»è¦æ˜¯ å½“å‰RunLoopè¿‡äºŽç¹å¿™ RunLoopæ¨¡å¼ä¸Žå®šæ—¶å™¨æ‰€åœ¨æ¨¡å¼ä¸åŒ ä¸Šé¢è§£é‡Šäº†GCDæ›´åŠ å‡†æ—¶çš„åŽŸå› ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆä¹Ÿä¸éš¾å¾—å‡º: é¿å…è¿‡å¤šè€—æ—¶æ“ä½œå¹¶å‘ é‡‡ç”¨GCDå®šæ—¶å™¨ åˆ›å»ºæ–°çº¿ç¨‹å¹¶å¼€å¯RunLoopï¼Œå°†å®šæ—¶å™¨åŠ å…¥å…¶ä¸­(é€‚åº¦ä½¿ç”¨) å°†å®šæ—¶å™¨æ·»åŠ åˆ°NSRunLoopCommonModes(ä½¿ç”¨ä¸å½“ä¼šé˜»å¡žUIå“åº”) å…¶ä¸­åŽä¸¤è€…åœ¨ä½¿ç”¨å‰åº”ç¡®ä¿åˆç†ä½¿ç”¨ï¼Œå¦åˆ™ä¼šäº§ç”Ÿè´Ÿé¢å½±å“ã€‚ å®šæ—¶å™¨çš„å†…å­˜æ³„éœ²é—®é¢˜å®šæ—¶å™¨åœ¨ä½¿ç”¨æ—¶åº”æ ¼å¤–æ³¨æ„å†…å­˜ç®¡ç†ï¼Œå¸¸è§æƒ…å†µæ—¶å®šæ—¶å™¨å¯¹è±¡æ— æ³•é‡Šæ”¾é€ æˆå†…å­˜æ³„éœ²ï¼Œè€Œä¸¥é‡æƒ…å†µä¼šé€ æˆæŽ§åˆ¶å™¨ä¹Ÿæ— æ³•é‡Šæ”¾ï¼Œå±å®³æ›´å¤§ã€‚å…¶å†…å­˜æ³„éœ²æœ‰ä¸¤éƒ¨åˆ†é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€éƒ¨åˆ†: é—®é¢˜1: NSTimeræ— æ³•é‡Šæ”¾æˆ‘ä»¬çŸ¥é“ï¼ŒNSTimerå®žé™…ä¸Šæ˜¯åŠ å…¥åˆ°RunLoopä¸­çš„ï¼Œé‚£ä¹ˆåœ¨å…¶å¯åŠ¨æ—¶å…¶è¢«RunLoopå¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆå³ä½¿æˆ‘ä»¬åœ¨åŽé¢å°†å®šæ—¶å™¨è®¾ä¸ºnilï¼Œä¹Ÿåªæ˜¯å¼•ç”¨è®¡æ•°å‡å°‘äº†1ï¼Œå…¶ä»å› ä¸ºè¢«RunLoopå¼•ç”¨è€Œæ— æ³•é‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚ é—®é¢˜2: æŽ§åˆ¶å™¨æ— æ³•é‡Šæ”¾è¿™æ˜¯NSTimeræ— æ³•é‡Šæ”¾æ‰€é€ æˆçš„æ›´ä¸¥é‡é—®é¢˜ï¼Œç”±äºŽä¸ºå®šæ—¶å™¨è®¾ç½®äº†targetï¼ŒæŽ§åˆ¶å™¨å°±ä¼šå¾—åˆ°ä¸€ä¸ªæ¥è‡ªå®šæ—¶å™¨çš„å¼•ç”¨ã€‚æˆ‘ä»¬æ¥åˆ†æžä¸€ä¸‹è¿™ä¸ªæƒ…å†µï¼Œé¦–å…ˆå®šæ—¶å™¨å¿…é¡»è¢«å¼ºå¼•ç”¨ï¼Œå¦åˆ™å°†åœ¨autoreleasepoolä¹‹åŽè¢«é‡Šæ”¾æŽ‰é€ æˆé‡ŽæŒ‡é’ˆã€‚è€Œå®šæ—¶å™¨çš„targetåˆå¯¹æŽ§åˆ¶å™¨æœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œè¿™å°±æ˜¯å…¸åž‹çš„å¼ºå¼•ç”¨å¾ªçŽ¯(å¾ªçŽ¯å¼•ç”¨)ã€‚ é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨invalidateæ–¹æ³•ã€‚ è‹¹æžœæ–‡æ¡£ä»‹ç»å¦‚ä¸‹: This method is the only way to remove a timer from an NSRunLoop object. The NSRunLoop object removes its strong reference to the timer, either just before the invalidate method returns or at some later point.If it was configured with target and user info objects, the receiver removes its strong references to those objects as well. å³ï¼Œinvalidateæ–¹æ³•ä¼šå°†å®šæ—¶å™¨ä»ŽRunLoopä¸­ç§»é™¤ï¼ŒåŒæ—¶è§£é™¤å¯¹targetç­‰å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚ CADisplayLinkåŒç†ï¼Œè€ŒGCDå®šæ—¶å™¨åˆ™ä½¿ç”¨dispatch_suspend() æ›´å¤šæŠ€æœ¯æ–‡ç« ï¼Œæ¬¢è¿Žè®¿é—®æœ¬äººåšå®¢ - Minecodeâ€™s BlogGithub - Minecodecraft]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>åº•å±‚</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>Cocoa</tag>
        <tag>GCD</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†æŽ¢OCå¯¹è±¡æ¨¡åž‹(isa/superclass)--ä»ŽNSObjectçš„å®žçŽ°å‡ºå‘]]></title>
    <url>%2F2018%2F01%2F09%2F%E5%86%8D%E6%8E%A2OC%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B(isa%3Asuperclass)--%E4%BB%8ENSObject%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%87%BA%E5%8F%91%2F</url>
    <content type="text"><![CDATA[äº†è§£Objective-Cä¸­ç±»åž‹ç»“æž„åŽï¼Œæˆ‘ä»¬çŸ¥é“äº†OCçš„å¯¹è±¡æ¨¡åž‹æž„æˆã€‚åœ¨æ­¤è®¨è®ºæå‡ºä¸€ä¸ªé—®é¢˜ï¼šobject_getClass(obj)ä¸Ž[obj class]æœ‰ä½•åŒºåˆ«ï¼Ÿ ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä»ŽisKindOfClasså’ŒisMemberOfClassä¸¤ä¸ªæ–¹æ³•å…¥æ‰‹è¿›è¡ŒæŽ¢ç©¶ã€‚ èƒŒæ™¯Objective-Cä¸­å¯¹äºŽç±»çš„æ•°æ®ç»“æž„ï¼Œåˆ†ä¸ºäº†å®žä¾‹(object)ã€ç±»(class)ã€å…ƒç±»(meta class)ã€æ ¹å…ƒç±»(root meta class)å‡ ç§(ä¹Ÿå¯åŠ ä¸Šæ ¹ç±»(root class))ã€‚åœ¨ä»–ä»¬çš„å±‚æ¬¡ç»“æž„ä¸­ï¼Œisaæ‰®æ¼”è€…æŒ‡å‘å…¶çˆ¶ç±»åž‹çš„èŒè´£ã€‚å…·ä½“è§è¿™å¼ ç»å…¸çš„å›¾: Runtimeä¸­ä¸ºæˆ‘ä»¬æä¾›äº†object_getClass()å‡½æ•°ï¼Œè€ŒNSObjectä¸ºæˆ‘ä»¬æä¾›äº†+/- (Class)classä¸¤ç§æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œè¿™ä¸¤ç§å‡½æ•°æ˜¯å¦ç›¸åŒå‘¢ï¼Ÿæˆ‘ä»¬æ¥ä½¿ç”¨isKindOfClasså’ŒisMemberOfClasséªŒè¯: 12345NSObject *obj = [[NSObject alloc] init];NSLog(@&quot;%p&quot;, obj);NSLog(@&quot;%p&quot;, object_getClass(obj));NSLog(@&quot;%p&quot;, object_getClass([NSObject class]));NSLog(@&quot;%p&quot;, [NSObject class]); æ‰“å°å¦‚ä¸‹ 12340x10053a440 // [[NSObject alloc] init]0x7fffaa313140 // object_getClass(obj)0x7fffaa3130f0 // object_getClass([NSObject class])0x7fffaa313140 // [NSObject class] å¯ä»¥çœ‹åˆ°ï¼Œobject_getClass(obj)ä¸Ž[NSObject class]æ˜¯åŒä¸€åœ°å€ï¼Œè¯´æ˜Žå¯¹å®žä¾‹è°ƒç”¨object_getClassèŽ·å–äº†å…¶ç±»()ï¼Œè€Œå¯¹å…¶ç±»è°ƒç”¨classç±»æ–¹æ³•ä¹Ÿæ˜¯èŽ·å–å…¶ç±»(è¿™ä¸ªâ€ç±»â€æ˜¯æŒ‡Runtimeå¯¹è±¡æ¨¡åž‹ä¸­çš„â€ç±»â€)ã€‚ å°±è¿™æ ·å°±ç»“æŸæŽ¢ç©¶äº†å—ï¼Œå½“ç„¶ä¸ä¼šï¼Œä¸‹é¢çš„ä»£ç ç»“æžœå¦‚ä½•å‘¢ï¼Ÿ 12345BOOL test1 = [[NSObject class] isKindOfClass:[NSObject class]];BOOL test2 = [[NSObject class] isMemberOfClass:[NSObject class]];BOOL test3 = [[SubClass class] isKindOfClass:[SubClass class]];BOOL test4 = [[SubClass class] isMemberOfClass:[SubClass class]];BOOL test5 = [[SubClass class] isSubclassOfClass:object_getClass([NSObject class])]; å¦‚æžœè®¤ä¸ºå…¨ä¸ºYESï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±æœ‰å¿…è¦ä¸€çœ‹äº†ã€‚(ä¸è®¤ä¸ºçš„è¯ä¹Ÿæœ‰å¿…è¦çœ‹çœ‹;P)å®žé™…ç»“æžœä¸º: ä»…ç¬¬ä¸€ä¸ªä¸ºYESï¼Œå…¶ä½™å…¨ä¸ºNOã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼ŸNSObjectéš¾é“ä¸æ˜¯NSObjectå—?SubClassæ˜Žæ˜Žç»§æ‰¿äº†NSObjectä¸ºä»€ä¹ˆåˆä¸æ˜¯å®ƒçš„å­ç±»å‘¢? æŽ¢ç©¶NSObjectçš„å®žçŽ°æŽ¢ç©¶è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆä»Žæ–¹æ³•çš„å®žçŽ°å…¥æ‰‹ï¼Œè‹¹æžœå¼€æºäº†Runtimeæºç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹NSObjectçš„å®žçŽ°: 12345678910111213141516171819202122232425262728293031323334353637// classæ–¹æ³•+ (Class)class &#123; return self;&#125;- (Class)class &#123; return object_getClass(self);&#125;// isMemberOfClassæ–¹æ³•+ (BOOL)isMemberOfClass:(Class)cls &#123; return object_getClass((id)self) == cls;&#125;- (BOOL)isMemberOfClass:(Class)cls &#123; return [self class] == cls;&#125;// isKindOfClassæ–¹æ³•+ (BOOL)isKindOfClass:(Class)cls &#123; for (Class tcls = object_getClass((id)self); tcls; tcls = class_getSuperclass(tcls)) &#123; if (tcls == cls) return YES; &#125; return NO;&#125;- (BOOL)isKindOfClass:(Class)cls &#123; for (Class tcls = [self class]; tcls; tcls = class_getSuperclass(tcls)) &#123; if (tcls == cls) return YES; &#125; return NO;&#125;// isSubclassOfClassæ–¹æ³•+ (BOOL)isSubclassOfClass:(Class)cls &#123; for (Class tcls = self; tcls; tcls = class_getSuperclass(tcls)) &#123; if (tcls == cls) return YES; &#125; return NO;&#125; æˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼ŒNSObjectçš„classæ–¹æ³•å®žé™…æä¾›äº†ç±»æ–¹æ³•å’Œå®žä¾‹æ–¹æ³•ä¸¤ç§ï¼Œè€Œå‰è€…ç›´æŽ¥è¿”å›žç±»ï¼ŒåŽè€…è°ƒç”¨äº†object_getClassï¼Œä¹Ÿå°±æ˜¯è¯´classåªä¼šè¿”å›žå®žä¾‹æˆ–å¯¹è±¡å¯¹åº”çš„ç±»(è¿™ä¸ªâ€ç±»â€æ˜¯æŒ‡Runtimeå¯¹è±¡æ¨¡åž‹ä¸­çš„â€ç±»â€)ã€‚é‚£ä¹ˆï¼Œä»Žä¸Šé¢ç”¨ä»£ç ç»“æžœä¸å…¨ä¸ºYESï¼Œåˆ™å¯ä»¥åˆ¤æ–­å‡ºobject_getClassä¸æ˜¯ä»…ä»…å‘classæ–¹æ³•ä¸€æ ·è¿”å›žå½“å‰ç±»è¿™ä¹ˆç®€å•(å³ä½¿æ–‡æ¡£åªå†™äº†è¿™ä¸€ç‰¹æ€§)ã€‚ æŽ¢ç©¶object_getClass()çŽ°åœ¨æˆ‘ä»¬æ¥æŽ¢ç©¶object_getClassçš„å…·ä½“è¿‡ç¨‹ï¼Œåœ¨Runtimeçš„ç±»æ¨¡åž‹ä¸­ï¼Œisaè¿žæŽ¥äº†å‡ ç§ç±»çš„ç»“æž„ï¼Œæ‰€ä»¥æŽ¨æ–­object_getClassæ˜¯é€šè¿‡èŽ·å–isaä¸æ–­å‘ä¸Šå¯»æ‰¾çš„ï¼Œæ‰€ä»¥å‡ºçŽ°äº†ä¸Šé¢classæ–¹æ³•ä¸Žobject_getClassæ–¹æ³•çš„ç»“æžœä¸ä¸€è‡´çš„é—®é¢˜ã€‚æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸‹ä»£ç æµ‹è¯•: 1234BOOL getObj1 = object_getClass([NSObject class]) == object_getClass(object_getClass([NSObject class]));BOOL getObj2 = object_getClass([SubClass class]) == object_getClass(object_getClass(object_getClass([SubClass class])));BOOL getObj3 = object_getClass([NSObject class]) == class_getSuperclass(object_getClass([NSObject class]));BOOL getObj4 = object_getClass([NSObject class]) == object_getClass(class_getSuperclass(object_getClass([NSObject class]))); å¯¹äºŽä»¥ä¸Šä»£ç ï¼Œå¦‚æžœæˆ‘ä»¬çš„æŽ¨æµ‹æ˜¯æ­£ç¡®çš„: object_getClassä¸ºæŒ‰ç…§isaéåŽ†ï¼Œclass_getSuperclassä¸ºæŒ‰ç…§superclasséåŽ†ã€‚é‚£ä¹ˆæŒ‰ç…§ä¸Šé¢æ‰€ç¤ºçš„æ¨¡åž‹å›¾ï¼Œç»“æžœåº”è¯¥æ˜¯(YES,NO,NO,YES)ã€‚ ç»“æžœæžœç„¶å¦‚æ­¤ï¼Œè¿™è¯´æ˜Ž: object_getClassä¸ºæŒ‰ç…§isaéåŽ†ï¼Œclass_getSuperclassä¸ºæŒ‰ç…§superclasséåŽ†ã€‚ é‚£ä¹ˆæˆ‘ä»¬åˆšæ‰çš„ä»£ç åœ¨ç­‰å·å³ä¾§æ˜¾ç„¶æ˜¯è¿›è¡Œäº†å¦‚ä¸‹è¿‡ç¨‹:getObj1: Root Class -&gt; Meta Root Class -&gt; Meta Root ClassgetObj2: Class -&gt; Meta Class -&gt; Meta Root Class -&gt; Meta Root ClassgetObj3: Root Class -&gt; Meta Root Class -&gt; Root ClassgetObj4: Root Class -&gt; Meta Root Class -&gt; Root Class -&gt; Meta Root Class è¿™è¯´æ˜Žäº†è¿™ä¸¤ä¸ªå‡½æ•°çš„éåŽ†é¡ºåºï¼Œä¹ŸåŠ æ·±äº†æˆ‘ä»¬å¯¹äºŽisaã€superclassæŒ‡é’ˆåœ¨OCå¯¹è±¡æ¨¡åž‹çš„ç†è§£:æ¯”å¦‚å­ç±»é€šè¿‡isaä¼šèŽ·å–å…¶å…ƒç±»ï¼Œè€Œé€šè¿‡å…ƒç±»isaç›´æŽ¥èŽ·å–åˆ°æ ¹å…ƒç±»ï¼Œè€Œéžå±‚å±‚å‘ä¸ŠéåŽ†ã€‚ é—®é¢˜è§£æžçŽ°åœ¨æˆ‘ä»¬åœ¨å›žè¿‡å¤´çœ‹åˆšæ‰isKindOfClasså’ŒisMemberOfClassæ–¹æ³•ï¼Œå°±ä¸éš¾æ˜Žç™½ç¬¬ä¸€ä¸ªè¯•éªŒä¸­ä»…ç¬¬ä¸€ä¸ªä¸ºYESçš„åŽŸå› äº†: ç±»æˆ–å®žä¾‹è°ƒç”¨classæ–¹æ³•åªä¼šèŽ·å–è¯¥â€ç±»â€,object_getClassä¼šæ²¿ç€isaé“¾æŒç»­éåŽ†ï¼Œè€ŒisKindOfClasså’ŒisMemberOfClassçš„ç±»æ–¹æ³•æ­£æ˜¯é‡‡ç”¨äº†åŽè€…æ¥éåŽ†ï¼Œæ‰€ä»¥è¿”å›žçš„å€¼ã€‚ å…¶å®žè¯´ç™½äº†ï¼Œæ–‡æ¡£æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬isKindOfClasså’ŒisMemberOfClassè¿˜æœ‰ç±»æ–¹æ³•ï¼Œè€Œå®ƒçš„ç±»æ–¹æ³•æ˜¯æŒç»­å‘ä¸Šçº§éåŽ†çš„ï¼Œå®žä¾‹æ–¹æ³•åˆ™åªæ˜¯åˆ¤æ–­å…¶â€ç±»â€çš„ã€‚å¦‚ä¸‹ä»£ç ï¼Œä½¿ç”¨å®žä¾‹æ–¹æ³•ç»“æžœæ˜¯æ­£ç¡®ã€‚ 12345// ç±»æ–¹æ³• ç»“æžœä¸ºNOBOOL testOfCls = [[NSObject class] isMemberOfClass:[NSObject class]];// å®žä¾‹æ–¹æ³• ç»“æžœä¸ºYESNSObject *obj = [[NSObject alloc] init];BOOL testOfObj = [obj isMemberOfClass:[NSObject class]]; æ€»ç»“é€šè¿‡è¿™ä¸€è¿‡ç¨‹ï¼Œæˆ‘ä»¬åŠ æ·±äº†å¯¹Runtimeå¯¹è±¡æ¨¡åž‹å±‚çº§çš„ç†è§£ã€‚åŒæ—¶ï¼Œä¹Ÿæ€»ç»“ä¸€ä¸‹classã€isKindOfClasså’ŒisMemberOfClassæ–¹æ³•å„è‡ªçš„å¤„ç†æœºåˆ¶(ä»¥ä¸‹åŠ åŒå¼•å·çš„ç±»æŒ‡Runtimeå¯¹è±¡ç»“æž„ä¸­çš„â€ç±»â€æ¦‚å¿µ): classæ–¹æ³• ç±»æ–¹æ³•: è¿”å›žè¯¥â€ç±»â€ã€‚ å®žä¾‹æ–¹æ³•: è¿”å›žå¯¹è±¡å¯¹åº”çš„â€ç±»â€ã€‚ isKindOfClassæ–¹æ³• ç±»æ–¹æ³•: æ²¿isaé“¾å‘ä¸ŠéåŽ†ï¼Œåˆ¤æ–­æ˜¯å¦ä¸Žå‚æ•°çš„isaé“¾ä¸Šä»»æ„å±‚çº§çš„ä¸ªä½“ç›¸åŒã€‚ å®žä¾‹æ–¹æ³•: åˆ¤æ–­æ˜¯å¦ä¸Žå‚æ•°å¯¹åº”çš„â€ç±»â€ç›¸åŒã€‚ isMemberOfClass ç±»æ–¹æ³•: åˆ¤æ–­è¯¥ç±»çš„â€å…ƒç±»â€æ˜¯å¦ä¸Žå‚æ•°ç›¸åŒã€‚ å®žä¾‹æ–¹æ³•: åˆ¤æ–­è¯¥å®žä¾‹çš„â€ç±»â€æ˜¯å¦ä¸Žå‚æ•°ç›¸åŒã€‚ å¯ä»¥çœ‹å‡ºï¼Œç±»æ–¹æ³•çš„å¤„ç†æœºåˆ¶å¹¶éžå­—é¢ç†è§£çš„åŒçº§æ¯”è¾ƒï¼Œä¹Ÿè‡ªç„¶ä¼šå‡ºçŽ°[NSObject class] isMemberOfClass:[NSObject class]ä¸å¯¹çš„é—®é¢˜ã€‚åœ¨ä½¿ç”¨æ—¶è¦ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç†è§£OCå¯¹è±¡æ¨¡åž‹çš„åŸºç¡€ä¸Šä½¿ç”¨ã€‚ ç›¸å…³èµ„æ–™ Apple OpenSource - NSObject.mm]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Objective-C</tag>
        <tag>Runtime</tag>
        <tag>åº•å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹/çº¿ç¨‹åŒæ­¥é—®é¢˜]]></title>
    <url>%2F2018%2F01%2F06%2F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BF%9B%E7%A8%8B%3A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[å¾ˆå¤šæ“ä½œç³»ç»Ÿéƒ½æä¾›äº†è¿›ç¨‹å’Œçº¿ç¨‹çš„å¹¶å‘æ“ä½œï¼Œä»–ä»¬å¯èƒ½åœ¨å¼‚æ­¥æ‰§è¡Œæ—¶è®¿é—®å…±äº«æ•°æ®ï¼Œè€Œå¹¶å‘è®¿é—®å…±äº«æ•°æ®å¯èƒ½å¸¦æ¥æ•°æ®ä¸ä¸€è‡´çš„åŒæ­¥é—®é¢˜ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹/çº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œä»¥çº¿ç¨‹çš„å¹¶å‘ä¸ºä¾‹ã€‚ é—®é¢˜ç®€ä»‹ ä¸Šå›¾æ˜¯å¤šçº¿ç¨‹çš„çŠ¶æ€(ä»¥iOSç³»ç»Ÿä¸ºä¾‹)ã€‚æ“ä½œç³»ç»Ÿæ˜¯é€šè¿‡CPUçš„æ—¶é—´ç‰‡è½®è½¬æ¥å®žçŽ°å¤šçº¿ç¨‹çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ç€å¯¹åº”çš„æ—¶é—´ç‰‡ï¼Œå½“å…¶æ—¶é—´ç‰‡åˆ°æ¥æ—¶CPUä¼šåˆ‡æ¢åˆ°è¯¥çº¿ç¨‹ä¸Šä¸‹æ–‡å¹¶æ‰§è¡Œï¼Œå¾…æ—¶é—´ç‰‡ç»“æŸåŽåˆ‡æ¢è‡³ä¸‹ä¸€çº¿ç¨‹ï¼Œä¿å­˜åŽŸçº¿ç¨‹çš„ä¸Šä¸‹æ–‡å¹¶åŠ è½½ä¸‹ä¸€çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä¾æ¬¡å¾ªçŽ¯ã€‚ ä½†æ˜¯ï¼ŒCPUä½•æ—¶åˆ‡æ¢å¹¶ä¸æ˜¯ç”±ç”¨æˆ·å†³å®šï¼Œå½“æ—¶é—´ç‰‡åˆ°è¾¾åŽä¼šç«‹å³è¿›è¡Œçº¿ç¨‹çš„åˆ‡æ¢ï¼Œé‚£ä¹ˆå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œå°±å¯èƒ½å‡ºçŽ°çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ æˆ‘ä»¬å…ˆé‡çŽ°ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œä»¥ä¸‹å‡½æ•°æ¨¡æ‹Ÿäº†ä¹°ç¥¨çš„æ“ä½œï¼ŒæŒç»­ä¹°ç¥¨ç›´åˆ°å–å®Œï¼Œæ•´åž‹sumè¡¨ç¤ºå½“å‰çš„ç¥¨æ•°ï¼Œå‡½æ•°å¦‚ä¸‹:1234567891011- (void)buyFunction &#123; // æœ‰ä½™ç¥¨åˆ™ç»§ç»­è´­ä¹° while (sum &gt; 0) &#123; // è´­ä¹°å‰æ‰“å°å½“å‰ç¥¨æ•° NSLog(@&quot;çº¿ç¨‹%@å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:%då¼ ç¥¨&quot;, [NSThread currentThread].name, sum); // æ¨¡æ‹Ÿè´­ä¹°æ“ä½œ,ç¥¨æ•°-1 sum--; &#125; // ç¥¨å–å®Œåˆ™æ‰“å°å½“å‰ç¥¨æ•° NSLog(@&quot;çº¿ç¨‹%@: ç¥¨å·²å–å®Œ å‰©ä½™:%då¼ ç¥¨&quot;, [NSThread currentThread].name, sum);&#125; çŽ°åœ¨æˆ‘ä»¬å¼€ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ­¤æ“ä½œï¼Œåˆå§‹ä¸º10å¼ ç¥¨(sum = 10)ï¼ŒæŸ¥çœ‹æŽ§åˆ¶å°è¾“å‡º:12345678910111213çº¿ç¨‹2å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:10å¼ ç¥¨çº¿ç¨‹1å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:10å¼ ç¥¨çº¿ç¨‹1å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:9å¼ ç¥¨çº¿ç¨‹2å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:8å¼ ç¥¨çº¿ç¨‹1å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:7å¼ ç¥¨çº¿ç¨‹2å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:6å¼ ç¥¨çº¿ç¨‹1å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:5å¼ ç¥¨çº¿ç¨‹2å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:4å¼ ç¥¨çº¿ç¨‹1å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:3å¼ ç¥¨çº¿ç¨‹2å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:2å¼ ç¥¨çº¿ç¨‹1å‡†å¤‡ä¹°ç¥¨ å‰©ä½™:1å¼ ç¥¨çº¿ç¨‹2: ç¥¨å·²å–å®Œ å‰©ä½™:0å¼ ç¥¨çº¿ç¨‹1: ç¥¨å·²å–å®Œ å‰©ä½™:-1å¼ ç¥¨ è§‚å¯Ÿç»“æžœï¼Œæˆ‘ä»¬å‘çŽ°äº†ä¸€äº›é—®é¢˜:(1) ä¸¤æ¬¡ä¹°ç¥¨è¿‡ç¨‹ä½™ç¥¨æ•°ç›¸åŒ(2) åŒä¸€å¼ ç¥¨ä¹°äº†ä¸¤æ¬¡(3) æ²¡æœ‰ä½™ç¥¨ä¹‹åŽä»ç„¶è¢«ä¹°äº†ä¸€æ¬¡ è¿™æ ·çš„ç»“æžœå·²ç»ä½“çŽ°å‡ºäº†çº¿ç¨‹ä¸å®‰å…¨çš„å±å®³ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºçŽ°è¿™ç§æƒ…å†µå‘¢ï¼Ÿå‰é¢è®²åˆ°ï¼ŒCPUä¼šåœ¨æ—¶é—´ç‰‡ç»“æŸåŽä¿å­˜å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ‡æ¢è‡³ä¸‹ä¸€çº¿ç¨‹ã€‚é‚£ä¹ˆå½“å‰çº¿ç¨‹å¾ˆå¯èƒ½åœ¨èŽ·å–äº†æ•°æ®è¿˜æ²¡æ¥å¾—åŠå¤„ç†ï¼Œæ—¶é—´ç‰‡å°±å·²ç»“æŸï¼Œè€Œå½“è¯¥çº¿ç¨‹çš„ä¸‹ä¸€æ—¶é—´ç‰‡åˆ°æ¥æ—¶ï¼Œæ•°æ®å¯èƒ½å·²ç»å˜åŒ–äº†ã€‚ä¸€ç§å¯èƒ½çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º è¿™ä¾¿æ˜¯è¿›ç¨‹/çº¿ç¨‹å¹¶å‘è®¿é—®æ•°æ®æ—¶ä¼šå­˜åœ¨çš„åŒæ­¥é—®é¢˜ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬è®¨è®ºå¦‚ä½•è§£å†³è¯¥é—®é¢˜ã€‚ ä¸´ç•ŒåŒºé—®é¢˜ä¸ºäº†å¹¶å‘è®¿é—®æ•°æ®çš„åŒæ­¥é—®é¢˜ï¼Œæˆ‘ä»¬ä»‹ç»ä¸´ç•ŒåŒºçš„æ¦‚å¿µã€‚ ä¸´ç•ŒåŒº: ä¸€ç§ä»£ç æ®µï¼Œåœ¨å…¶ä¸­å¯èƒ½å‘ç”Ÿå¤šä¸ªçº¿ç¨‹å…±åŒæ”¹å˜å˜é‡ã€è¯»å†™æ–‡ä»¶ç­‰æ“ä½œï¼Œå…¶è¦æ±‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›å…¥ã€‚ä»Žè€Œé¿å…å‡ºçŽ°åŒæ—¶è¯»å†™çš„é—®é¢˜ã€‚(å®žé™…ä¸Šï¼Œä¸´ç•ŒåŒºåªéœ€ä¿è¯å¯ä»¥æœ‰å¤šä¸ªè¯»è€…åŒæ—¶æ‰§è¡Œè¯»å–æ“ä½œï¼Œæˆ–å”¯ä¸€å†™è€…æ‰§è¡Œå†™å…¥æ“ä½œ)è¿›å…¥åŒº: åˆ¤æ–­çº¿ç¨‹èƒ½å¦è¿›å…¥ä¸´ç•ŒåŒºçš„ä»£ç æ®µã€‚é€€å‡ºåŒº: çº¿ç¨‹ç¦»å¼€ä¸´ç•ŒåŒºåŽå¯èƒ½å¯¹å…¶æ‰§è¡Œçš„æŸäº›æ“ä½œã€‚å‰©ä½™åŒº: çº¿ç¨‹å®Œå…¨é€€å‡ºä¸´ç•ŒåŒºå’Œé€€å‡ºåŒºåŽçš„å‰©ä¸‹å…¨éƒ¨ä»£ç ã€‚ å¯¹äºŽä¸Šè¿°çš„ä¹°ç¥¨ç¤ºä¾‹ï¼Œä¹°ç¥¨çš„æ•´ä¸ªè¿‡ç¨‹å³ä¸ºä¸´ç•ŒåŒºä»£ç ï¼Œä½†æˆ‘ä»¬ç¼ºå¤±äº†è¿›å…¥åŒºï¼Œæ— æ³•ä¿è¯ä¸´ç•ŒåŒºå†…çº¿ç¨‹çš„å”¯ä¸€ï¼Œæ‰€ä»¥å‡ºçŽ°äº†åŒæ­¥é—®é¢˜ã€‚ ä¸´ç•ŒåŒºè°ƒåº¦åŽŸåˆ™æ‰€æœ‰ä¸´ç•ŒåŒºè°ƒåº¦åº”å½“ç¬¦åˆä»¥ä¸‹åŽŸåˆ™: åŒä¸€æ—¶é—´ä¸´ç•ŒåŒºå†…ä»…å¯æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æžœæœ‰è‹¥å¹²çº¿ç¨‹è¯·æ±‚è¿›å…¥ç©ºé—²ä¸´ç•ŒåŒºï¼Œä¸€æ¬¡è¿›å…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå¦‚æžœä¸´ç•ŒåŒºå·²æœ‰çº¿ç¨‹ï¼Œåˆ™è¦æ±‚å…¶ä»–è§†å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹ç­‰å¾…ã€‚ è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹å¿…é¡»åœ¨æœ‰é™æ—¶é—´å†…é€€å‡ºï¼Œä»¥ä¿è¯å…¶ä»–çº¿ç¨‹èƒ½è¿›å…¥è¯¥ä¸´ç•ŒåŒºã€‚ å¦‚æžœçº¿ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œåº”è®©å‡ºCPUï¼Œé¿å…å‡ºçŽ°å¿™ç­‰çŽ°è±¡ã€‚ ä»Žçº¿ç¨‹è¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºåˆ°å…è®¸ï¼Œæœ‰æ¬¡æ•°é™åˆ¶ï¼Œé¿å…è®©çº¿ç¨‹æ— é™ç­‰å¾…ã€‚ æ€»ç»“ä¸ºä¸‰ç‚¹: äº’æ–¥ã€å‰è¿›ã€æœ‰é™ç­‰å¾…ã€‚ Tips: åœ¨éžæŠ¢å å†…æ ¸ç³»ç»Ÿä¸­è¿›ç¨‹ä¼šä¸€ç›´è¿è¡Œç›´åˆ°ä¸­æ–­æˆ–é€€å‡ºï¼Œæ•…ä¸æ¶‰åŠè¿›ç¨‹åŒæ­¥é—®é¢˜ã€‚ ä¸´ç•ŒåŒºé—®é¢˜çš„è§£å†³æ–¹æ³•è§£å†³ä¸´ç•ŒåŒºé—®é¢˜ï¼Œéœ€è¦é€šè¿‡åŠ é”çš„æ–¹å¼ï¼Œç±»ä¼¼äºŽå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºåŽå³ä¸Šé”ï¼Œé˜»æ­¢å…¶ä»–çº¿ç¨‹è¿›å…¥ï¼Œå¾…è¿è¡Œå®ŒæˆåŽæ‰“å¼€é”å…è®¸å…¶ä»–çº¿ç¨‹è¿›å…¥ã€‚ è½¯ä»¶å®žçŽ°æ–¹æ³•è§£å†³ä¸´ç•ŒåŒºé—®é¢˜ï¼Œä¸»è¦åœ¨äºŽä¿è¯èµ„æºçš„äº’æ–¥è®¿é—®ï¼Œä»¥åŠé¿å…å‡ºçŽ°é¥¥é¥¿çŽ°è±¡ã€‚ Petersonç®—æ³•æä¾›äº†ä¸€ä¸ªåˆç†çš„æ€è·¯: è®¾ç½®æ——æ ‡æ•°ç»„flagæ ‡è®°è¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹ï¼Œè®¾ç½®turnè¡¨ç¤ºå¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹ï¼Œåœ¨è¿›å…¥åŒºè¿›è¡ŒåŒé‡åˆ¤æ–­ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹turnèµ‹å€¼åªä¼šæœ‰ä¸€ä¸ªä¿ç•™ä¸‹æ¥ï¼Œä»Žè€Œç¡®ä¿èµ„æºè®¿é—®çš„äº’æ–¥ã€‚è€Œåœ¨é€€å‡ºåŒºï¼Œå¯¹flagæ——æ ‡è¿›è¡Œäº†falseå¤„ç†ï¼Œä»Žè€Œä¿è¯äº†â€å‰è¿›â€åŽŸåˆ™ï¼Œé¿å…äº†å‰©ä½™åŒºä¸­çš„çº¿ç¨‹æŒç»­æŠ¢å é€ æˆå…¶ä»–çº¿ç¨‹é¥¥é¥¿ã€‚ ç¡¬ä»¶å®žçŽ°æ–¹æ³•Petersonç®—æ³•æ˜¯åŸºäºŽè½¯ä»¶çš„å®žçŽ°ï¼Œè€Œä»Žç¡¬ä»¶å±‚é¢ä¹Ÿå¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œç¡¬ä»¶æ–¹é¢çš„å¤„ç†ä¸»è¦åœ¨äºŽçº¿ç¨‹ä¿®æ”¹å…±äº«èµ„æºæ—¶æ˜¯åŽŸå­åœ°ï¼Œå³ä¸å¯è¢«ä¸­æ–­ã€‚æ¯”å¦‚æœºå™¨æä¾›äº†èƒ½å¤ŸåŽŸå­æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„ä¿®æ”¹å¸ƒå°”å˜é‡æ¥å®žçŽ°äº’æ–¥ï¼Œå› ä¸ºåŠ é”çš„è¿‡ç¨‹æ˜¯åŽŸå­çš„ã€‚è€Œå¯¹äºŽå¯èƒ½é€ æˆé¥¥é¥¿çš„é—®é¢˜ï¼Œåªéœ€åœ¨é€€å‡ºåŒºå¯¹ç­‰å¾…åˆ—è¡¨è¿›è¡Œä¸€å®šå¤„ç†ï¼Œä¿è¯â€å‰è¿›â€åŽŸåˆ™å³å¯ã€‚ ç®€å•æ¥è¯´ï¼Œæ— è®ºç¡¬ä»¶è¿˜æ˜¯è½¯ä»¶çš„å®žçŽ°ï¼Œæœ¬è´¨éƒ½æ˜¯é€šè¿‡åŠ é”ã€‚åªæ˜¯é€šè¿‡ç¡¬ä»¶çš„ç‰¹æ€§ï¼Œå¯ä»¥æé«˜æ•ˆçŽ‡ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†ä¸´ç•ŒåŒºçš„å®žçŽ°éš¾åº¦ã€‚ ä¿¡å·é‡ä¸´ç•ŒåŒºé—®é¢˜ä¸ºæˆ‘ä»¬è§£å†³çº¿ç¨‹åŒæ­¥æä¾›äº†ä¸€ç§æ€è·¯ï¼Œè€Œåœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œè¦å¤„ç†åŒä¸€ä¸ªå®žä¾‹æœ‰å¤šä¸ªèµ„æºçš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ç§è¾ƒä¸ºç®€å•çš„æ–¹å¼â€”â€”ä¿¡å·é‡ï¼Œå¤§å¤šæ“ä½œç³»ç»Ÿéƒ½æä¾›äº†ä¿¡å·é‡çš„åŒæ­¥å·¥å…·ã€‚ åŽŸç†ç®€å•æ¥è¯´ï¼Œä¿¡å·é‡æ˜¯æŸä¸ªå®žä¾‹å¯ç”¨èµ„æºçš„è®¡æ•°ï¼Œåˆå§‹ä¸ºè¯¥å®žä¾‹å¯ç”¨èµ„æºçš„æ•°é‡ï¼Œè€Œæ¯å½“çº¿ç¨‹éœ€è¦ä½¿ç”¨ï¼Œåˆ™è°ƒç”¨wait()æ–¹æ³•å‡å°‘ä¿¡å·é‡ï¼Œé‡Šæ”¾èµ„æºæ—¶è°ƒç”¨signal()æ–¹æ³•å¢žåŠ ä¿¡å·é‡ï¼Œæ•…ä¿¡å·é‡ä¸º0è¡¨ç¤ºæ‰€æœ‰èµ„æºéƒ½åœ¨è¢«ä½¿ç”¨ï¼Œçº¿ç¨‹ä½¿ç”¨èµ„æºçš„è¯·æ±‚ä¸è¢«å…è®¸ã€‚ ä¿¡å·é‡ä¸»è¦åˆ†ä¸ºè®¡æ•°ä¿¡å·é‡å’ŒäºŒè¿›åˆ¶ä¿¡å·é‡ï¼Œå‰è€…ä¸»è¦é’ˆå¯¹ä¸€ä¸ªå®žä¾‹æœ‰å¤šä¸ªèµ„æºçš„æƒ…å†µï¼Œå€¼åŸŸä¸å—é™åˆ¶ï¼Œè€ŒåŽè€…ä¿¡å·é‡ä»…ä¸º0æˆ–1ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ä¹‹é—´è®¿é—®è¯¥èµ„æºæ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå¯ç§°ä½œäº’æ–¥é”ã€‚ åŒä¸´ç•ŒåŒºé—®é¢˜çš„å‰æ: å¿…é¡»ä¿è¯æ‰§è¡Œä¿¡å·é‡æ“ä½œwait(),signal()æ˜¯åŽŸå­åœ°ã€‚ ä»¥ä¸‹æ˜¯ä¿¡å·é‡çš„ä¼ªä»£ç å®žçŽ°:123456while (true) &#123; waiting(mutex); // å‡å°‘ä¿¡å·é‡(è¿›å…¥åŒº) // ä¸´ç•ŒåŒº signal(mutex); // å¢žåŠ ä¿¡å·é‡(é€€å‡ºåŒº) // å‰©ä½™åŒº&#125; å…·ä½“å®žçŽ°ç”±äºŽåŸºäºŽä¸´ç•ŒåŒºé—®é¢˜ï¼Œé‚£ä¹ˆä¿¡å·é‡åœ¨å…·ä½“å®žçŽ°ä¸­ä¹Ÿè¦å¤„ç†å…¶ç¼ºç‚¹: é¥¥é¥¿é—®é¢˜ã€‚åŒæ—¶å…¶éœ€è¦é¿å…å¿™ç­‰é—®é¢˜å’Œæ­»é”é—®é¢˜ã€‚ åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å…¶åŸºæœ¬åŠŸèƒ½å®žçŽ°ã€‚ å®žçŽ°ä¿¡å·é‡éœ€è¦ç»´æŠ¤ä¸€ä¸ªä¿¡å·é‡å€¼å’Œä¸€ä¸ªç­‰å¾…è¿›ç¨‹é“¾è¡¨ã€‚å½“ä¿¡å·é‡ä¸º0æ—¶ï¼Œå°†è¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹æ”¾å…¥ç­‰å¾…åˆ—è¡¨ä¸­ï¼Œå¹¶é˜»å¡žè‡ªå·±(é¿å…å‡ºçŽ°é¢‘ç¹å¾ªçŽ¯è¯·æ±‚çš„å¿™ç­‰é—®é¢˜)ã€‚å¾…å…¶ä»–ä¸´ç•ŒåŒºé€€å‡ºæ—¶ï¼Œä»Žç­‰å¾…åˆ—è¡¨ä¸­å–å‡ºå¹¶å”¤é†’ã€‚ä»¥ä¸‹ä¸ºå®žçŽ°çš„ä¼ªä»£ç : 1234567891011121314151617181920212223// ä¿¡å·é‡å®šä¹‰typedef struct &#123; int value; struct process *list;&#125; semaphore;// å‡å°‘ä¿¡å·é‡void wait(semaphore *mutex) &#123; mutex-&gt;value--; // å‡å°‘ä¿¡å·é‡å€¼ if (mutex-&gt;value &lt; 0) &#123; addToList(list, mutex); // å°†è¯¥è¿›ç¨‹æ·»åŠ è‡³ç­‰å¾…è¿›ç¨‹é“¾è¡¨ block(); // é˜»å¡žè‡ªå·±ç­‰å¾…å”¤é†’ &#125;&#125;// å¢žåŠ ä¿¡å·é‡void signal(semaphore *mutex) &#123; mutex-&gt;value++; // å¢žåŠ ä¿¡å·é‡ if (mutex-&gt;value &lt;= 0) &#123; process *p = removeFromList(list ,mutex); // åŒç­‰å¾…é“¾è¡¨ä¸­å–å‡ºä¸€ä¸ªè¿›ç¨‹ wakeup(P); // å”¤é†’ç­‰å¾…ä¸­çš„è¿›ç¨‹ &#125;&#125; é¥¥é¥¿é—®é¢˜åœ¨ä¿¡å·é‡å¤§äºŽ0æ—¶ä»Žé˜Ÿåˆ—ä¸­å–å‡ºå“ªä¸ªè¿›ç¨‹æ˜¯éœ€è¦è®¨è®ºçš„é—®é¢˜ï¼Œé€‰æ‹©åˆé€‚çš„è°ƒåº¦æ–¹å¼å¾ˆé‡è¦ã€‚FIFO(å…ˆè¿›å…ˆå‡º)å¯ä»¥è§£å†³ï¼Œä½†å¦‚æžœLIFO(åŽè¿›å…ˆå‡º)è°ƒåº¦åˆ™å¯èƒ½ä¼šé€ æˆéƒ¨åˆ†è¿›ç¨‹æ— é™æœŸé˜»å¡žï¼Œä¹Ÿå°±æ˜¯é¥¥é¥¿é—®é¢˜ã€‚ å¿™ç­‰é—®é¢˜å½“è¿›ç¨‹è¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºè€Œæ²¡æœ‰è¢«å…è®¸æ—¶ï¼Œå¦‚æžœæ­¤è¿›ç¨‹å¼€å§‹åœ¨è¿›å…¥åŒºè¿žç»­å¾ªçŽ¯è¯·æ±‚ï¼Œåˆ™ä¼šæ¶ˆè€—å¤§é‡æ€§èƒ½ï¼Œæµªè´¹äº†éƒ¨åˆ†CPUæ—¶é—´ç‰‡ã€‚è¿™ç§åŠ é”æ–¹å¼ç§°ä¸ºè‡ªæ—‹é”ï¼Œå³è¿›ç¨‹åœ¨ç­‰å¾…é”æ—¶ä»ç„¶åœ¨è¿è¡Œï¼Œæ­¤æ–¹æ³•ä¼šé€ æˆå¿™ç­‰çš„æ€§èƒ½æµªè´¹ï¼Œä½†åŒæ—¶ä¹Ÿæ¯”é˜»å¡ž-å”¤é†’æœºåˆ¶æ•ˆçŽ‡æ›´é«˜ï¼Œé¿å…äº†é˜»å¡žåˆ°å”¤é†’çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ å¦‚æžœè¦å…‹æœå¿™ç­‰é—®é¢˜ï¼Œå¯ä»¥åœ¨è¿›å…¥åŒºå¢žåŠ å½“ä¿¡å·é‡å°äºŽ0æ—¶ï¼Œè¿›ç¨‹é˜»å¡žè‡ªå·±ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼›å½“ä¸´ç•ŒåŒºå†…çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åŽï¼Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ã€‚åŒæ—¶è¦ä¿è¯ç­‰å¾…é˜Ÿåˆ—è°ƒåº¦çš„ç®—æ³•åˆç†æ€§ï¼Œé¿å…æŸè¿›ç¨‹æ— é™æœŸç­‰å¾…ã€‚ æ­»é”é—®é¢˜æ­»é”é—®é¢˜å°±æ˜¯å¤šä¸ªè¿›ç¨‹æ— é™ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼Œè€Œè¯¥äº‹ä»¶æ˜¯ç”±è¿™äº›è¿›ç¨‹æ¥äº§ç”Ÿçš„ï¼Œè¿™æ ·å°±ä¼šé€ æˆâ€ç¬¬äºŒåäºŒæ¡å†›è§„â€ä¸­çš„é—®é¢˜ï¼Œè¿›ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…ï¼Œæ— æ³•å‰è¿›ã€‚åœ¨æ­¤ä¸è®¨è®ºæ­»é”é—®é¢˜ï¼Œåªä»‹ç»å¯èƒ½å‡ºçŽ°çš„æ­»é”æƒ…å†µã€‚å¦‚ä¸‹å›¾æ‰€ç¤º: è§£å†³æ­»é”é—®é¢˜ä¸»è¦å¯ä»¥ä»Žæ­»é”é¢„é˜²ã€æ­»é”é¿å…ã€æ­»é”æ£€æµ‹ã€æ­»é”æ¢å¤å››ä¸ªæ–¹é¢å…¥æ‰‹ï¼ŒåŽé¢ä¼šä¸“é—¨å†™æ–‡ç« è®²è§£ã€‚ ä¸åŒå¤„ç†å™¨çš„è§£å†³æ–¹æ¡ˆå•ä¸ªå¤„ç†å™¨: å•å¤„ç†å™¨æ—¶æ— é¡»æ‹…å¿ƒå¹¶è¡Œè¿ç®—é€ æˆçš„åŒæ­¥é—®é¢˜ï¼Œæ‰€ä»¥ç®€å•åœ¨wait()å’Œsignal()ä¸­ç¦æ­¢ä¸´ç•ŒåŒºä¸­è¿›ç¨‹çš„ä¸­æ–­å³å¯ã€‚ å¤šå¤„ç†å™¨: æ“ä½œç³»ç»Ÿå¯¹äºŽå¤šå¤„ç†å™¨è°ƒåº¦åˆ†ä¸ºSMPå’ŒéžSMPçš„æƒ…å†µ(SMPä¸ºå¯¹ç§°å¤šå¤„ç†ï¼Œå¤„ç†å™¨å„è‡ªæŽ§åˆ¶å„è‡ªçš„è°ƒåº¦ï¼Œè€ŒéžSMPä¸ºæŸä¸€ä¸ªå¤„ç†å™¨ä½œä¸ºä¸­æŽ§ï¼Œç®¡ç†å…¶ä»–å¤„ç†å™¨çš„è°ƒåº¦)ã€‚ éžå¯¹ç§°å¤šå¤„ç†: å¯¹äºŽéžå¯¹ç§°å¤šå¤„ç†ï¼Œç”±äºŽæœ‰ä¸­å¤®å¤„ç†å™¨æ¥è°ƒåº¦ï¼Œå¯ä»¥ç®€å•ä½¿ç”¨è‡ªæ—‹é”æ¥è¿›è¡Œå¿™ç­‰ï¼Œç³»ç»Ÿæ¥å†³ç­–ç­‰å¾…é”çš„è¿›ç¨‹çš„è°ƒåº¦é—®é¢˜ã€‚å¯¹ç§°å¤šå¤„ç†: å¯¹äºŽå¯¹ç§°å¤šå¤„ç†ç³»ç»Ÿï¼Œå°±è¦è‡ªè¡Œå®žçŽ°ä¸Šè¿°çš„ä¿¡å·é‡ç­‰å¾…åˆ—è¡¨ï¼Œä»¥åŠç­‰å¾…é”æ—¶çš„é˜»å¡žâ€”â€”å”¤é†’æœºåˆ¶ã€‚ ç»å…¸åŒæ­¥é—®é¢˜æ¶‰åŠåˆ°åŒæ­¥é—®é¢˜ï¼Œæœ‰å‡ ç§ç»å…¸çš„é—®é¢˜ï¼Œä¸»è¦çš„æœ‰è¯»è€…â€”â€”å†™è€…é—®é¢˜å’Œå“²å­¦å®¶è¿›é¤é—®é¢˜ï¼Œå‰è€…å…³æ³¨äº’æ–¥é—®é¢˜ï¼ŒåŽè€…å…³æ³¨æ­»é”é—®é¢˜ã€‚ è¯»è€…â€”â€”å†™è€…é—®é¢˜ä»…è¿›è¡Œè¯»å–æ“ä½œçš„ä¸ºè¯»è€…ï¼Œè€Œè¯»å†™æ“ä½œå‡éœ€è¦çš„ä¸ºå†™è€…ã€‚ä»ç„¶ä»¥åˆšæ‰çš„ä¹°ç¥¨é—®é¢˜ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¸éš¾å‘çŽ°ï¼Œå½“åŒæ—¶è¯»å–æ—¶ï¼Œä¸ä¼šå‡ºçŽ°é—®é¢˜ï¼Œå½“å”¯ä¸€å†™å…¥æ—¶ï¼Œä¹Ÿä¸ä¼šå‡ºçŽ°é—®é¢˜ï¼Œä½†æ˜¯å½“åŒæ—¶è¿›è¡Œè¯»å†™æ—¶ï¼Œåˆ™å‘ç”Ÿäº†æ•°æ®é”™è¯¯é—®é¢˜ã€‚ æ‰€ä»¥è¯»è€…â€”â€”å†™è€…é—®é¢˜åº”å½“ä¿è¯åŒä¸€æ—¶é—´å†™è€…çš„å”¯ä¸€æ€§åŠè¯»è€…è¦ç­‰å¾…å†™è€…å®ŒæˆåŽå†æ‰§è¡Œã€‚ åŒæ—¶ï¼Œåœ¨å®žé™…å®žçŽ°ä¸­ï¼Œè¦ç€é‡å¤„ç†è¯»è€…æˆ–å†™è€…çš„é¥¥é¥¿é—®é¢˜ï¼Œè¯»è€…/å†™è€…ä¼˜å…ˆçš„æ–¹æ¡ˆå¾ˆå¯èƒ½é€ æˆå¯¹æ–¹çš„é¥¥é¥¿ã€‚ å“²å­¦å®¶è¿›é¤é—®é¢˜å“²å­¦å®¶é—®é¢˜æ˜¯ä¸€ä¸ªç»å…¸çš„æ­»é”é—®é¢˜ï¼Œnä¸ªå“²å­¦å®¶å›´ååœ¨åœ†æ¡Œä¸Šï¼Œåœ†æ¡Œä¸Šæ”¾ç€næ”¯ç­·å­ï¼Œä¹Ÿå°±æ˜¯æ²¡äººå·¦å³éƒ½æœ‰1æ”¯ç­·å­ã€‚åªæœ‰åŒæ—¶æ‹¥æœ‰ä¸¤æ”¯ç­·å­æ‰èƒ½åƒé¥­ï¼Œåƒå®Œé¥­åŽä¼šæ”¾ä¸‹ç­·å­ã€‚è‹¥åŒä¸€æ—¶é—´æ¯ä¸ªå“²å­¦å®¶éƒ½å…ˆæ‹¿èµ·å³æ‰‹è¾¹çš„ç­·å­å†æ‹¿èµ·å·¦æ‰‹çš„ï¼Œé‚£ä¹ˆå°±é€ æˆäº†æ­»é”é—®é¢˜ï¼Œæ¯ä¸ªäººéƒ½åœ¨ç­‰å¾…å·¦æ‰‹çš„ç­·å­ã€‚ è§£å†³åŠžæ³•å¤šç§å¤šæ ·ï¼Œå¯ä»¥é™åˆ¶å“²å­¦å®¶çš„æ•°é‡ä¸ºn-1ï¼Œä¹Ÿå¯ä»¥è¦æ±‚æ‹¿èµ·ç­·å­å‰åˆ¤æ–­æ˜¯å¦å·¦å³æ‰‹çš„ç­·å­å‡ç©ºé—²ã€‚è€Œæœ¬è´¨ä¸Šï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æ­»é”çš„å››ç§è§£å†³æ–¹æ³•: æ­»é”é¢„é˜²ã€æ­»é”é¿å…ã€æ­»é”æ£€æµ‹ã€æ­»é”æ¢å¤ã€‚ æ€»ç»“è¿›ç¨‹/çº¿ç¨‹åŒæ­¥é—®é¢˜æ˜¯æ“ä½œç³»ç»Ÿåœ¨æ•°æ®å…±äº«æ–¹é¢çš„ä¸€å¤§é—®é¢˜ï¼Œå…¶ä¸ä»…éœ€è¦ç¡¬ä»¶åŠç³»ç»Ÿçº§çš„å®žçŽ°ï¼ŒåŒæ—¶è¿˜éœ€è¦ç¨‹åºå‘˜åœ¨å¼€å‘æ—¶é¿å…æ­»é”ï¼ŒåŒæ­¥é—®é¢˜ä¸Žæ­»é”é—®é¢˜å¯†ä¸å¯åˆ†ï¼ŒåŽé¢å°†ä¼šè®¨è®ºæ­»é”é—®é¢˜ã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>åº•å±‚</tag>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ›å»ºè‡ªå·±çš„CocoaPodsåº“å¹¶æäº¤æŒ‡å—]]></title>
    <url>%2F2017%2F12%2F30%2F%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84CocoaPods%E5%BA%93%E5%B9%B6%E6%8F%90%E4%BA%A4%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[å‰è¨€CocoaPodsæ˜¯ä¸€æ¬¾å¾ˆæ£’çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œåœ¨å¼€å‘ä¸­ä¹Ÿç»å¸¸ç”¨å®ƒæ¥å¯¼å…¥å¼€æºç¬¬ä¸‰æ–¹åº“ã€‚æœ€è¿‘ä¹Ÿæƒ³æŠŠè‡ªå·±çš„ä¸€äº›åº“å¼€æºå¹¶åŠ å…¥CocoaPodsä¸­ï¼Œç‰¹æ€»ç»“ä¸€ä¸‹è‡ªå·±åˆ¶ä½œCocoaPodsåº“çš„è¿‡ç¨‹ã€‚ å‰æåœ¨åˆ¶ä½œä¹‹å‰ï¼Œä½ éœ€è¦ï¼š æŽŒæ¡CocoaPodsçš„åŸºæœ¬ä½¿ç”¨ æŽŒæ¡Gitçš„ç®€å•ä½¿ç”¨ å‡†å¤‡å¥½è‡ªå·±è¦å¼€æºçš„æˆå“ å¼€å§‹åˆ¶ä½œä¸‹é¢æˆ‘ä»¬å¼€å§‹åˆ¶ä½œè‡ªå·±çš„å¼€æºåº“ï¼Œä»¥ä¸ªäººçš„MCScratchImageViewä¸ºä¾‹ã€‚ æŽ¨é€è‡³Gitä»“åº“(Github)é¦–å…ˆéœ€è¦å°†ä½ çš„å¼€æºæ¡†æž¶ä¸Šä¼ è‡³è¿œç¨‹ä»“åº“ï¼Œæ¯”å¦‚Githubï¼Œä½¿ç”¨æ–¹å¼ä¸å†èµ˜è¿°ã€‚è®°å½•ä¸‹ä½ è¦ä½¿ç”¨çš„commitç‰ˆæœ¬å¯¹åº”çš„SHAå€¼ã€‚å¦‚ä¸‹å›¾ï¼š ä¸ºæ‰€é€‰ç‰ˆæœ¬æ‰“tagåœ¨Githubè‡ªå¸¦tagåŠŸèƒ½åœ¨Githubä¸Šä¸ºé¡¹ç›®æ‰“tagå¯åœ¨releaseé¡µé¢ï¼Œé€‰æ‹©åˆ›å»ºæ–°tagå¹¶æŒ‰ä¸‹å›¾æ‰€ç¤ºå¡«å†™å³å¯ã€‚åˆ é™¤tagä¹ŸåŒç†ã€‚ç”±äºŽCocoaPodsçš„ç‰ˆæœ¬ä¿¡æ¯ä»…æ”¯æŒæ•°å­—çš„æ ¼å¼(å¦‚1.0.0)ï¼Œæ‰€ä»¥ç‰ˆæœ¬å·è¯·å‹¿å¸¦æœ‰å…¶ä»–ç‰¹æ®Šç¬¦å·å’Œå­—æ¯ã€‚ ä½¿ç”¨å‘½ä»¤è¡Œä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œç‰ˆæœ¬ç®¡ç†è¾ƒä¸ºæ–¹ä¾¿ï¼Œç®€å•æ­¥éª¤ä¸º: åˆ›å»ºæœ¬åœ°tag -&gt; å°†tagæŽ¨è‡³è¿œç¨‹ä»“åº“ã€‚ å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š1234// åˆ›å»ºæœ¬åœ°taggit tag -a 1.0.0 0c3b62d -m "Release Edition v1.0.0"// åŒæ­¥åˆ°è¿œç¨‹ä»“åº“git push origin 1.0.0 å…·ä½“Tagçš„ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒä½¿ç”¨Gitæ·»åŠ tagçš„æ–¹æ³• åˆ¶ä½œPodspecæè¿°æ–‡ä»¶ç”ŸæˆPodspecé¦–å…ˆåœ¨é¡¹ç›®ä¸»ç›®å½•è¾“å…¥ä¸€ä¸‹å‘½ä»¤pod spec create &lt;ä½ çš„é¡¹ç›®å&gt; è¯¥å‘½ä»¤ä¼šåœ¨ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª.podspecæ ¼å¼çš„æ–‡ä»¶ï¼ŒåŒ…å«äº†è¯¥æ¡†æž¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆ›å»ºCocoaPodsåº“çš„æ‰€æœ‰é…ç½®éƒ½å›´ç»•å®ƒæ¥å®Œæˆã€‚ é…ç½®Podspecæ–‡ä»¶ä½¿ç”¨ç¼–è¾‘å·¥å…·(å¦‚SublimeText)æ‰“å¼€è¯¥podspecæ–‡ä»¶ï¼Œæ–‡æ¡£ä¸­å·²ç»æœ‰è¯¦ç»†æè¿°ï¼Œåœ¨æ­¤ç®€å•è¯´æ˜Žä¸€ä¸‹å„å±žæ€§ä½œç”¨ï¼š s.name: æ¡†æž¶åç§° s.version: æ¡†æž¶æœ€æ–°ç‰ˆæœ¬å·ã€‚è¿™ä¸ªç‰ˆæœ¬å·å¯¹åº”äº†ä½ Gitä»“åº“ä¸­æŸä¸ªæäº¤çš„tagï¼Œå¦‚æžœä»“åº“ä¸­å¯¹åº”çš„tagä¸å­˜åœ¨åˆ™ä¼šæäº¤å¤±è´¥ã€‚ s.summary: æ¡†æž¶çš„æ¦‚è¿°ã€‚s.description: æ¡†æž¶çš„è¯¦ç»†ä»‹ç»ã€‚s.homepage: æ¡†æž¶å¯¹åº”é¡µé¢ï¼Œéšä¾¿å†™s.license: æ¡†æž¶çš„å¼€æºåè®®s.author: æ¡†æž¶ä½œè€…åŠé‚®ç®±ï¼Œè®¾ç½®æ–¹å¼è§æ³¨é‡Š s.platform: è¿™ä¸ªè¦æŒ‰æ³¨é‡Šå†™æ¸…æ”¯æŒçš„ç³»ç»Ÿå’Œç‰ˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿè¦ä¿è¯å®žé™…æƒ…å†µï¼Œæ¯”å¦‚Swift3.0æœ€ä½Žæ”¯æŒåˆ°iOS 8.0ï¼Œä½ å°±ä¸èƒ½å†™æœ€ä½Žæ”¯æŒiOS 7.0 s.source: å¯¹åº”çš„gitæºï¼Œåœ¨Github-&gt;Clone or download-&gt;Clone with HTTPSä¸­ s.source_files: åº“çš„æºä»£ç æ–‡ä»¶ã€‚è¿™ä¸ªæ˜¯é‡ç‚¹ï¼Œåº”è¯¥åŒ…å«å…¨éƒ¨ä½ çš„åº“æ‰€éœ€çš„æ–‡ä»¶ã€‚å¦‚&quot;s.source_files = MCScratchImageView/*.swift&quot;ä¸ºMCScratchImageViewæ–‡ä»¶å¤¹å†…çš„å…¨éƒ¨swiftä»£ç æ–‡ä»¶ã€‚æ³¨æ„é»˜è®¤ä¸º.hå’Œ.mæ–‡ä»¶ï¼Œéœ€è¦è®¾ç½®ä¸ºswiftçš„æ ¼å¼ã€‚å¯ä»¥è®¾ç½®å¤šä¸ªæ–‡ä»¶å‚æ•°ã€‚ s.framework: é¡¹ç›®æ‰€ç”¨åˆ°çš„åŽŸç”Ÿæ¡†æž¶ï¼Œå¦‚UIKit Framework s.dependency: é¡¹ç›®éœ€è¦çš„å…¶ä»–CocoaPodsåº“ï¼Œå¦‚s.dependency &quot;JSONKit&quot;, &quot;~&gt; 1.4&quot; éªŒè¯Podspecæ–‡ä»¶é…ç½®å®ŒPodspecæ–‡ä»¶ä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆéªŒè¯ä¸€ä¸‹æ–‡ä»¶æ˜¯å¦å¯ç”¨ã€‚ 1pod spec lint &lt;æ–‡ä»¶åç§°&gt;.podspec è‹¥æç¤º&lt;æ–‡ä»¶å&gt; passed validation.ï¼Œåˆ™éªŒè¯é€šè¿‡ã€‚ å‘å¸ƒåˆ°CocoaPods(Trunkæ–¹å¼)å®Œæˆäº†æ‰€æœ‰çš„åˆ¶ä½œä¹‹åŽï¼Œæˆ‘ä»¬çŽ°åœ¨å°†åº“å‘å¸ƒåˆ°CocoaPodsã€‚ä½¿ç”¨äº†å…¶è‡ªå¸¦çš„Trunkå·¥å…·è¿›è¡Œæäº¤ã€‚ æ³¨å†ŒTrunké¦–å…ˆéœ€è¦å°†æœ¬æœºæ³¨å†Œåˆ°trunk1pod trunk register &lt;E-mail&gt; '&lt;ç”¨æˆ·å&gt;' --description='&lt;è®¾å¤‡åˆ«å&gt;' æäº¤æ³¨å†ŒåŽï¼Œæ‰€å¡«å†™çš„é‚®ç®±å°†ä¼šæ”¶åˆ°ä¸€ä¸ªéªŒè¯é‚®ä»¶ï¼Œç¡®è®¤éªŒè¯å³å¯ã€‚ åŒæ—¶ä¹Ÿå¯ä»¥ä¸ºé¡¹ç›®æ·»åŠ å…¶ä»–ç»´æŠ¤è€…:1pod trunk add-owner &lt;åº“å&gt; &lt;å…¶ä»–ç»´æŠ¤è€…é‚®ç®±&gt; å¯ä»¥ä½¿ç”¨pod trunk meæ¥æŸ¥çœ‹å½“å‰è´¦æˆ·ä¿¡æ¯ã€‚ ä½¿ç”¨Trunkæäº¤é€šè¿‡é…ç½®å¥½çš„Podspecï¼Œæˆ‘ä»¬å¯ä»¥å°†åº“æäº¤åˆ°CocoaPodsä¸Šã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:1pod trunk push &lt;æ–‡ä»¶å&gt;.podspec æäº¤è¿‡ç¨‹ä¼šæ£€æŸ¥ä½ çš„ä»£ç èƒ½å¦æ­£ç¡®ç¼–è¯‘ã€ä»¥åŠPodspecæ˜¯å¦æ­£ç¡®é…ç½®ã€‚è‹¥æˆåŠŸå°†ä¼šæ˜¾ç¤ºç¥è´ºä¿¡æ¯ã€‚ æŸ¥çœ‹æäº¤åº“ä¿¡æ¯æˆ‘ä»¬å¯ä»¥åœ¨æäº¤æˆåŠŸåŽæŸ¥çœ‹æ˜¯åº“æ˜¯å¦å·²ç»åœ¨CocoaPodsä¸Šï¼Œå‘½ä»¤å¦‚ä¸‹:123pod search &lt;åº“å&gt;// å¦‚æžœæŸ¥æ‰¾ä¸åˆ°ï¼Œå¯ä»¥å°è¯•pod search &lt;åº“å&gt; --simple å¦‚æžœæ‰¾ä¸åˆ°ï¼Œå¯ä»¥å°è¯•12pod setuprm ~/Library/Caches/CocoaPods/search_index.json å¦‚æžœèƒ½æŸ¥çœ‹åˆ°åº“ä¿¡æ¯ï¼Œåˆ™è¯´æ˜Žä¸Šä¼ æˆåŠŸã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åº“çš„ä»‹ç»ä»¥åŠæ‰€æœ‰ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ åˆ é™¤åº“çš„æŒ‡å®šç‰ˆæœ¬å½“ä¸Šä¼ çš„åº“ç‰ˆæœ¬å·å·²å­˜åœ¨æ—¶ä¼šå‘ç”Ÿå†²çªï¼Œä¸èƒ½è¦†ç›–ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½å…ˆåˆ é™¤æŒ‡å®šç‰ˆæœ¬å†é‡æ–°æäº¤ã€‚1pod trunk delete &lt;åº“å&gt; &lt;ç‰ˆæœ¬å·&gt; ç¤ºä¾‹è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæŠŠè‡ªå·±çš„åº“æäº¤è‡³CocoaPodsï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡Podfileæ¥ä½¿ç”¨ã€‚ä¸‹é¢é™„ä¸€ä»½æœ¬äººCocoaPodsåº“çš„Podspecæ–‡ä»¶ä»¥ä¾›å‚è€ƒ, MCScratchImageView 123456789101112131415Pod::Spec.new do |s|s.name = "MCScratchImageView"s.version = "1.0.0"s.summary = "Custom ImageView like scratch card"s.description = &lt;&lt;-DESCA custom ImageView that is used to cover the surface of other view like a scratch card, user can swipe the mulch to see the view below.DESCs.homepage = "https://github.com/Minecodecraft/MCScratchImageView"s.license = "MIT"s.author = &#123; "Minecode" =&gt; "Minecoder@163.com" &#125;s.platform = :ios, "8.0"s.source = &#123; :git =&gt; "https://github.com/Minecodecraft/MCScratchImageView.git", :tag =&gt; "#&#123;s.version&#125;" &#125;s.source_files = "MCScratchImageView/MCScratchImageView.swift"s.framework = "UIKit"end å¦‚æœ‰é—®é¢˜ï¼Œå¯ä»¥å‘é€é‚®ä»¶è‡³ minecoder@163.comæ¬¢è¿Žå…±åŒæŽ¢è®¨iOSå¼€å‘é—®é¢˜]]></content>
      <categories>
        <category>å¼€æºæ¡†æž¶</category>
      </categories>
      <tags>
        <tag>Github</tag>
        <tag>CocoaPods</tag>
        <tag>OpenSource</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Objective-Cå¼€å‘ä¸­Clangçš„ä½¿ç”¨]]></title>
    <url>%2F2017%2F12%2F21%2FObjective-C%E5%BC%80%E5%8F%91%E4%B8%ADClang%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨Objective-Cå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶åœ¨äº†è§£æŸäº›åŠŸèƒ½çš„åº•å±‚å®žçŽ°æ—¶ï¼Œå¸¸ç”¨åˆ°Clangç¼–è¯‘å™¨çš„å‘½ä»¤ã€‚åœ¨æ­¤å¯¹å¸¸ç”¨å‘½ä»¤åšä¸ªç®€å•æ€»ç»“ã€‚ Clangçš„ç®€ä»‹Clangæ˜¯ä¸€ä¸ªCã€C++ã€Objective-Cå’ŒObjective-C++ç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘å™¨å‰ç«¯ï¼Œå…¶åŽç«¯ä¸ºåº•å±‚è™šæ‹Ÿæœº(LLVM)ã€‚æ˜¯ä¸€ä¸ªGCCçš„æ›¿ä»£å“ï¼Œä¹Ÿæ˜¯Xcodeçš„é¦–é€‰ç¼–è¯‘å™¨ã€‚ é€šè¿‡Clangï¼Œæˆ‘ä»¬å¯ä»¥åšä»€ä¹ˆï¼Ÿ ç¼–è¯‘OCä»£ç ï¼Œè¿™ä¹Ÿæ˜¯å®ƒçš„æœ¬èŒå·¥ä½œã€‚ å¯ä»¥å°†OCä»£ç è½¬åŒ–è‡³C++æˆ–æ±‡ç¼–ä»£ç ï¼Œä»Žè€Œçª¥æŽ¢OCæŸäº›ç‰¹æ€§çš„åº•å±‚å®žçŽ°ã€‚ åœ¨ç»ˆç«¯å¿«é€Ÿç¼–è¯‘ï¼Œå ç”¨è¾ƒå°‘å†…å­˜ï¼ŒåŒæ—¶å…·æœ‰è¯Šæ–­åŠŸèƒ½ã€‚ ç¼–è¯‘OCä»£ç é™¤äº†ä½¿ç”¨Xcodeç¼–è¯‘å·¥ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡Clangæ¥æ‰‹åŠ¨ç¼–è¯‘ã€‚ åœ¨Xcodeä¸­å¼€å‘é¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒProject-&gt;Targets-&gt;Build Phases-&gt;Compile Sourcesä¸­å¯¹åº”çš„æ–‡ä»¶æ ‡è®°å°±æ˜¯æŒ‡å®šè¯¥æ–‡ä»¶ä¸ºARC/Non-ARC(MRC)ã€‚å…¶ä¸­ARCå¯¹åº”-fobjc-arcï¼ŒMRCå¯¹åº”-fno-objc-arcã€‚è€Œåˆšæ‰è¯´åˆ°Clangå®žé™…å°±æ˜¯LLVMçš„å‰ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨clangä¸­ä½¿ç”¨åŒæ ·æŒ‡ä»¤æŒ‡å®šç¼–è¯‘æ–¹å¼ã€‚å¦‚ä¸‹æŒ‡ä»¤ï¼š ARCä¸‹ç¼–è¯‘æŒ‡ä»¤clang -fobjc-arc -framework Foundation main.m -o mainMRCä¸‹ç¼–è¯‘æŒ‡ä»¤clang -fno-objc-arc -framework Foundation main.m -o main -framwork [æ¡†æž¶å] å¯¹åº”æ‰€ä½¿ç”¨çš„æ¡†æž¶ -o [æ–‡ä»¶å] ä¸ºè¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶å æˆ‘ä»¬åœ¨.mæ–‡ä»¶ä¸­è¾“å‡º â€œHello,Worldâ€1234int main(int argc, const char * argv[]) &#123;NSLog(@&quot;Hello, World!&quot;);return 0;&#125; ç¼–è¯‘OCä»£ç ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠç»ˆç«¯æ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š è½¬æ¢ä¸ºC++ä»£ç OCåº•å±‚å®žçŽ°ä¸ºCï¼Œæ‰€ä»¥è¦ç ”ç©¶å…¶å±žæ€§ã€æ¶ˆæ¯æœºåˆ¶ã€Runtimeç­‰ç‰¹æ€§ï¼Œå°±è¦ç”¨åˆ°Clangçš„ä»£ç è½¬åŒ–ã€‚ å°†OCçš„.mæ–‡ä»¶è½¬åŒ–ä¸ºC++æºä»£ç clang -rewrite-objc main.m ç”Ÿæˆçš„cppå³ä¸ºOCçš„åº•å±‚å®žçŽ°ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯ç ”ç©¶å…¶åº•å±‚å®žçŽ°çš„å·¥ä½œäº†ã€‚ è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç é«˜çº§è¯­è¨€æœ€ç»ˆæ˜¯è¦è½¬åŒ–ä¸ºæ±‡ç¼–ç„¶åŽè½¬åŒ–ä¸º01ä¸²çš„ï¼ŒClangä¸ºæˆ‘ä»¬æä¾›äº†è½¬åŒ–ä¸ºæ±‡ç¼–çš„åŠŸèƒ½ã€‚ å°†OCçš„.mæ–‡ä»¶è½¬åŒ–ä¸ºæ±‡ç¼–æºä»£ç clang -S main.m ç”Ÿæˆçš„.så³ä¸ºå¯¹åº”çš„æ±‡ç¼–å®žçŽ°ã€‚ å…¶ä»–æŒ‡ä»¤ç”±äºŽå…¶ä»–æŒ‡ä»¤å¹¶ä¸å¸¸è§ï¼Œä¸å†èµ˜è¿°ï¼Œåˆ—ä¸¾éƒ¨åˆ†ä»¥ä¾›æŸ¥é˜…ã€‚ æŒ‡ä»¤ è¯´æ˜Ž -E é¢„ç¼–è¯‘ä»£ç (å³å¤„ç†å®å®šä¹‰) -C ä»…ç¼–è¯‘ä½†ä¸é“¾æŽ¥(ç”Ÿæˆ.oé“¾æŽ¥æ–‡ä»¶) -S ä»…ç¼–è¯‘ä¸æ±‡ç¼–(ç”Ÿæˆ.sæ±‡ç¼–ä»£ç æ–‡ä»¶) -o æ–‡ä»¶å é“¾æŽ¥ï¼Œè¾“å‡ºå¯æ‰§è¡Œæ–‡ä»¶ -g åœ¨å¯æ‰§è¡Œç¨‹åºä¸­åŒ…å«æ ‡å‡†è°ƒè¯•ä¿¡æ¯ -I è·¯å¾„ åœ¨å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„åˆ—è¡¨ä¸­æ·»åŠ dirç›®å½• -L è·¯å¾„ åœ¨åº“æ–‡ä»¶çš„æœç´¢è·¯å¾„åˆ—è¡¨ä¸­æ·»åŠ dirç›®å½• ç›¸å…³èµ„æ–™ Clang documentation]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Objective-C</tag>
        <tag>Clang</tag>
        <tag>Runtime</tag>
        <tag>åº•å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ¢ç©¶Objective-Cå±žæ€§å…³é”®å­—]]></title>
    <url>%2F2017%2F12%2F19%2F%E6%8E%A2%E7%A9%B6Objective-C%E5%B1%9E%E6%80%A7%E5%85%B3%E9%94%AE%E5%AD%97%2F</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨Objective-Cæ—¶ï¼Œé¢‘ç¹ç”¨åˆ°å±žæ€§å…³é”®å­—ã€‚æˆ‘ä»¬åº”è¯¥ç†è§£æ¯ç§å±žæ€§çš„æ„ä¹‰ï¼Œå¹¶äº†è§£ä¸€äº›ååº•å±‚çš„å®žçŽ°ï¼Œæ•…åœ¨æ­¤å¯¹OCçš„å±žæ€§å…³é”®å­—åšä¸ªæµ…æžã€‚ åŸºç¡€æ¦‚å¿µï¼šivarã€getterã€setteråœ¨Cè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯ç›´æŽ¥æ“ä½œæˆå‘˜å˜é‡ã€‚è€Œåœ¨Objective-Cä¸­ï¼Œä½¿ç”¨äº†â€œå±žæ€§â€è¿™ä¸€æ¦‚å¿µæ¥å°è£…å¯¹è±¡ä¸­çš„æ•°æ®ï¼ŒOCå¯¹è±¡ä¼šæŠŠéœ€è¦çš„æ•°æ®ä¿å­˜ä¸ºå„ç§å®žä¾‹å˜é‡ï¼ŒåŒæ—¶é€šè¿‡â€œå­˜å–æ–¹æ³•â€(Access Method)æ¥è¿›è¡Œè®¿é—®ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„getterå’Œsetterã€‚ æ‰€ä»¥ï¼Œivaræ˜¯å¯¹è±¡çš„å„ç§å®žä¾‹å˜é‡ï¼Œgetterç”¨äºŽèŽ·å–å˜é‡çš„å€¼ï¼Œsetterç”¨äºŽå†™å…¥å˜é‡çš„å€¼ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ ‡å‡†çš„ivar+getter+setteræ ·æ¿ä»£ç ï¼š1234567891011121314@interface Person: NSObject&#123; // ivarå£°æ˜Ž @private NSString *_myName;&#125;// getteræ–¹æ³•- (NSString *)myName &#123; return _myName;&#125;// setteræ–¹æ³•- (void)setMyName:(NSString *)newName &#123; _myName = newName;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·çš„ç»„åˆæ–¹å¼é€ æˆäº†ä»£ç çš„è‡ƒè‚¿ï¼Œå¤§å¤§é™ä½Žäº†å¼€å‘æ•ˆçŽ‡å’Œå¯è¯»æ€§ï¼Œå®žé™…å¼€å‘ä¸­ä½¿ç”¨ivar+getter+setterçš„æƒ…å†µå¹¶ä¸å¸¸è§ï¼Œè¿™å°±è¦å¼•å…¥@synthesizeå’Œ@propertyè¿™ä¸ªå…³é”®å­—ã€‚ @synthesizeè¿™ä¸ªå±žæ€§å·²ç»å¾ˆå°‘è§åˆ°äº†ï¼Œå®ƒæ˜¯å±žäºŽMRCå’Œ32bitæ—¶ä»£çš„äº§ç‰©ã€‚@synthesizeå±žæ€§ç”¨æ¥åˆæˆä¸€ä¸ªå±žæ€§ï¼Œå˜é‡åå¦‚æžœæ²¡æœ‰æ˜¾å¼å£°æ˜Žåˆ™é»˜è®¤æ·»åŠ ä¸€ä¸ªä¸‹åˆ’çº¿çš„å‰ç¼€(_å˜é‡å)ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨å£°æ˜Žå˜é‡åå¹¶å»ºç«‹ä¸Ž@propertyçš„å…³ç³»ã€‚ ä¸ºäº†åŠ æ·±ç†è§£ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹ä»£ç ï¼Œå®ƒçš„é€»è¾‘ä¸ºï¼šæ‰‹åŠ¨å£°æ˜Živarï¼Œä½¿ç”¨propertyå£°æ˜Žå­˜å–æ–¹æ³•ï¼Œä½¿ç”¨@synthesizeå»ºç«‹ivarå’Œpropertyçš„å…³ç³»ã€‚12345678910111213@interface SubClass ()&#123; // å£°æ˜Živar NSString *_myName;&#125;// å£°æ˜Žå±žæ€§(å¹¶åˆæˆgetter+setter)@property (nonatomic, copy) NSString* myName;@end@implementation SubClass// å»ºç«‹myNameå±žæ€§ä¸Ž_myNameæˆå‘˜å˜é‡çš„å…³ç³»@synthesize myName = _myName;@end å¯ä»¥çœ‹å‡º@synthesizeå’Œ@propertyå„è‡ªè´Ÿè´£çš„å·¥ä½œï¼Œè™½ç„¶è¿™äº›å·¥ä½œå·²ç»ç”±ç¼–è¯‘å™¨å¸®æˆ‘ä»¬åšäº†ï¼Œä½†æ˜¯ç†è§£è¿™ä¸€æ¦‚å¿µè¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚ çŽ°åœ¨æˆ‘ä»¬çŸ¥é“äº†çœç•¥@synthesizeå£°æ˜Žå®žé™…ä¸Šæ˜¯å› ä¸ºLLVMçš„Clangä¸ºåœ¨ARCæ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆ@synthesizeå£°æ˜Žï¼Œä½†æ˜¯è¿™ä»…é™äºŽ64ä½OCè¿è¡Œæ—¶ä¸­ï¼Œå½“ä½¿ç”¨32ä½ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦æ‰‹åŠ¨å£°æ˜Žï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®NS_BUILD_32_LIKE_64å®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ @dynamicç›¸å¯¹äºŽ@synthesizeï¼Œ@dynamicå‘Šè¯‰ç¼–è¯‘å™¨è¯¥å±žæ€§çš„getterå’Œsetterç”±ç¨‹åºå‘˜è‡ªè¡Œå®žçŽ°ï¼Œç¼–è¯‘å™¨ä¸å†è‡ªåŠ¨ç”Ÿæˆã€‚åœ¨è¿è¡Œæ—¶æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æžœæ‰¾ä¸åˆ°å¯¹åº”å­˜å–æ–¹æ³•ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚è¿™ä¾¿æ˜¯Runtimeä¸­çš„åŠ¨æ€ç»‘å®šã€‚ åŒæ—¶ï¼Œä½¿ç”¨äº†@dynamicä¿®é¥°åˆ™å¿…é¡»åŠ¨æ€ç”Ÿæˆæ–¹æ³•å®žçŽ°ï¼Œæ²¡æœ‰@dynamic myName = _myName;çš„è¯­æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡æœ‰åŠžæ³•é™æ€çš„å»ºç«‹getter/setterå¹¶è®¿é—®ä¸‹åˆ’çº¿å‰ç¼€çš„ivarã€‚å¯¹åº”çš„è§£å†³æ–¹æ³•æ˜¯æ¶ˆæ¯è½¬å‘å’ŒåŠ¨æ€æ–¹æ³•è§£æžï¼Œæœ¬æ–‡ä¸è¿‡å¤šè®¨è®ºã€‚ @propertyæœ¬è´¨ä¸Šæ¥è¯´ï¼Œ@propertyå®žé™…ä¸Šæ˜¯å‘ŠçŸ¥ç¼–è¯‘å™¨ä¸ºä½ çš„ivarç”Ÿæˆgetterå’Œsetterï¼Œå¹¶ä¸ç”Ÿæˆivarï¼Œè¦ç†è§£è¿™ä¸€ç‚¹ã€‚ä½†æ˜¯ç”±äºŽ@synthesizeæ— é¡»å†æ‰‹åŠ¨å£°æ˜Žï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨@propertyåŽå®žé™…ä¸Šæ˜¯å£°æ˜Žäº†ivar+getter+setterçš„æ ‡å‡†æ¨¡æ¿ã€‚ Runtimeä¸‹çš„å®šä¹‰æˆ‘ä»¬é¦–å…ˆåç¼–è¯‘ä¸ºcppä»£ç ï¼Œæœ‰å…³åç¼–è¯‘çš„å†…å®¹è¯·è§Objective-Cå¼€å‘ä¸­Clangçš„ä½¿ç”¨ã€‚ å¯ä»¥å‘çŽ°propertyåœ¨OCè¿è¡Œæ—¶ä¸­æ˜¯objc_property_tç±»åž‹çš„ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š123456typedef struct objc_property *objc_property_t;struct property_t &#123; const char *name; const char *attributes;&#125;; propertyç»“æž„ä½“æœ‰nameå’Œattributesä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œè€Œattributesåˆ™æ˜¯propertyçš„å±žæ€§å®šä¹‰ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„å®šä¹‰ï¼š12345/// Defines a property attributetypedef struct &#123; const char *name; /**&lt; The name of the attribute */ const char *value; /**&lt; The value of the attribute (usually empty) */&#125; objc_property_attribute_t; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•èŽ·å–å¯¹åº”å˜é‡ï¼š12345678// èŽ·å–æ‰€æœ‰å±žæ€§åˆ—è¡¨class_copyPropertyList// èŽ·å–å±žæ€§åproperty_getName// èŽ·å–å±žæ€§æè¿°å­—ç¬¦ä¸²property_getAttributes// èŽ·å–æ‰€æœ‰å±žæ€§åˆ—è¡¨property_copyAttributeList å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªattributeå¯¹åº”ä¸€ç§å±žæ€§ä¿®é¥°ç¬¦ï¼Œpropertyæ‰€å®šä¹‰çš„å±žæ€§å°±åŒ…å«å…¶ä¸­ã€‚å¯¹åº”å…³ç³»å¦‚ä¸‹ å±žæ€§ä¿®é¥°ç¬¦ç±»åž‹ name value å±žæ€§ç±»åž‹ T å±žæ€§ç±»åž‹å å†…å­˜ç®¡ç† C(copy) &amp;(strong/retain) W(weak) R(readonly) ç©º è‡ªå®šä¹‰getter/setter G(getter) S(setter) æ–¹æ³•å åŽŸå­/éžåŽŸå­ç±»åž‹ N(nonatomic) ç©º(atomic) ç©º ivaråç§° V å˜é‡åç§° æ¯”å¦‚æˆ‘ä»¬åˆ†åˆ«å®šä¹‰ä¸€ä¸ªå¯¹è±¡ç±»åž‹ã€æ ‡é‡ã€ä»¥åŠidç±»åž‹çš„å±žæ€§æ¥çœ‹ä¸€ä¸‹ å±žæ€§å®šä¹‰ attributesæè¿° @property char charDefault; Tc,V_charDefault @property (nonatomic, copy) NSString *myString; T@â€NSStringâ€,C,N,V_myString @property(nonatomic, readonly, retain) id idVar; T@,R,&amp;,V_idVar æ³¨æ„ï¼šæ³¨æ„æè¿°ç¬¦ä¸­çš„V_ivaråç§°ï¼Œæ­¤æè¿°ç¬¦æ˜¯åŸºäºŽ64bitç³»ç»Ÿçš„ï¼Œå› ä¸ºä¼šè‡ªåŠ¨åˆæˆivarï¼Œå¦‚æžœæ˜¯32bitç³»ç»Ÿåˆ™ä¸ä¼šæœ‰ä¸‹åˆ’çº¿ï¼Œå‰æ–‡å·²åšè§£é‡Šã€‚ Runtimeä¸‹çš„å®žçŽ°äº†è§£äº†å±žæ€§åœ¨è¿è¡Œæ—¶ç³»ç»Ÿä¸‹çš„å®šä¹‰ï¼Œæˆ‘ä»¬çŽ°åœ¨æŽ¢ç©¶ä¸€ä¸‹å…¶çš„å®žçŽ°ã€‚è¿è¡Œæ—¶ä¸­æœ‰ivarã€methodã€classã€objectç­‰æ¦‚å¿µï¼Œå…¶ä¸­@propertyå°±æ¶‰åŠåˆ°äº†ivarå’Œmethod(getæ–¹æ³•å’Œsetæ–¹æ³•)ï¼Œå…·ä½“å¦‚ä½•å®žçŽ°å‘¢ï¼Œæˆ‘ä»¬é€šè¿‡åç¼–è¯‘æ¥ä¸€æŽ¢ç©¶ç«Ÿã€‚ åœ¨OCä¸­ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥è®¤ä¸ºæ˜¯idç±»åž‹ï¼Œidç±»åž‹å®šä¹‰ä¸ºä¸‹ï¼š123typedef struct objc_object &#123; Class isa;&#125; *id; è€Œidç±»åž‹å°±æ˜¯æŒ‡å‘Classç±»åž‹çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆClassåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ12345678910111213141516struct objc_class &#123; Class isa OBJC_ISA_AVAILABILITY; #if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; const char *name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; struct objc_method_list **methodLists OBJC2_UNAVAILABLE; struct objc_cache *cache OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE; #endif&#125; OBJC2_UNAVAILABLE; çŽ°åœ¨æˆ‘ä»¬å¤§è‡´äº†è§£äº†OCä¸­å¯¹è±¡çš„å®žçŽ°åŽŸç†ã€‚OCä¸­æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥è®¤ä¸ºæ˜¯idç±»åž‹ï¼Œè€Œidåˆæ˜¯æŒ‡å‘Classçš„æŒ‡é’ˆï¼ŒClassç±»åž‹å®žé™…æ˜¯objc_classç»“æž„ä½“ï¼Œå…¶å®šä¹‰äº†OCå¯¹è±¡çš„åŸºæœ¬ä¿¡æ¯ã€‚ æ›´å¤šRuntimeçš„å†…å®¹åœ¨æ­¤ä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å±žæ€§æ¶‰åŠåˆ°çš„ç±»åž‹ï¼šobjc_ivar_listå’Œobjc_method_listï¼š1234567891011struct objc_ivar &#123; char *ivar_name; char *ivar_type; int ivar_offset; int space;&#125;;struct objc_ivar_list &#123; int ivar_count; int space; struct objc_ivar ivar_list[1];&#125; åœ¨æ­¤æˆ‘ä»¬çœ‹åˆ°äº†ivarçš„çœŸé¢ç›®ï¼Œå®ƒåŒ…å«äº†åç§°ã€ç±»åž‹ã€åŸºåœ°å€åç§»ã€å†…å­˜ç©ºé—´ã€‚åŒæ ·ï¼Œobjc_method_listå®šä¹‰å¦‚ä¸‹ï¼š1234567891011121314struct objc_method_list &#123; struct objc_method_list *obsolete; int method_count; #ifdef __LP64__ int space; #endif /* variable length structure */ struct objc_method method_list[1];&#125;;struct objc_method &#123; SEL method_name; char *method_types; /* a string representing argument/return types */ IMP method_imp;&#125;; æ‰€ä»¥ï¼Œå½“åœ¨ç±»ä¸­åˆ›å»ºä¸€ä¸ªå±žæ€§æ—¶ã€‚Runtimeåšäº†ä»¥ä¸‹äº‹æƒ…ï¼š åˆ›å»ºè¯¥å±žæ€§ï¼Œè®¾ç½®å…¶objc_ivarï¼Œé€šè¿‡åç§»é‡å’Œå†…å­˜å ç”¨å°±å¯ä»¥æ–¹ä¾¿èŽ·å–ã€‚ ç”Ÿæˆå…¶getterå’Œsetterã€‚è¯¦æƒ…è¯·æŸ¥é˜…objcä¸­æ–¹æ³•çš„å®žçŽ°(SEL,IMP)ã€‚ å°†å±žæ€§çš„ivaræ·»åŠ åˆ°ç±»çš„ivar_listä¸­ï¼Œä½œä¸ºç±»çš„æˆå‘˜å˜é‡å­˜åœ¨ã€‚ å°†getterå’ŒsetteråŠ å…¥ç±»çš„method_listä¸­ã€‚ä¹‹åŽå¯ä»¥é€šè¿‡ç›´æŽ¥è°ƒç”¨æˆ–è€…ç‚¹è¯­æ³•æ¥ä½¿ç”¨ã€‚ å°†å±žæ€§çš„æè¿°æ·»åŠ åˆ°ç±»çš„å±žæ€§æè¿°åˆ—è¡¨ä¸­ã€‚ å±žæ€§çš„èŽ·å–ä¸ºäº†è®°å½•å±žæ€§ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå˜é‡ï¼šivar_list: è®°å½•æˆå‘˜å˜é‡çš„æè¿°method_list: è®°å½•è¯¥å˜é‡getterå’Œsetterçš„æè¿°prop_list: è®°å½•å±žæ€§çš„æè¿°OBJC_IVAR_$ç±»å_$å±žæ€§åç§°: è®°å½•å±žæ€§ç›¸å¯¹å¯¹è±¡åœ°å€çš„åç§»åœ°å€(é‡è¦) å…¶ä¸­ï¼Œè®°å½•å˜é‡çš„åç§»åœ°å€å¾ˆé‡è¦ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®žçŽ°ï¼š12345678910// ç”Ÿæˆä¸€ä¸ªSubClassç±»åž‹ï¼ŒåŒ…å«ä¸€ä¸ªå±žæ€§@interface SubClass ()@property (nonatomic, strong) NSMutableArray* array;@end// åœ¨è¯¥ç±»çš„å®žçŽ°ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•@implementation SubClass- (void)testArrayMethod &#123; self.array = [NSMutableArray array];&#125;@end åç¼–è¯‘ä»£ç ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•èµ‹å€¼çš„ï¼š1234567891011121314// å±žæ€§çš„å®šä¹‰extern "C" unsigned long OBJC_IVAR_$_SubClass$_array;struct SubClass_IMPL &#123; struct NSObject_IMPL NSObject_IVARS; NSMutableArray *_array;&#125;;// èµ‹å€¼(å·²ç»åŽ»æŽ‰äº†å¤æ‚çš„ç±»åž‹è½¬æ¢ä»£ç )static void _I_SubClass_testArrayMethod(SubClass * self, SEL _cmd) &#123; (objc_msgSend)(self, sel_registerName("setArray:"), (objc_getClass("NSMutableArray"), sel_registerName("array")));&#125;// å±žæ€§çš„setteræ–¹æ³•static void _I_SubClass_setArray_(SubClass * self, SEL _cmd, NSMutableArray *array) &#123; *(self + OBJC_IVAR_$_SubClass$_array) = array;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå±žæ€§çš„åç§»åœ°å€å‘½åä¸ºOBJC_IVAR_$ç±»å_$å±žæ€§åç§°ï¼Œç‚¹è¯­æ³•æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨äº†setterï¼Œè€Œsetterä¸­ç¡®å®šå±žæ€§å¯¹åº”ivarçš„å†…å­˜åœ°å€åˆ™æ˜¯é€šè¿‡ å¯¹è±¡åœ°å€+åç§»é‡ æ¥å¯»å€ï¼Œå³*(self + OBJC_IVAR_$_SubClass$_array)ã€‚ @Propertyçš„å±žæ€§ä¿®é¥°ç¬¦è°ˆå®Œ@propertyçš„åº•å±‚å®žçŽ°ï¼Œå†çœ‹ä¸€ä¸‹å±žæ€§ä¿®é¥°ç¬¦ã€‚æ­¤å¤„ä»…è®¨è®º@propertyçš„å±žæ€§ä¿®é¥°ç¬¦ï¼Œå¯¹äºŽARCçš„æ‰€æœ‰æƒä¿®é¥°ç¬¦(__strong,__weak,__unsafe_unretained,__autorealesing)ä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« è®¨è®ºã€‚ å±žæ€§ç¬¦ä½œç”¨åŠåŒºåˆ« å±žæ€§ å†…å®¹ readwrite å±žæ€§å¯è¯»å¯å†™ï¼Œç”Ÿæˆgetter+setterï¼Œé»˜è®¤å±žæ€§ readonly å±žæ€§åªè¯»ï¼Œåªç”Ÿæˆgetter nonatomic éžåŽŸå­å±žæ€§ï¼Œæé«˜æ€§èƒ½ä½†çº¿ç¨‹ä¸å®‰å…¨ atomic åŽŸå­å±žæ€§ï¼Œçº¿ç¨‹å®‰å…¨ä½†å¯èƒ½é™ä½Žæ€§èƒ½ MRCæ¨¡å¼ä¸‹ assign ç›´æŽ¥èµ‹å€¼ï¼Œä¸å¢žåŠ å¼•ç”¨è®¡æ•° retain æŒæœ‰å¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°+1 copy ç”Ÿæˆå¹¶æŒæœ‰ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶æ·±æ‹·è´å¯¹è±¡çš„å€¼ ARCæ¨¡å¼ä¸‹ strong å¼ºå¼•ç”¨ï¼ŒæŒæœ‰å¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°+1ï¼Œç›¸å½“äºŽMRCçš„retain weak å¼±å¼•ç”¨ï¼Œä¸æŒæœ‰å¯¹è±¡ï¼Œä¸å¢žåŠ å¼•ç”¨è®¡æ•°ï¼Œç›¸å½“äºŽMRCçš„assignï¼Œä½†åœ¨å¯¹è±¡é”€æ¯åŽä¼šç½®ä¸ºnil copy æ·±æ‹·è´ï¼ŒåŒMRCçš„copy unsafe_unretained æ— é¡»å†…å­˜ç®¡ç†çš„å¯¹è±¡ï¼Œç›¸å½“äºŽMRCçš„assignï¼Œå¯¹è±¡é”€æ¯åŽä¸ä¼šç½®nilï¼Œå¯èƒ½é€ æˆé‡ŽæŒ‡é’ˆã€‚(iOS 4ä¹‹åŽåŸºæœ¬åºŸå¼ƒï¼Œä½¿ç”¨assignæ›¿ä»£) åŒæ—¶ï¼Œæ ¹æ®LLVMæ–‡æ¡£æ‰€è¿°ï¼ŒARCæ¨¡å¼ä¸‹ä¾æ—§å¯ä»¥ä½¿ç”¨MRCä¿®é¥°ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è½¬æ¢ã€‚assignå¯¹åº”unsafe_unretainedï¼Œretainå¯¹åº”strongã€‚ åŽŸå­å±žæ€§atomicåŽŸå­å±žæ€§(atomic)é€šè¿‡åŠ é”æ¥å®žçŽ°è®¿é—®/èµ‹å€¼çš„çº¿ç¨‹å®‰å…¨ï¼Œä½†atomicåªæ˜¯ä¿è¯äº†getterå’Œsetterçš„çº¿ç¨‹å®‰å…¨ï¼Œå¹¶æ²¡æœ‰ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚çº¿ç¨‹Aåœ¨è¯»æ•°æ®ï¼Œè€Œçº¿ç¨‹BCDåœ¨å†™æ•°æ®ï¼Œè™½ç„¶BCDå¹¶ä¸èƒ½åŒæ—¶å†™ï¼Œä½†Aè¯»åˆ°çš„æ•°æ®å´æ˜¯BCDæŸä¸ªæ—¶é—´å†™å…¥çš„ï¼Œæ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åŒæ ·çš„ï¼Œå¯¹äºŽobjectAtIndex:ç­‰éžgetter/setteræ–¹æ³•ï¼Œåˆ™ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ weakçš„ä½¿ç”¨åœºæ™¯åŠä¸Žassignçš„åŒºåˆ«é¦–å…ˆï¼Œweakä¸Žassignéƒ½è¡¨ç¤ºäº†ä¸€ç§â€œéžæŒæœ‰å…³ç³»â€(nonowning relationship)ï¼Œä¹Ÿæˆå¼±å¼•ç”¨ï¼Œåœ¨ä½¿ç”¨æ—¶ä¸ä¼šå¢žåŠ è¢«å¼•ç”¨å˜é‡çš„å¼•ç”¨è®¡æ•°ã€‚è€Œweakåœ¨å¼•ç”¨çš„å¯¹è±¡è¢«é”€æ¯åŽä¼šè¢«æŒ‡å‘nilï¼Œä¿è¯äº†å®‰å…¨ï¼Œç›¸åassignä¸ä¼šè¢«ç½®nilï¼Œæˆä¸ºé‡ŽæŒ‡é’ˆã€‚å…¶æ¬¡ï¼Œå¯¹äºŽæ ‡é‡(åŸºç¡€æ•°æ®ç±»åž‹:int,doubleï¼Œä»¥åŠOCä¸­ä½¿ç”¨å®å®šä¹‰çš„æ•°æ®ç±»åž‹:CGFloat,NSInteger)ï¼Œåªèƒ½ä½¿ç”¨assignã€‚weakåªèƒ½ç”¨äºŽå¯¹è±¡ï¼Œassignå¯ç”¨äºŽå¯¹è±¡å’Œæ ‡é‡ã€‚ copyçš„ä½¿ç”¨åœºæ™¯åŠæ³¨æ„äº‹é¡¹ä½¿ç”¨copyä¿®é¥°çš„å¯¹è±¡åœ¨èµ‹å€¼çš„æ—¶å€™åˆ›å»ºå¯¹è±¡çš„å‰¯æœ¬ï¼Œä¹Ÿæˆæ·±æ‹·è´ã€‚å®žé™…åˆ™æ˜¯è°ƒç”¨äº†copyæ–¹æ³•ã€‚æ”¯æŒcopyæ–¹æ³•è¦éµå®ˆNSCopyingåè®®ï¼Œå®žçŽ°copyWithZone:æ–¹æ³•æ¥ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡çš„å‰¯æœ¬ã€‚åŒæ—¶ï¼Œè¿˜æœ‰mutableCopyç”¨äºŽå®žçŽ°å¯¹äºŽå¯å˜å¯¹è±¡çš„æ·±æ‹·è´ï¼Œå¦‚NSMutableArrayã€‚å½“æˆ‘ä»¬æƒ³å¤åˆ¶å­—ç¬¦ä¸²çš„å€¼è€Œéžç›´æŽ¥å¼•ç”¨è¯¥å­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬å°±åº”è¯¥æ·±æ‹·è´ä¸€ä»½ï¼Œå¦åˆ™ä¼šå‡ºçŽ°ä¿®æ”¹åŽŸå¯¹è±¡å€¼çš„æƒ…å†µã€‚NSArrayã€NSDictionaryï¼Œä»¥åŠæˆ‘ä»¬è‡ªå·±çš„ç±»åŒç†ã€‚ä½†æ˜¯ï¼Œå¯¹äºŽ@propertyçš„copyä¿®é¥°ç¬¦ï¼Œåªæ˜¯è°ƒç”¨äº†copyæ–¹æ³•ï¼Œæ‰€ä»¥åªèƒ½ç”Ÿæˆä¸å¯å˜å¯¹è±¡ã€‚å¯¹äºŽå¦‚ä¸‹ä»£ç ï¼š12345@property (nonatomic, copy) NSMutableArray *mutableArray;/* ... */NSMutableArray *anotherMutableArray = [NSMutableArray arrayWithObjects:@1,@2,nil];self.mutableArray = anotherMutableArray;[self.mutableArray removeObjectAtIndex:0]; ä¼šå‘ç”Ÿå´©æºƒã€‚åŽŸå› åœ¨äºŽcopyç”Ÿæˆäº†ä¸å¯å˜å¯¹è±¡ï¼Œå¯¼è‡´removeObjectAtIndex:æ–¹æ³•æŠ¥é”™ã€‚æ‰€ä»¥ï¼Œå¯¹äºŽå¯å˜å¯¹è±¡ï¼Œä¸è¦ä½¿ç”¨copyå±žæ€§ä¿®é¥°ç¬¦ï¼Œè€Œæ˜¯è°ƒç”¨mutableCopyæ–¹æ³•ã€‚ ç›¸å…³èµ„æ–™ Objective-C Runtime Programming Guide - Declared Properties]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Objective-C</tag>
        <tag>Runtime</tag>
        <tag>åº•å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOS/OS Xçš„Tagged Pointer]]></title>
    <url>%2F2017%2F12%2F15%2FiOS%3AOS%20X%E7%9A%84Tagged%20Pointer%2F</url>
    <content type="text"><![CDATA[Tagged Pointeræ˜¯å­˜åœ¨äºŽå­—ç¬¦ä¸²ã€NSNumberã€NSDateç­‰é‡å¤æ€§é«˜ä¸”è¾ƒå°çš„å¯¹è±¡ä¸­çš„ä¸€ç§ä¼˜åŒ–æ–¹å¼ï¼Œç”¨äºŽè§£å†³é‡å¤æ€§è¾ƒé«˜çš„ç±»åž‹åœ¨64ä½æ“ä½œç³»ç»Ÿå†…å­˜çš„å†…éƒ¨ç¢Žç‰‡é—®é¢˜ã€‚ èƒŒæ™¯åœ¨åˆ›å»ºè®¨è®ºTagged Pointerä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¤è¯†ä¸€ä¸‹å®ƒæ‰§è¡Œä»¥ä¸‹ä»£ç : 1234567891011121314__weak NSNumber *weakNumber;__weak NSString *weakString;__weak NSDate *weakDate;int num = 123;@autoreleasepool &#123; weakNumber = [NSNumber numberWithInt:num]; weakString = [NSString stringWithFormat:@&quot;string%d&quot;, num]; weakDate = [NSDate dateWithTimeIntervalSince1970:0];&#125;NSLog(@&quot;WeakNumber is %@&quot;, weakNumber);NSLog(@&quot;WeakString is %@&quot;, weakString);NSLog(@&quot;WeakDate is %@&quot;, weakDate); è¿è¡Œç»“æžœä¸º: 123WeakNumber is 123WeakString is string123WeakDate is Thu Jan 1 08:00:00 1970 è¿™æ ·çš„ç»“æžœä¸Žæƒ³è±¡ä¸­å¯èƒ½ä¸åŒï¼Œæˆ‘ä»¬è®¾ç½®weakNumber/weakString/weakDateå˜é‡ä¸ºå¼±å¼•ç”¨ï¼Œè€Œåœ¨NSNumber/NSString/NSDateåˆ›å»ºçš„ä»£ç éƒ¨åˆ†è®¾ç½®äº†è‡ªåŠ¨é‡Šæ”¾ï¼Œé‚£ä¹ˆå½“è¿è¡Œåˆ°è¾“å‡ºéƒ¨åˆ†çš„ä»£ç æ—¶ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²å˜é‡ç†åº”å·²ç»é‡Šæ”¾æŽ‰äº†ï¼Œé‚£ä¹ˆç»“æžœè‡ªç„¶åº”è¯¥è¾“å‡ºnilï¼Œç„¶è€Œäº‹å®žæ˜¯ä»–ä»¬å¹¶æ²¡æœ‰ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»è‹¹æžœåœ¨æŽ¨å‡º64ä½ç³»ç»ŸåŽä¸ºäº†èŠ‚çœå†…å­˜å’Œæé«˜æ•ˆçŽ‡è€Œå¼•å…¥çš„Tagged Pointerã€‚ ç®€ä»‹åœ¨iPhone 5sæŽ¨å‡ºåŽï¼Œå¤„ç†å™¨æ­¥å…¥äº†64ä½æž¶æž„æ—¶ä»£ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œ64ä½ç³»ç»Ÿä¸­å˜é‡æ‰€å å­—èŠ‚ä¹Ÿä¼šéšä¹‹å˜å¤§ï¼Œå¦‚32ä½ç³»ç»Ÿä¸­çš„intä¸º4å­—èŠ‚ï¼Œè€Œ64ä½ç³»ç»Ÿä¸‹æ˜¯8å­—èŠ‚ã€‚è™½ç„¶å€¼åŸŸä¹Ÿéšä¹‹å˜å¤§ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¢žåŠ çš„å€¼åŸŸå¯¹äºŽæ•°å­—ã€æ—¥æœŸã€çŸ­å­—ç¬¦ä¸²æ¥è¯´å¹¶ä¸éœ€è¦ã€‚é€ æˆçš„å†…éƒ¨ç¢Žç‰‡é—®é¢˜å¦‚ä¸‹å›¾ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹64ä½ç³»ç»Ÿå¢žåŠ äº†32ä½çš„å†…å­˜æµªè´¹: é‚£ä¹ˆèƒ½å¦ä¼˜åŒ–è¿™ä¸€å†…å­˜æµªè´¹é—®é¢˜å‘¢ï¼Ÿå¯ä»¥æ³¨æ„åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬æ¯ä¸ªæ•°å­—å¯¹è±¡éƒ½å ç”¨8å­—èŠ‚ï¼Œä½†å¤§å®¶å®žé™…èƒ½ç”¨åˆ°çš„æ•°å­—å¯èƒ½ä»…ä»…å‡ ä½ï¼Œå¤§æ•°è®¡ç®—çš„æƒ…å†µå¾ˆå°‘ã€‚é‚£ä¹ˆï¼Œä»¥è¾ƒä½Žçš„å†…å­˜æ¶ˆè€—é¢„å…ˆä¿å­˜ä¸€äº›å¸¸è§æ•°å­—ï¼Œè€Œå¯¹äºŽä¸å¸¸è§çš„å†åŠ¨æ€åˆ›å»º8å­—èŠ‚çš„å˜é‡çš„æ–¹æ¡ˆï¼Œå°±ä¼šæ›´åŠ èŠ‚çœå†…å­˜ï¼Œä»¥åŠåˆ›å»ºå¯¹è±¡çš„æ€§èƒ½æ¶ˆè€—ã€‚ Tagged PointerçŸ¥é“äº†å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬çŽ°åœ¨åˆ™ä»‹ç»ä¸€ä¸‹Tagged Pointerã€‚å®ƒå°±æ˜¯å°†å¤§éƒ¨åˆ†å¸¸ç”¨çš„å­—ç¬¦ä¸²ã€æ•°å­—å¯¹è±¡ã€æ—¥æœŸé¢„å…ˆä¿å­˜ï¼Œè€Œå…¶ä¸å†æŒ‰ç…§64ä½ç³»ç»Ÿçš„8å­—èŠ‚å¤§å°ï¼Œå½“æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å†…å®¹å‘½ä¸­äº†Tagged Pointeré¢„å…ˆå­˜å‚¨çš„å†…å®¹æ—¶ï¼Œæˆ‘ä»¬çš„å¯¹è±¡æŒ‡é’ˆä¼šå˜æˆTagged Pointerï¼ŒæŒ‡å‘æŒ‡å®šçš„å†…å­˜ã€‚æˆ‘ä»¬å¯ä»¥çœ‹å¦‚ä¸‹çš„ä¾‹å­: 123456int num = 123;NSString *str1 = [NSString stringWithUTF8String:&quot;String123&quot;];NSString *str2 = [NSString stringWithFormat:@&quot;String%d&quot;, num];NSLog(@&quot;%p&quot;, str1);NSLog(@&quot;%p&quot;, str2); æ‰“å°çš„åœ°å€ç›¸åŒï¼Œè¯æ˜Žä¸¤è€…æŒ‡å‘äº†åŒä¸€åœ°å€ã€‚ é‚£ä¹ˆå¦‚ä½•å®žçŽ°å°†è¿™äº›å¯¹è±¡ä¸æŒ‰ç…§8å­—èŠ‚å­˜å‚¨çš„å‘¢ï¼ŸTagged Pointerå°†ä¸€ä¸ªå¯¹è±¡æŒ‰32ä½ä¿å­˜(4å­—èŠ‚)ï¼Œè€ŒåŽå¯¹å…¶ç»‘å®šä¸€ä¸ªåŒæ ·æ˜¯4å­—èŠ‚çš„Tagï¼Œä»Žè€Œå¯ä»¥æ–¹ä¾¿å®šä½å®ƒã€‚è¿™æ ·ä¸€ä¸ªTag+å¯¹è±¡æ€»å…±ä¸º8å­—èŠ‚ï¼Œä¸Ž32ä½ç³»ç»Ÿä¸­å¯¹è±¡æŒ‡é’ˆ+å¯¹è±¡å†…å®¹å¤§å°ç›¸å½“ã€‚è‡³äºŽä¸ºä»€ä¹ˆå¯¹è±¡è¦æŒ‰4å­—èŠ‚ä¿å­˜è€Œä¸æ˜¯ç”±æ•°æ®å¤§å°è€Œå®šï¼Œåˆ™æ˜¯ä¸ºäº†é¿å…äº§ç”Ÿå¤–éƒ¨ç¢Žç‰‡ã€‚å†…å­˜å›¾å¦‚ä¸‹æ‰€ç¤º: isaå’Œå¼•ç”¨è®¡æ•°çŽ°åœ¨å†è°ˆä¸€äº›ä¸ŽTagged Pointeræœ‰å…³çš„é—®é¢˜ã€‚çœ‹äº†å…¶å†…å­˜å›¾åŽï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„OCå¯¹è±¡ï¼Œé‚£ä¹ˆå…¶isaæŒ‡é’ˆä¹Ÿå°±æ— æ³•æ­£å¸¸ä½¿ç”¨äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡object_getClass()æ–¹æ³•æ¥èŽ·å–çœŸå®žå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰“å°ç»“æžœä¸ºNSTaggedPointerStringã€__NSTaggedDateã€__NSCFNumberã€‚ åŒæ—¶ï¼ŒTagged Pointerçš„å¼•ç”¨è®¡æ•°æ˜¯æ— ç©·å¤§çš„ï¼Œå¯ä»¥å°è¯•å¦‚ä¸‹ä»£ç æ‰“å°: 12// ARCæ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨CFGetRetainCountå‡½æ•°èŽ·å–å¼•ç”¨è®¡æ•°NSLog(@&quot;Retain count: %ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(str1))); ç»“æžœæ˜¯æ— ç©·å¤§ã€‚æ‰€ä»¥å¯¹äºŽç±»ä¼¼å¦‚ä¸‹çš„é¢˜ç›®: 1234567NSString *str1 = [NSString stringWithUTF8String:&quot;String123&quot;];[str1 retain];NSString *str2 = str1;[str2 release];[str1 retain];/* ......... */NSLog(@&quot;Retain count: %lu&quot;, [str1 retainCount]); æ— è®ºé¢˜ç›®ä¸­å¦‚ä½•å¼•ç”¨å’Œé‡Šæ”¾ï¼Œæœ€ç»ˆï¼Œå…¶å¼•ç”¨è®¡æ•°éƒ½ä¼šå› ä¸ºå®ƒæ˜¯Tagged Pointerè€Œæ˜¯æ— ç©·å¤§ã€‚ å¸¸é‡ä¸ŽTagged PointeråŒºåˆ«å½“æˆ‘ä»¬å¦‚ä¸‹æ–¹å¼å®šä¹‰å¸¸é‡str3æ—¶ï¼š 1234int num = 123;NSString *str1 = [NSString stringWithUTF8String:&quot;String123&quot;];NSString *str1 = [NSString stringWithUTF8String:&quot;String%d&quot;, num];NSString *str2 = @&quot;String123&quot;; æˆ‘ä»¬ä¼šå‘çŽ°str3å’Œå…¶ä½™ä¸¤ä¸ªçš„åœ°å€å¹¶ä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬è¦çŸ¥é“ï¼Œå¸¸é‡ä¸æ˜¯Tagged Pointerï¼Œå› ä¸ºå®ƒæ˜¯åœ¨è¿è¡Œæ—¶ä¹‹å‰å°±å¯¼å…¥çš„ï¼Œå­˜åœ¨äºŽæ•°æ®æ®µå†…ã€‚è€Œå…¶ä½™ä¸¤ä¸ªå¯¹è±¡æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ï¼Œæ‰€ä»¥æ‰å¯ä»¥é€šè¿‡Tagged Pointerè¿™ä¸€æœºåˆ¶è¿›è¡Œä¼˜åŒ–ã€‚ ç›¸å…³èµ„æ–™ mikeash.com - Friday Q&amp;A 2015-07-31: Tagged Pointer Strings mikeash.com - Friday Q&amp;A 2012-07-27: Letâ€™s Build Tagged Pointers]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Runtime</tag>
        <tag>åº•å±‚</tag>
        <tag>Objecitve-C</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPäº”å±‚æ¨¡åž‹æ¶ˆæ¯è§£/å°è£…ä»¿çœŸ]]></title>
    <url>%2F2017%2F12%2F09%2FTCP%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B%E6%B6%88%E6%81%AF%E8%A7%A3-%E5%B0%81%E8%A3%85%E4%BB%BF%E7%9C%9F%2F</url>
    <content type="text"><![CDATA[æ¶ˆæ¯å°/è§£è£…ä»¿çœŸåŠŸèƒ½è¦æ±‚æŒ‰ç…§TCPäº”å±‚æ¨¡åž‹ä»¿çœŸæ¶ˆæ¯åœ¨ä¸¤å°ä¸»æœºä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹ã€‚ åœ¨å‘é€ç«¯æ¨¡æ‹Ÿæ•°æ®ä»Žé«˜å±‚åˆ°ä½Žå±‚çš„å°è£…è¿‡ç¨‹ï¼Œåœ¨æŽ¥æ”¶ç«¯æ¨¡æ‹Ÿæ•°æ®ä»Žä½Žå±‚åˆ°é«˜å±‚çš„è§£å°è£…è¿‡ç¨‹ã€‚ æŒ‰ç…§æ¯å±‚çš„åŠŸèƒ½å¯¹æ•°æ®å¡«åŠ æŠ¥å¤´ï¼Œå¹¶æ˜¾ç¤ºæ¯ä¸€å±‚å¾—åˆ°çš„å°/è§£è£…æ ¼å¼ã€‚ ä¼ è¾“å±‚å’Œç½‘ç»œå±‚çš„å°è£…æ ¼å¼å‚è€ƒTCP/IPçš„ç›¸åº”å„å±‚åè®®æ ¼å¼ã€‚ ç½‘ç»œå±‚çš„IPæŠ¥æ–‡éœ€è¦æ¨¡æ‹ŸæŠ¥æ–‡åˆ†æ®µå’Œé‡ç»„çš„è¿‡ç¨‹ã€‚ æ•°æ®é“¾è·¯å±‚å¸§æ ¼å¼å‚è€ƒå±€åŸŸç½‘çš„MACå¸§æ ¼å¼ã€‚ ç‰©ç†å±‚æ˜¾ç¤ºä¸º0æˆ–1æ¯”ç‰¹ä¸²ã€‚ Socketç¼–ç¨‹ç®€ä»‹Socketæ˜¯ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨åŸºäºŽSocketçš„ç¼–ç¨‹æŠ€æœ¯ä¸­ï¼Œç”¨æˆ·ä¸ç›´æŽ¥è®¿é—®å‘é€å’ŒæŽ¥æ”¶åŒ…çš„ç½‘ç»œæŽ¥å£è®¾å¤‡ï¼Œè€Œæ˜¯å»ºç«‹ä¸€ä¸ªä¸­é—´æ–‡ä»¶æè¿°ç¬¦æ¥å¤„ç†ç¼–ç¨‹æŽ¥å£åˆ°ç½‘ç»œçš„æ“ä½œã€‚ç®€å•æ¥è¯´ï¼ŒSocketå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œå¥—æŽ¥å­—â€ã€‚æœ¬æ®µåªä»‹ç»äº†æœ¬å®žéªŒéœ€è¦è®¾è®¡çš„çŸ¥è¯†ï¼Œæ›´å¤šSocketç”¨æ³•å¯Googleä¸€ä¸‹ã€‚ SocketåŒ…å«çš„å†…å®¹ ä¸€ä¸ªç‰¹æ®Šçš„é€šä¿¡åŸŸï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ç»œè¿žæŽ¥ ä¸€ä¸ªç‰¹æ®Šçš„é€šä¿¡ç±»åž‹ï¼Œæ¯”å¦‚æµæˆ–è€…æ•°æ®æŠ¥ ä¸€ä¸ªç‰¹æ®Šçš„åè®®ï¼Œæ¯”å¦‚TCPæˆ–è€…UDP å…¶ä¸­ï¼Œå¯ä»¥å®žçŽ°é¢å‘è¿žæŽ¥å’Œæ— è¿žæŽ¥çš„Socket é¢å‘è¿žæŽ¥çš„Socket é¢å‘æ— è¿žæŽ¥çš„Socket æ¨¡æ‹ŸTCP è¯­è¨€ Objective-C + C å¹³å° Mac OSX å·¥å…· XCode (LLVM) æœ€ç»ˆæ•ˆæžœ è¿è¡Œé€»è¾‘æœ¬å®žéªŒæ¨¡æ‹Ÿäº†TCPäº”å±‚æ¨¡åž‹ä¸­çš„æ¶ˆæ¯è§£/å°è£…ä»¿çœŸï¼Œå»ºç«‹åœ¨çŽ°æœ‰ç½‘ç»œçš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨Socketè¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨äº†é¢å‘è¿žæŽ¥çš„Socketã€‚é™¤äº†ä¸¤å°æœºå™¨ç›¸äº’é€šä¿¡ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æœåŠ¡ç«¯ç»‘å®šåˆ°ç½‘å¡ç«¯å£ï¼Œä½¿ç”¨å®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯åœ¨æœ¬æœºç›¸äº’é€šä¿¡ã€‚ ç”±æœåŠ¡ç«¯ç»‘å®šç«¯å£å¹¶ä¾¦å¬å®¢æˆ·ç«¯æ¶ˆæ¯ã€‚è€ŒåŽå®¢æˆ·ç«¯è¿žæŽ¥æœåŠ¡ç«¯ï¼Œå¹¶ç›¸äº’å‘é€æ¶ˆæ¯ã€‚ æœåŠ¡ç«¯(Server)é¦–å…ˆï¼ŒæœåŠ¡å™¨ç»‘å®šç«¯å£ï¼Œå¹¶ä¾¦å¬å®¢æˆ·ç«¯è¿žæŽ¥è¯·æ±‚ï¼Œå½“å®¢æˆ·ç«¯è¿žæŽ¥åŽè¿›è¡Œæ¶ˆæ¯ä¾¦å¬å’Œå‘é€ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465- (void)bindSocketWithPort:(NSInteger)port &#123; // åˆ›å»ºSocketåœ°å€ struct sockaddr_in server_addr; // socketåœ°å€ server_addr.sin_len = sizeof(struct sockaddr_in); // è®¾ç½®åœ°å€ç»“æž„ä½“å¤§å° server_addr.sin_family = AF_INET; // AF_INETåœ°å€ç°‡ server_addr.sin_port = htons((short)port); // è®¾ç½®ç«¯å£ server_addr.sin_addr.s_addr = htonl(INADDR_ANY); // æœåŠ¡å™¨åœ°å€ // åˆ›å»ºSocket int server_socket = socket(AF_INET, SOCK_STREAM, 0); // åˆ›å»ºSocket if (server_socket == -1) &#123; [self showMessageWithMsg:@&quot;åˆ›å»ºSocketå¤±è´¥&quot;]; return; &#125; int reuse = 1; int sockOpt = setsockopt(server_socket, SOL_SOCKET, SO_REUSEADDR, &amp;reuse, sizeof(reuse)); if (sockOpt == -1) &#123; [self showMessageWithMsg:@&quot;é‡è®¾Socketå¤±è´¥&quot;]; return; &#125; // ç»‘å®šSocket // å°†åˆ›å»ºçš„Socketç»‘å®šåˆ°æœ¬åœ°IPå’Œç«¯å£,ç”¨äºŽä¾¦å¬å®¢æˆ·ç«¯è¯·æ±‚ int bind_result = bind(server_socket, (struct sockaddr *)&amp;server_addr, sizeof(server_addr)); if (bind_result == -1) &#123; [self showMessageWithMsg:@&quot;ç»‘å®šSocketå¤±è´¥&quot;]; return; &#125; // ä¾¦å¬å®¢æˆ·ç«¯æ¶ˆæ¯ if (listen(server_socket, 5) == -1) &#123; [self showMessageWithMsg:@&quot;å¼€å¯ä¾¦å¬å¤±è´¥&quot;]; return; &#125; // èŽ·å–å®¢æˆ·ç«¯ç«¯å£ä¿¡æ¯ struct sockaddr_in client_address; socklen_t address_len; int client_socket = accept(server_socket, (struct sockaddr *)&amp;client_address, &amp;address_len); if (client_socket == -1) &#123; [self showMessageWithMsg:@&quot;å®¢æˆ·ç«¯æ¡æ‰‹å¤±è´¥&quot;]; return; &#125; char recv_msg[RECV_BUFFER_SIZE]; char reply_msg[REPLY_BUFFER_SIZE]; while (YES) &#123; bzero(recv_msg, RECV_BUFFER_SIZE); bzero(reply_msg, REPLY_BUFFER_SIZE); long byteLen = recv(client_socket, recv_msg, RECV_BUFFER_SIZE, 0); recv_msg[byteLen] = &apos;\0&apos;; // æ·»åŠ æ¶ˆæ¯ç»“å°¾ NSMutableString *msgStr = [NSMutableString stringWithFormat:@&quot;%s&quot;, recv_msg]; [self clearCurrentMsg]; strcpy(recv_msg, [[self reciveFromClient:msgStr] UTF8String]); if (strcmp(recv_msg, &quot;&quot;) != 0) &#123; strcpy(reply_msg, &quot;æœåŠ¡ç«¯æ¶ˆæ¯:æ”¶åˆ°&quot;); strcat(reply_msg, recv_msg); send(client_socket, reply_msg, REPLY_BUFFER_SIZE, 0); &#125; &#125;&#125; å®¢æˆ·ç«¯(Client)é¦–å…ˆï¼Œå®¢æˆ·ç«¯è¦å’ŒæœåŠ¡ç«¯å»ºç«‹è¿žæŽ¥ã€‚è°ƒç”¨socketçš„æ–¹æ³•é¡ºåºä¸ºï¼šsocket() -&gt; connect()12345678910111213141516171819202122232425262728293031323334353637- (void)bindSocketWithIP:(NSString *)ipStr andPort:(NSInteger)port &#123; // åˆ›å»ºSocketåœ°å€ struct sockaddr_in server_addr; // åˆ›å»ºSocketåœ°å€ server_addr.sin_len = sizeof(struct sockaddr_in); // è®¾ç½®ç»“æž„ä½“é•¿åº¦ server_addr.sin_family = AF_INET; // AF_INETåœ°å€ç°‡ server_addr.sin_port = htons((short)port); // è®¾ç½®ç«¯å£ server_addr.sin_addr.s_addr = htonl(INADDR_ANY); // æœåŠ¡å™¨åœ°å€ // åˆ›å»ºSocket int server_socket = socket(AF_INET, SOCK_STREAM, 0); if (server_socket == -1) &#123; [self showMessageWithMsg:@&quot;åˆ›å»ºSocketå¤±è´¥&quot;]; return; &#125; else &#123; // ä¿å­˜Socket self.server_socket = server_socket; // ä¿å­˜port self.port_num = (short)port; [self showMessageWithMsg:@&quot;åˆ›å»ºSocketæˆåŠŸ&quot;]; [NSThread sleepForTimeInterval:0.3]; &#125; int connect_result = connect(server_socket, (struct sockaddr *)&amp;server_addr, sizeof(struct sockaddr_in)); if (connect_result == -1) &#123; [self showMessageWithMsg:@&quot;è¿žæŽ¥ä¸»æœºå¤±è´¥&quot;]; return; &#125; else &#123; [self showMessageWithMsg:@&quot;è¿žæŽ¥ä¸»æœºæˆåŠŸ,ç­‰å¾…å‘é€æ¶ˆæ¯...&quot;]; [NSThread sleepForTimeInterval:0.3]; &#125; // è¿žæŽ¥æˆåŠŸåŽçš„æ“ä½œ [self didConnected];&#125; è¿žæŽ¥æˆåŠŸåŽï¼ŒåŒæ–¹äº’ç›¸å‘é€å’ŒæŽ¥æ”¶æ¶ˆæ¯send() -&gt; recv()123456789101112131415161718192021222324252627- (void)sendMsgAction &#123; NSMutableString *msg = [NSMutableString stringWithFormat:@&quot;%@&quot;,self.msgField.stringValue]; char recv_msg[RECV_BUFFER_SIZE]; char send_msg[REPLY_BUFFER_SIZE]; // å‘é€æ¶ˆæ¯ï¼Œå¹¶æŽ¥æ”¶æœåŠ¡å™¨å›žä¿¡ bzero(recv_msg, RECV_BUFFER_SIZE); bzero(send_msg, REPLY_BUFFER_SIZE); // å‘æœåŠ¡ç«¯é€šè¿‡socketå‘æ¶ˆæ¯ NSMutableString *resStr = [self appLayerWithString:msg]; strcpy(send_msg, resStr.UTF8String); long send_result = send(self.server_socket, send_msg, REPLY_BUFFER_SIZE, 0); if (send_result == -1) &#123; [self showMessageWithMsg:@&quot;æ¶ˆæ¯å‘é€å¤±è´¥&quot;]; return; &#125; else &#123; [self showMessageWithMsg:@&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;]; [NSThread sleepForTimeInterval:0.3]; &#125; // æŽ¥æ”¶æœåŠ¡ç«¯æ¶ˆæ¯ long recv_result = recv(self.server_socket, recv_msg, RECV_BUFFER_SIZE, 0); [self reciveFromServer:[NSString stringWithUTF8String:recv_msg]]; &#125; æŠ¥å¤´ç¼–ç å„å±‚åœ¨ä¼ é€’ç»™ä¸‹ä¸€å±‚ä¹‹å‰ï¼Œè¦å¯¹æ•°æ®è¿›è¡Œå°è£…ï¼Œå¢žåŠ å¯¹åº”çš„æŠ¥å¤´ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130#pragma mark - äº”å±‚ä¼ è¾“åè®®// æ¨¡æ‹Ÿç½‘ç»œå±‚å¯¹æ•°æ®çš„åŒ…è£…- (NSMutableString *)appLayerWithString:(NSMutableString *)str &#123; NSMutableString *resStr = [NSMutableString stringWithFormat:@&quot;AppHeader#%@&quot;, str]; dispatch_async(dispatch_get_main_queue(), ^&#123; self.appLayer.stringValue = [resStr copy]; &#125;); [NSThread sleepForTimeInterval:0.3]; return [self transferLayerWithString:resStr];&#125;// æ¨¡æ‹Ÿä¼ è¾“å±‚å¯¹æ•°æ®çš„åŒ…è£…- (NSMutableString *)transferLayerWithString:(NSMutableString *)str &#123; NSMutableString *resStr = [NSMutableString string]; // æ·»åŠ æºç«¯å£ 16ä½(0-15) [resStr appendFormat:@&quot;0000000011111111&quot;]; // æ·»åŠ ç›®çš„ç«¯å£ 16ä½(16-31) [resStr appendFormat:@&quot;%@&quot;, [self intToBinary:self.port_num]]; // æ·»åŠ åºåˆ—ç¼–å· 32ä½ [resStr appendFormat:@&quot;00000000000000000000000000001011&quot;]; // æ·»åŠ ç¡®è®¤å¸§ 32ä½ [resStr appendFormat:@&quot;00000000000000000000000011111011&quot;]; // æ·»åŠ æŠ¥å¤´é•¿åº¦ [resStr appendFormat:@&quot;0101&quot;]; // æ·»åŠ ä¿ç•™é•¿åº¦ [resStr appendFormat:@&quot;000000&quot;]; // æ·»åŠ FLag [resStr appendFormat:@&quot;000000&quot;]; // æ·»åŠ çª—å£å¤§å° [resStr appendFormat:@&quot;0000000000000111&quot;]; // æ·»åŠ ç¡®è®¤å€¼ [resStr appendFormat:@&quot;0101010101010010&quot;]; // æ·»åŠ UrgentPointer [resStr appendFormat:@&quot;0000000000001111&quot;]; // æ·»åŠ Headerç»“å°¾ [resStr appendFormat:@&quot;#%@&quot;, str]; dispatch_async(dispatch_get_main_queue(), ^&#123; self.transLayer.stringValue = [resStr copy]; &#125;); [NSThread sleepForTimeInterval:0.3]; return [self networkLayerWith:resStr];&#125;// æ¨¡æ‹Ÿç½‘ç»œå±‚å¯¹æ•°æ®çš„åŒ…è£…- (NSMutableString *)networkLayerWith:(NSMutableString *)str &#123; NSMutableString *resStr = [NSMutableString string]; // æ·»åŠ VER [resStr appendFormat:@&quot;0100&quot;]; // æ·»åŠ HLEN [resStr appendFormat:@&quot;1111&quot;]; // æ·»åŠ Service [resStr appendFormat:@&quot;00000000&quot;]; // æ·»åŠ totalLength [resStr appendFormat:@&quot;0101010101010101&quot;]; // æ·»åŠ Identification [resStr appendFormat:@&quot;0000000000000000&quot;]; // æ·»åŠ Flag [resStr appendFormat:@&quot;000&quot;]; // æ·»åŠ FragmentationOffset [resStr appendFormat:@&quot;0000000000000&quot;]; // æ·»åŠ TTL [resStr appendFormat:@&quot;00000000&quot;]; // æ·»åŠ Protocol [resStr appendFormat:@&quot;00000000&quot;]; // æ·»åŠ HeaderChecksum [resStr appendFormat:@&quot;0000000000000000&quot;]; // æ·»åŠ SourIPAddress [resStr appendFormat:@&quot;00000000000000000000000000000000&quot;]; // æ·»åŠ DestinationIPAddress [resStr appendFormat:@&quot;00000000000000000000000000000000&quot;]; // æ·»åŠ Headerç»“å°¾ [resStr appendFormat:@&quot;#%@&quot;, str]; dispatch_async(dispatch_get_main_queue(), ^&#123; self.networkLayer.stringValue = [resStr copy]; &#125;); [NSThread sleepForTimeInterval:0.3]; return [self dlinkLayerWithString:resStr];&#125;// æ¨¡æ‹Ÿé“¾è·¯å±‚å¯¹æ•°æ®çš„åŒ…è£…- (NSMutableString *)dlinkLayerWithString:(NSMutableString *)str &#123; NSMutableString *resStr1 = [NSMutableString string]; // æ·»åŠ FrameFlag1 [resStr1 appendFormat:@&quot;00001111&quot;]; // æ·»åŠ FrameAdd [resStr1 appendFormat:@&quot;11101011&quot;]; // æ·»åŠ FrameControl [resStr1 appendFormat:@&quot;01111000&quot;]; NSMutableString *resStr2 = [NSMutableString string]; // æ·»åŠ FrameFCS [resStr2 appendFormat:@&quot;00001111&quot;]; // æ·»åŠ FrameFlag2 [resStr2 appendFormat:@&quot;11101011&quot;]; // åˆæˆå¸§ NSMutableString *resStr = [NSMutableString stringWithFormat:@&quot;%@#%@#%@&quot;, resStr1, str, resStr2]; dispatch_async(dispatch_get_main_queue(), ^&#123; self.dlinkLayer.stringValue = [resStr copy]; &#125;); [NSThread sleepForTimeInterval:0.3]; return [self phyLayerWithString:resStr];&#125;// æ¨¡æ‹Ÿç‰©ç†å±‚å¯¹æ•°æ®çš„åŒ…è£…- (NSMutableString *)phyLayerWithString:(NSMutableString *)str &#123; NSMutableString *resStr = [NSMutableString stringWithFormat:@&quot;PhysicsHeader#%@&quot;, str]; dispatch_async(dispatch_get_main_queue(), ^&#123; self.phyLayer.stringValue = [resStr copy]; &#125;); [NSThread sleepForTimeInterval:0.3]; return resStr;&#125; å…¶ä»–ç»†èŠ‚1ã€åœ¨å®šä¹‰Socketåœ°å€ç«¯å£æ—¶ï¼Œè¦æ³¨æ„ç«¯å£å€¼ç±»åž‹ï¼Œè‹¥ä½¿ç”¨htonsï¼Œåˆ™éœ€è¦è½¬æ¢ä¸ºshortç±»åž‹(16ä½)ã€‚server_addr.sin_port = htons((short)port); æœ¬æ–‡æºä»£ç ï¼šGithub: https://github.com/Minecodecraft/TCP-IP-Model-SimulationåŽŸæ–‡åœ°å€ï¼šMinecodeâ€™s Blog: TCPäº”å±‚æ¨¡åž‹æ¶ˆæ¯è§£/å°è£…ä»¿çœŸ]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>TCP/IP</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨iOS ARKitåˆ¶ä½œARä¼ é€é—¨]]></title>
    <url>%2F2017%2F11%2F11%2F%E5%88%A9%E7%94%A8iOS%20ARKit%E5%88%B6%E4%BD%9CAR%E4%BC%A0%E9%80%81%E9%97%A8%2F</url>
    <content type="text"><![CDATA[å‰è¨€è‹¹æžœæŽ¨å‡ºARKitåŠå¹´äº†ï¼Œå¼€å‘è€…å¯¹å…¶å…´è¶£æœ‰å¢žæ— å‡ï¼ŒARäº§ä¸šä¹Ÿå€Ÿè‹¹æžœè°·æ­Œç­‰åŽ‚å•†çš„åŠªåŠ›å¾—åˆ°äº†å¿«é€Ÿå‘å±•ã€‚ä½œä¸ºå¹¿å¤§iOSå¼€å‘è€…çš„ä¸€å‘˜ï¼Œæˆ‘ä¹ŸåŠ å…¥äº†å­¦ä¹ ARçš„é˜Ÿä¼ä¸­ã€‚å¾—ç›ŠäºŽSceneKitä¼˜è¶Šçš„æ€§èƒ½å’Œå°è£…ï¼ŒARKitçš„å¼€å‘ä¹Ÿå¦‚é±¼å¾—æ°´ï¼Œå¦‚æžœä½ æœ‰SceneKitå¼€å‘ç»éªŒï¼Œé‚£ä¹ˆçŸ­æ—¶é—´å¼€å‘å‡ºä¸€æ¬¾å¾ˆé…·çš„ARåº”ç”¨ä¸æ˜¯éš¾äº‹ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨ARKitæ¥åˆ¶ä½œä¸€ä¸ªä¼ é€é—¨ï¼ˆæˆ–è€…è¯´å“†å•¦Aæ¢¦çš„ä»»æ„é—¨ï¼‰ é¡¹ç›®æ•ˆæžœï¼š å‰æœŸå‡†å¤‡åˆ¶ä½œå‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½ä»»æ„é—¨ä¸­çš„3Dæ¨¡åž‹ï¼Œä»¥åŠä»»æ„é—¨ä¸­çš„å¤©ç©ºç›’è´´å›¾ã€‚åœ¨è¿™é‡Œæˆ‘ä½¿ç”¨äº†å¤§å­¦çš„é’Ÿå¡”æ¨¡åž‹ï¼Œä½¿ç”¨äº†Cinema4Dåˆ¶ä½œï¼ŒSceneKitæ”¯æŒdaeæˆ–objæ ¼å¼çš„æ¨¡åž‹ï¼Œå¯¼å…¥åŽå¯ä»¥è½¬æ¢æˆSceneKitå¯¹åº”çš„scnæ ¼å¼ã€‚å¤©ç©ºç›’è´´å›¾æ˜¯ä»€ä¹ˆï¼Ÿæ¸¸æˆä¸­å¯¹äºŽä¸€äº›æœ‰è¾¹ç•Œåœ°å›¾ï¼Œæƒ³è¦åˆ›é€ è¿œè·ç¦»åœºæ™¯çš„è§†è§‰æ•ˆæžœï¼Œå°±å¯ä»¥é‡‡ç”¨å°†å¤©ç©ºç›’åŒ…è£¹å½“å‰çœŸå®žåœºæ™¯çš„æ–¹æ³•ï¼Œå¦‚CSã€‚ é¡¹ç›®çš„é…ç½®1. Info.plistçš„é…ç½®ARéœ€è¦ä½¿ç”¨æ‘„åƒå¤´æƒé™ï¼Œåœ¨Info.plisä¸­æ·»åŠ â€œPrivacy - Camera Usage Descriptionâ€é”®å€¼ 2. ç•Œé¢è®¾ç½®æ˜¾ç¤ºARæ‘„åƒæœºï¼Œéœ€è¦ä½¿ç”¨ARåœºæ™¯æŽ§ä»¶ï¼Œæ‹–ARKit Scene Viewè‡³æ•…äº‹ç‰ˆï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦æ”¾ç½®æŒ‰é’®ä»¥åŠæ£€æµ‹åˆ°å¹³é¢çš„æç¤ºLabel å¼€å§‹Codingé…ç½®ARSceneViewARKitè¿½è¸ªéœ€è¦ä¸€ä¸ªARä¸–ç•Œè¿½è¸ªé…ç½®é¡¹ï¼Œå¯ä»¥é€šè¿‡å®žä¾‹åŒ–ARWorldTrackingConfigurationç±»æ¥å®žçŽ°ï¼ˆæ—©æœŸæ˜¯ARWorldTrackingSessionConfigurationï¼‰ã€‚æˆ‘ä»¬æƒ³è¦è¿½è¸ªæ°´å¹³é¢ï¼Œä»Žè€Œæ”¾ç½®ä¼ é€é—¨æ¨¡åž‹ï¼Œæ‰€ä»¥åœ¨æ­¤å°†å…¶planeDetectionè®¾ç½®ä¸ºè¿½è¸ªæ°´å¹³é¢ã€‚12345678910111213141516// ç”¨äºŽé…ç½®ARä¸–ç•Œè¿½è¸ª// The Configuration of World Trackinglet configuration = ARWorldTrackingConfiguration()var planeAnchor: ARPlaneAnchor?override func viewDidLoad() &#123; super.viewDidLoad() // è®¾ç½®ARå¹³é¢æ£€æµ‹ç±»åž‹ // set the plane detecing type of world tracking configuration.planeDetection = .horizontal sceneView.debugOptions = [ARSCNDebugOptions.showFeaturePoints] sceneView.session.run(configuration) sceneView.delegate = self sceneView.automaticallyUpdatesLighting = true&#125; èŽ·å–è¿½è¸ªå¹³é¢æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥è®¾ç½®äº†æ°´å¹³é¢è¿½è¸ªï¼Œåœ¨è¿™é‡Œè¿›è¡Œè®¾ç½®ã€‚ARKitæä¾›äº†è¯†åˆ«æ°´å¹³é¢çš„ä»£ç†æ–¹æ³•ï¼Œåœ¨ARSCNViewDelegateä¸­ã€‚ARKitä¼šä¸åœè¿½è¸ªå¹³é¢ï¼Œå½“è¿½è¸ªåˆ°æ–°å¹³é¢(plane)æ—¶ï¼Œä¼šå‘è¯¥å¹³é¢ä¸Šæ·»åŠ é”šç‚¹(anchor)ã€‚ä»£ç†ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¸€ä»£ç†æ–¹æ³•ã€‚å¯¹äºŽè¿½è¸ªåˆ°çš„å¹³é¢ï¼Œä¼šæ·»åŠ ARAnchorï¼Œè€Œå¦‚æžœæ£€æµ‹åˆ°çš„æ˜¯ç”¨æˆ·è®¾ç½®çš„æ£€æµ‹å¹³é¢(æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„planeDetection)ï¼Œå°†ä¼šæ”¾ç½®ARPlaneAnchorã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æŽ¥åˆ¤æ–­è¯¥anchorçš„ç±»åž‹å³å¯ã€‚123456789101112// MARK: - ARSCNViewDelegate implementionextension ARViewController: ARSCNViewDelegate &#123; func renderer(_ renderer: SCNSceneRenderer, didAdd node: SCNNode, for anchor: ARAnchor) &#123; // å¦‚æžœæ£€æµ‹åˆ°çš„æ˜¯æ°´å¹³é¢ï¼Œé‚£ä¹ˆå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œæ‰€ä»¥åœ¨æ­¤åˆ¤æ–­æ˜¯å¦ä¸ºæ°´å¹³é¢ guard anchor is ARPlaneAnchor else &#123;return&#125; self.planeAnchor = anchor as? ARPlaneAnchor // å¤„ç†é€»è¾‘ &#125;&#125; èŽ·å–å¹³é¢çš„ä½ç½®ä¸Šä¸€æ­¥æˆ‘ä»¬èŽ·å–äº†æ°´å¹³é¢å¯¹åº”çš„ARPlaneAnchorï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦èŽ·å–è¯¥å¹³é¢åœ¨ARä¸–ç•Œä¸­çš„ä½ç½®ä¿¡æ¯ã€‚æ–¹æ³•å°±æ˜¯ä½¿ç”¨transformå±žæ€§ï¼Œè¯¥å±žæ€§è¿”å›žä¸€ä¸ªmatrix_float4x4ç»“æž„ä½“ã€‚äº†è§£è¿‡è®¡ç®—æœºå›¾å½¢å­¦çš„åº”è¯¥çŸ¥é“ï¼Œå›¾å½¢çš„å˜æ¢çŸ©é˜µæ­£æ˜¯è¿™æ ·çš„ä¸€ä¸ªç»“æž„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹transformä¸­çš„å¯¹åº”ä½ç½®å€¼ï¼Œå°±å¯ä»¥å¯¹å›¾å½¢è¿›è¡Œè‡ªç”±å˜æ¢ã€‚è€Œæˆ‘ä»¬çŽ°åœ¨åªéœ€è¦èŽ·å–ä»–çš„åæ ‡ä¿¡æ¯ï¼Œä¹Ÿå°±å¯¹åº”ç€ç¬¬3è¡Œçš„å‰ä¸‰ä¸ªå€¼ã€‚åŒæ—¶ï¼Œåœ¨SceneKitä¸­ä¸‰ç»´åæ ‡ä½¿ç”¨çš„æ˜¯SCNVector3ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ­¤æ‰©å±•SCNVector3ä»¥ä¾¿å¤ç”¨ã€‚123456789extension SCNVector3 &#123; init (withTransform transform: matrix_float4x4) &#123; self.x = transform.columns.3.x self.y = transform.columns.3.y self.z = transform.columns.3.z &#125;&#125; è®¾ç½®æ¨¡åž‹åœ¨åˆ›å»ºæ¨¡åž‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ¨¡åž‹çš„é›†åˆï¼Œæ‹“å±•åä¸ºscnassetsã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤©ç©ºç›’ï¼Œå¹¶å°†æƒ³è¦å¾€å…¶ä¸­æ”¾ç½®çš„æ¨¡åž‹ä¹Ÿä¸€å¹¶æ”¾ç½®ã€‚å¤©ç©ºç›’çš„æè´¨è®¾ç½®ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½çš„å¤©ç©ºç›’è´´å›¾ã€‚ä½†æ˜¯çŽ°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•æ‰èƒ½ä½¿è¿™ä¸ªå¤©ç©ºç›’åœ¨å¤–é¢ä¸å¯è§è€Œåœ¨é‡Œé¢å¯è§å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼Œä½¿ç”¨æ¸²æŸ“é¡ºåºï¼Œæ¸²æŸ“é¡ºåºåœ¨å‰çš„ä¼˜å…ˆæ¸²æŸ“ï¼Œæ¸²æŸ“é¡ºåºå†³å®šäº†æ¨¡åž‹ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼˜å…ˆæ¸²æŸ“å‰é¢çš„é€æ˜Žé®ç½©å¹³é¢æ¥æ¥åŽé¢çš„å†…å®¹â€œè¢«é€æ˜Žâ€ã€‚æ‰€ä»¥åœ¨æ¯ä¸€ä¸ªå¹³é¢ä¸Šæ·»åŠ ä¸€ä¸ªåä¸ºâ€œmaskâ€çš„å¹³é¢ï¼Œå¤§å°ä¸Žçˆ¶å¹³é¢ç›¸åŒå³å¯ï¼ŒåŽšåº¦å°½å¯èƒ½å°å°±å¥½ã€‚å¦‚ä¸‹å›¾ï¼Œå…·ä½“è¯·è§å·¥ç¨‹æºæ–‡ä»¶ã€‚ ä½¿å¤©ç©ºç›’ä»Žå¤–é¢ä¸å¯è§é¦–å…ˆæˆ‘ä»¬å…ˆæ·»åŠ æ¨¡åž‹ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œåœ¨æ­¤ä¸èµ˜è¿°ã€‚12345guard let portalScene = SCNScene(named: "Model.scnassets/tjgc.scn") else &#123;return&#125;let portalNode = portalScene.rootNode.childNode(withName: "tjgc", recursively: false)!let newVector3 = SCNVector3.init(withTransform: transform)portalNode.position = SCNVector3.init(newVector3.x, newVector3.y, newVector3.z-1)sceneView.scene.rootNode.addChildNode(portalNode) æŽ¥ä¸‹æ¥å°±æ˜¯å®žçŽ°çš„é‡ç‚¹ï¼šå¦‚ä½•å¯ä»¥è®©å¤©ç©ºç›’ä»Žå¤–é¢ä¸å¯è§ï¼Ÿåˆšæ‰è°ˆåˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®©ä¸€ä¸ªæ¸²æŸ“é¡ºåºæ›´é å‰çš„é€æ˜Žå¹³é¢é®æŒ¡æ¥å®žçŽ°è®©æŸä¸ªå¹³é¢â€œè¢«é€æ˜Žâ€çš„æ•ˆæžœï¼Œè€Œè¿™æ ·ä¹Ÿå¯ä»¥ä½¿å¦ä¸€ä¸ªæ–¹å‘è§‚å¯Ÿä¸å—å½±å“ã€‚åœ¨SceneKitä¸­ï¼Œæ¸²æŸ“é¡ºåºå¯¹åº”renderingOrderå±žæ€§ï¼Œæ•°å€¼è¶Šå°è¶Šä¼˜å…ˆæ¸²æŸ“ã€‚123let child = portalNode.childNode(withName: nodeName, recursively: true)child?.geometry?.firstMaterial?.diffuse.contents = UIImage(named: "Model.scnassets/\(imageName).png")child?.renderingOrder = 200 å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠéœ€è¦å¤„ç†çš„èŠ‚ç‚¹å–å‡ºå¹¶è®¾ç½®æ¸²æŸ“é¡ºåºå³å¯ã€‚ é‡ç½®ARåœºæ™¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æƒ³è¦é‡ç½®ARè¿½è¸ªï¼Œå¹¶å°†çŽ°æœ‰èŠ‚ç‚¹å…¨éƒ¨ç§»é™¤ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å®žçŽ°ï¼š12345678910111213141516func reset() &#123; // æ¸…é™¤èŠ‚ç‚¹ä¹‹å‰å…ˆåœæ­¢ARä¼šè¯ï¼Œå¦åˆ™ä¼šcrash // pause ar session before remove node, or will be crash self.sceneView.session.pause() self.sceneView.scene.rootNode.enumerateChildNodes &#123; (node, _) in node.removeFromParentNode() &#125; self.planeAnchor = nil self.addButton.isEnabled = false // ä½¿ç”¨é‡ç½®é…ç½®å¯åŠ¨ARä¼šè¯ï¼Œåœºæ™¯å°†ä¼šè¢«é‡ç½® // Run AR session with reset options, then session will be reset self.sceneView.session.run(configuration, options: [.resetTracking, .removeExistingAnchors])&#125; å…·ä½“ä»£ç è§Githubé¡¹ç›®ï¼š https://github.com/Minecodecraft/ARDoor å¦‚æžœæœ‰é—®é¢˜ï¼Œæ¬¢è¿Žè¯„è®ºåŒºç•™è¨€]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>ARKit</tag>
        <tag>SceneKit</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç»“æž„ä½“çš„è‡ªå¼•ç”¨åŠç›¸äº’å¼•ç”¨]]></title>
    <url>%2F2017%2F10%2F01%2F%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E8%87%AA%E5%BC%95%E7%94%A8%E5%8F%8A%E7%9B%B8%E4%BA%92%E5%BC%95%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ç®€è¿°åœ¨ç”¨Cæ¥å®žçŽ°æ•°æ®ç»“æž„ä»¥åŠéƒ¨åˆ†ç®—æ³•æ—¶ï¼Œç»å¸¸ç”¨åˆ°ç»“æž„ä½“ï¼Œæ¯”å¦‚å®žçŽ°æ ‘ä»¥åŠæ ‘çš„å­èŠ‚ç‚¹æ—¶ï¼Œå°±éœ€è¦è¯¥ç»“æž„ä½“åŒ…å«è‡ªèº«ç±»åž‹çš„æˆå‘˜å˜é‡ã€‚è€Œæœ€è¿‘åœ¨ç ”ç©¶OCçš„åŒ¿åå‡½æ•°å®žçŽ°æ—¶ï¼Œä¹Ÿæ¶‰åŠåˆ°äº†ç±»ä¼¼éœ€æ±‚ã€‚åŒæ—¶ï¼Œä¸¤ä¸ªç»“æž„ä½“ä¹‹é—´ç›¸äº’å¼•ç”¨ä¹Ÿç»å¸¸é‡åˆ°é—®é¢˜ã€‚æ•…ç®€å•æ€»ç»“ä¸€ä¸‹Cè¯­è¨€ç»“æž„ä½“çš„è‡ªå¼•ç”¨è¯­æ³•ã€‚ ç¤ºä¾‹æˆ‘ä»¬ä»¥äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ºä¾‹æ¥çœ‹ä¸€ä¸‹è‡ªå¼•ç”¨ï¼š12345struct binary_tree &#123; int data ; // Data area struct binary_tree * left; struct binary_tree * right;&#125;; åœ¨æ ‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜å…¶å·¦å³å­æ ‘ï¼Œæ‰€ä»¥éœ€è¦å¼•ç”¨è‡ªèº«ã€‚ ç»“æž„ä½“è‡ªå¼•ç”¨ä¸ä½¿ç”¨typedefå¦‚æžœä¸é€‚ç”¨typedefï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨struct [åç§°]æ¥è°ƒç”¨ã€‚ä½†å¦‚æžœæŒ‰ä¸‹é¢çš„è°ƒç”¨æ–¹å¼12345struct binary_tree &#123; int data; struct binary_tree left; struct binary_tree right;&#125;; åˆ™ä¼šå¯¼è‡´åœ¨åˆ†é…å†…å­˜çš„æ—¶å€™å¾ªçŽ¯åˆ†é…ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šè®¡ç®—leftå’Œrightçš„æˆå‘˜å˜é‡å¹¶ä¸ºä¹‹åˆ†é…å†…å­˜ï¼Œä»Žè€Œå¯¼è‡´åµŒå¥—æ­»å¾ªçŽ¯ã€‚12345struct binary_tree &#123; int data; struct binary_tree * left; struct binary_tree * right;&#125;; æ‰€ä»¥åŽè€…æ˜¯æ­£ç¡®çš„ï¼Œleftå’Œrightåœ¨åˆ†é…æ—¶æ˜¯ä»¥ç»“æž„ä½“æŒ‡é’ˆçš„å½¢å¼æ¥åˆ†é…å†…å­˜çš„ã€‚è€Œæ„ä¹‰ä¸Šæˆ‘ä»¬å°±æ˜¯ä¸ºäº†å°†å…¶æŒ‡å‘å¦ä¸€ä¸ªbinary_treeï¼Œæ‰€ä»¥è¿™æ ·æ˜¯å¤åˆé€»è¾‘çš„ã€‚ ä½¿ç”¨typedefä½¿ç”¨typedefå¯ä»¥ä¸ºç»“æž„ä½“è®¾ç½®åˆ«åï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œtypdefçš„è¯­æ³•ä¸ºtypedef [åŽŸç±»åž‹] [åˆ«å];æ‰€ä»¥åœ¨ç»“æž„ä½“å£°æ˜Žä¹‹å‰ï¼Œåˆ«åæ˜¯æœªå®šä¹‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å†…éƒ¨éœ€è¦ä½¿ç”¨å…¶åŽŸç±»åž‹æ¥å®šä¹‰æˆå‘˜å˜é‡ã€‚12345typedef struct binary_tree &#123; int data; struct binary_tree * left; struct binary_tree * right;&#125;BinTREE; ç»“æž„ä½“ç›¸äº’å¼•ç”¨åŒæ–‡ä»¶å†…ä½¿ç”¨ä¸å®Œæ•´ç±»åž‹é€šè¿‡ä¸å®Œæ•´ç±»åž‹è¯­æ³•æ¥å®žçŽ°ç›¸äº’å¼•ç”¨123456789struct s_a &#123; int id; struct s_b *B_Ptr;&#125;;struct s_b &#123; int id; A *A_Ptr;&#125;; ä½¿ç”¨å‰å‘å£°æ˜Ž123456789101112typedef struct s_a A;typedef struct s_b B;struct s_a &#123; int id; B *B_Ptr;&#125;;struct s_b &#123; int id; A *A_Ptr;&#125;; ä¸åŒæ–‡ä»¶å†…å¯¹äºŽä¸åŒæ–‡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„çš„ã€‚ å¤´æ–‡ä»¶é‡å¤åŒ…å«é—®é¢˜ ç»“æž„ä½“çš„å£°æ˜Žé—®é¢˜ è€Œå‰è€…é€šè¿‡å®å®šä¹‰è§£å†³123456#ifndef __FILENAME_H#define __FILENAME_H// ä»£ç #endif åŽè€…é€šè¿‡ä¸Šè¿°çš„â€œå‰å‘å£°æ˜Žâ€æˆ–â€œä¸å®Œæ•´ç±»åž‹å³å¯è§£å†³â€ã€‚]]></content>
      <categories>
        <category>æ•°æ®ç»“æž„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æž„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSå¤šç»§æ‰¿çš„å®žçŽ°åŠåŒºåˆ«]]></title>
    <url>%2F2017%2F09%2F11%2FiOS%E5%A4%9A%E7%BB%A7%E6%89%BF%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[å¤šç»§æ‰¿å¯ä»¥å…è®¸å­ç±»ä»Žå¤šä¸ªçˆ¶ç±»æ´¾ç”Ÿï¼Œè€ŒObjective-Cå¹¶ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½†æˆ‘ä»¬ä»å¯é—´æŽ¥å®žçŽ°ã€‚ Objective-Cå®žçŽ°å¤šç»§æ‰¿ä¸»è¦å¯ä»¥é€šè¿‡åè®®ã€åˆ†ç±»ã€æ¶ˆæ¯è½¬å‘æ¥å®žçŽ°ã€‚æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å…¶ä½¿ç”¨ä»¥åŠä¼˜ç¼ºç‚¹ã€‚ é€šè¿‡åè®®å®žçŽ°åè®®ä¸»è¦æ˜¯ç”¨æ¥æå‡ºç±»åº”éµå®ˆçš„æ ‡å‡†ï¼Œä½†å…¶ç‰¹æ€§ä¹Ÿå¯ç”¨æ¥å®žçŽ°å¤šç»§æ‰¿ã€‚ä¸€ä¸ªç±»å¯ä»¥éµå®ˆå¤šä¸ªåè®®ï¼Œä¹Ÿå³å®žçŽ°å¤šä¸ªåè®®çš„æ–¹æ³•ï¼Œä»¥æ­¤æ¥è¾¾åˆ°å¤šç»§æ‰¿çš„æ•ˆæžœã€‚ æ¦‚å¿µä¸Šçš„å•ç»§æ‰¿å’Œå¤šç»§æ‰¿åº”è¯¥æ˜¯ç»§æ‰¿çˆ¶ç±»çš„å±žæ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”ä¸ç»é‡å†™å³å¯ä½¿ç”¨ï¼Œä½†é€šè¿‡åè®®å®žçŽ°å¤šç»§æ‰¿æœ‰å¦‚ä¸‹ä¸åŒ: å­ç±»éœ€è¦å®žçŽ°åè®®æ–¹æ³• ç”±äºŽåè®®æ— æ³•å®šä¹‰å±žæ€§ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•åªèƒ½å®žçŽ°æ–¹æ³•çš„å¤šç»§æ‰¿ ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç : 1234567891011121314151617181920212223242526272829303132333435// ç¼–ç¨‹æŠ€èƒ½@protocol Program &lt;NSObject&gt;- (void)program;@end// ç»˜ç”»æŠ€èƒ½@protocol Draw &lt;NSObject&gt;- (void)draw;@end// æ­Œå”±æŠ€èƒ½@protocol Sing &lt;NSObject&gt;- (void)sing;@end// åŽŸæœ¬ä¸€ä¸ªä»€ä¹ˆä¹Ÿä¸ä¼šçš„ç¨‹åºå‘˜// å­¦ä¼šäº†å¤šä¸ªæŠ€èƒ½@interface Programmer : NSObject &lt;Draw, Sing&gt;// ç»§æ‰¿çš„åè®®æ–¹æ³•è‡ªåŠ¨å…¬æœ‰ï¼Œæ— é¡»å£°æ˜ŽæŽ¥å£@end@interface Programmer () &lt;Program&gt;// ç»§æ‰¿çš„åè®®æ–¹æ³•è‡ªåŠ¨ç§æœ‰ï¼Œæ— é¡»å£°æ˜ŽæŽ¥å£@end// éœ€è¦è‡ªè¡Œå®žçŽ°åè®®æ–¹æ³•@implementation Programmer- (void)program &#123; NSLog(@&quot;I&apos;m writing bugs!&quot;);&#125;- (void)draw &#123; NSLog(@&quot;I can draw&quot;);&#125;- (void)sing &#123; NSLog(@&quot;Lalalallalalala&quot;);&#125;@end é€šè¿‡ä¸‹é¢çš„åè®®éµå®ˆï¼Œè¯¥ç¨‹åºå‘˜ç±»æŽŒæ¡äº†ç¼–ç¨‹ã€å”±æ­Œã€ç»˜ç”»å¤šä¸ªæŠ€èƒ½ã€‚åŒæ—¶ä¹Ÿå¯ä»¥æ ¹æ®éµå®ˆåè®®çš„ä½ç½®ç»å¯¹åè®®æ–¹æ³•æ˜¯å¦å…¬å¼€ï¼Œä¸Šè¿°ä»£ç ä¸­drawå’Œsingæ–¹æ³•å…¬å¼€ï¼Œè€Œprogramä¸ºç§æœ‰æ–¹æ³•ï¼ˆæ¯•ç«Ÿå”±æ­Œç”»ç”»æ˜¯è¦å±•ç¤ºç»™å¤§å®¶çš„ :P é€šè¿‡ç±»åˆ«å®žçŽ°ä¸‹é¢å°±æœ‰è¯·Objective-Cçš„ä¸€å¤§é»‘é­”æ³•â€”â€”Catagory(åˆ†ç±»)ã€‚ ç›¸å¯¹äºŽåè®®ï¼Œå®ƒçš„Runtimeç‰¹æ€§é€ å°±äº†å…¶ä¸€å®šä¼˜åŠ¿: å¯ä»¥ä¸ºç±»æ·»åŠ æ–¹æ³• å¯ä»¥ä¸ºç±»æ·»åŠ å®žä¾‹(é€šè¿‡Runtime)ï¼Œè¿™æ˜¯åè®®åšä¸åˆ°çš„ åˆ†ç±»æ–¹ä¾¿ç®¡ç† ä¸‹é¢æ¥çœ‹ä¸€ä¸‹é€šè¿‡åˆ†ç±»æ¥å®žçŽ°å¤šç»§æ‰¿: 123456789101112131415161718192021222324252627282930313233343536/* åˆ†ç±»å¤´æ–‡ä»¶ */#import &quot;Programmer.h&quot;@interface Programmer (Program)// å£°æ˜Žå±žæ€§@property (nonatomic, assign) NSString *motto;// å£°æ˜Žå…¬æœ‰æ–¹æ³•- (void)draw;- (void)sing;@end/* åˆ†ç±»å®žçŽ°æ–‡ä»¶ */#import &lt;objc/runtime.h&gt;@implementation Programmer (Program)// ä¸ºCatagoryæ·»åŠ å±žæ€§static const char kMottoKey;- (void)setMotto:(NSString *)motto &#123; objc_setAssociatedObject(self, &amp;kMottoKey, motto, OBJC_ASSOCIATION_COPY_NONATOMIC);&#125;- (NSString *)motto &#123; return objc_getAssociatedObject(self, &amp;kMottoKey);&#125;// ç§æœ‰æ–¹æ³•- (void)program &#123; NSLog(@&quot;I&apos;m writing bugs!&quot;);&#125;// å®žçŽ°å…¬æœ‰æ–¹æ³•- (void)draw &#123; NSLog(@&quot;I can draw&quot;);&#125;- (void)sing &#123; NSLog(@&quot;Lalalalallalala&quot;);&#125;@end é€šè¿‡æ·»åŠ åˆ†ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç¨‹åºå‘˜æ·»åŠ å„ç§æ–¹æ³•ï¼ŒåŒæ—¶é€šè¿‡Runtimeè¿™ä¸€é»‘é­”æ³•å®žçŽ°äº†åŠ¨æ€æ·»åŠ å±žæ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥é€šè¿‡ç‚¹è¯­æ³•ä¸ºç¨‹åºå‘˜è®¾ç½®åº§å³é“­ã€‚ åŒæ—¶ï¼Œåˆ†ç±»çš„æ–‡ä»¶åœ¨ç®¡ç†ä¸Šä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œå¦‚æžœä¸æƒ³ç”¨ç›´æŽ¥åˆ é™¤#importå³å¯ï¼Œçµæ´»æ€§è¾ƒå¼ºã€‚ å…³äºŽCatagoryæ·»åŠ å±žæ€§çš„æ–¹å¼å¯ä»¥è‡ªè¡Œå­¦ä¹ Runtimeã€‚ é€šè¿‡æ¶ˆæ¯è½¬å‘æ¶ˆæ¯è½¬å‘ä¹Ÿæ˜¯Runtimeçš„é»‘é­”æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨å¤„å°±æ˜¯å¯ä»¥å®žçŽ°å¤šç»§æ‰¿ï¼Œå½“å‘é€æ¶ˆæ¯åŽæ‰¾ä¸åˆ°å¯¹åº”çš„æ–¹æ³•å®žçŽ°æ—¶ï¼Œä¼šç»è¿‡å¦‚ä¸‹è¿‡ç¨‹: åŠ¨æ€æ–¹æ³•è§£æž: é€šè¿‡resolveInstanceMethod:æ–¹æ³•ï¼Œæ£€æŸ¥æ˜¯å¦é€šè¿‡@dynamicåŠ¨æ€æ·»åŠ äº†æ–¹æ³•ã€‚ ç›´æŽ¥æ¶ˆæ¯è½¬å‘: ä¸ä¿®æ”¹åŽŸæœ¬æ–¹æ³•ç­¾åï¼Œç›´æŽ¥æ£€æŸ¥forwardingTargetForSelector:æ˜¯å¦å®žçŽ°ï¼Œè‹¥è¿”å›žéžnilä¸”éžselfï¼Œåˆ™å‘è¯¥è¿”å›žå¯¹è±¡ç›´æŽ¥è½¬å‘æ¶ˆæ¯ã€‚ æ ‡å‡†æ¶ˆæ¯è½¬å‘: å…ˆå¤„ç†æ–¹æ³•è°ƒç”¨å†è½¬å‘æ¶ˆæ¯ï¼Œé‡å†™methodSignatureForSelector:å’ŒforwardInvocation:æ–¹æ³•ï¼Œå‰è€…ç”¨äºŽä¸ºè¯¥æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªåˆé€‚çš„æ–¹æ³•ç­¾åï¼ŒåŽè€…åˆ™æ˜¯å°†è¯¥æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚ ä¸Šè¿°è¿‡ç¨‹å‡æœªå®žçŽ°ï¼Œåˆ™ç¨‹åºå¼‚å¸¸ã€‚ æˆ‘ä»¬çŽ°åœ¨å°è¯•2å’Œ3ä¸¤ç§æ–¹æ¡ˆ: ç›´æŽ¥æ¶ˆæ¯è½¬å‘1234567891011121314151617181920212223242526272829303132333435363738394041/* Programmerå®žçŽ°æ–‡ä»¶ */@implementation Programmer// é€šè¿‡æ¶ˆæ¯è½¬å‘å®žçŽ°å¤šç»§æ‰¿- (id)forwardingTargetForSelector:(SEL)aSelector &#123; Singer *singer = [[Singer alloc] init]; Artist *artist = [[Artist alloc] init]; if ([singer respondsToSelector:aSelector]) &#123; return singer; &#125; else if ([artist respondsToSelector:aSelector]) &#123; return artist; &#125; return nil;&#125;@end/* Artistä»£ç  */@interface Artist : NSObject// ç”»å®¶å¯ä»¥ç»˜ç”»- (void)draw;@end@implementation Artist- (void)draw &#123; NSLog(@&quot;I can draw&quot;);&#125;@end/* Singerä»£ç  */@interface Singer : NSObject// æ­Œæ‰‹ä¼šå”±æ­Œ- (void)sing;@end@implementation Singer- (void)sing &#123; NSLog(@&quot;Lalalalalala&quot;);&#125;@end é€šè¿‡ç›´æŽ¥è½¬å‘æ¶ˆæ¯åˆ°å…¶ä»–ç±»åž‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å®žçŽ°äº†å¤šç»§æ‰¿ã€‚å¦‚ä¸‹è°ƒç”¨ï¼Œç»“æžœèƒ½å¤Ÿå®Œæˆå”±æ­Œå’Œç»˜ç”» 12345678Programmer *programmer = [[Programmer alloc] init];// åœ¨performSelectorä¸­ä½¿ç”¨NSSelectorFromStringä¼šé€ æˆè­¦å‘Š// å¯ä»¥é€šè¿‡è®¾ç½®ä¸æ£€æµ‹performSelectorå†…å­˜æ³„éœ²å…³é—­è­¦å‘Š[programmer performSelector:NSSelectorFromString(@&quot;sing&quot;) withObject:nil];// æˆ–è€…é€šè¿‡ç±»åž‹å¼ºè½¬æ¥å®žçŽ°ï¼Œæ— è­¦å‘Š[(Artist *)programmer draw]; é€šè¿‡æ¶ˆæ¯è½¬å‘ï¼Œæˆ‘ä»¬å®žçŽ°äº†åŠ¨æ€æ€§ï¼ŒåŠçœŸæ­£çš„å°†æ–¹æ³•äº¤ç»™å…¶ä»–ç±»æ¥å®žçŽ°ï¼Œè€Œéžåè®®æˆ–è€…åˆ†ç±»æ‰€éœ€è¦è‡ªè¡Œå®žçŽ°ã€‚åŒæ—¶ï¼Œæ¶ˆæ¯è½¬å‘ä¹Ÿç»™æˆ‘ä»¬äº†å……åˆ†çš„çµæ´»æ€§ï¼Œå¦‚ä¸Šä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Programerç±»å£°æ˜Žsingå’Œdrawæ–¹æ³•ï¼Œä½†ä¹Ÿå¯ä¸æš´éœ²è¿™äº›æŽ¥å£è€Œé€šè¿‡ç±»åž‹å¼ºè½¬æ¥è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ æ ‡å‡†æ¶ˆæ¯è½¬å‘æ ‡å‡†æ¶ˆæ¯è½¬å‘ç›¸å¯¹äºŽç›´æŽ¥æ¶ˆæ¯è½¬å‘æ›´åŠ é«˜çº§ï¼Œå¯ä»¥ç”±ç¨‹åºå‘˜æŽ§åˆ¶è½¬å‘çš„è¿‡ç¨‹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®žçŽ°å¯¹å¤šä¸ªå¯¹è±¡çš„è½¬å‘ï¼Œç›´æŽ¥æ¶ˆæ¯è½¬å‘ä»…èƒ½æŠŠè¯¥æ–¹æ³•ç›´æŽ¥è½¬å‘ç»™å…¶ä»–æŸå¯¹è±¡ã€‚ æ ‡å‡†æ¶ˆæ¯è½¬å‘ä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@interface Programmer ()&#123; // ç”±äºŽè¦é¢‘ç¹ç”¨åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæˆå‘˜å®žä¾‹ Singer *_singer; Artist *_artist;&#125;@end@implementation Programmer- (instancetype)init &#123; if (self = [super init]) &#123; _singer = [[Singer alloc] init]; _artist = [[Artist alloc] init]; &#125; return self;&#125;// åœ¨è½¬å‘æ¶ˆæ¯å‰å…ˆå¯¹æ–¹æ³•é‡æ–°ç­¾å- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123; // å°è¯•è‡ªè¡Œå®žçŽ°æ–¹æ³•ç­¾å NSMethodSignature *signature = [super methodSignatureForSelector:aSelector]; // è‹¥æ— æ³•å®žçŽ°ï¼Œå°è¯•é€šè¿‡å¤šç»§æ‰¿å¾—åˆ°çš„æ–¹æ³•å®žçŽ° if (signature == nil) &#123; // åˆ¤æ–­è¯¥æ–¹æ³•æ˜¯å“ªä¸ªçˆ¶ç±»çš„ï¼Œå¹¶é€šè¿‡å…¶åˆ›å»ºæ–¹æ³•ç­¾å if ([_singer respondsToSelector:aSelector]) &#123; signature = [_singer methodSignatureForSelector:aSelector]; &#125; else if ([_artist respondsToSelector:aSelector]) &#123; signature = [_artist methodSignatureForSelector:aSelector]; &#125; &#125; return signature;&#125;// ä¸ºæ–¹æ³•ç­¾ååŽï¼Œè½¬å‘æ¶ˆæ¯- (void)forwardInvocation:(NSInvocation *)anInvocation &#123; SEL sel = [anInvocation selector]; // åˆ¤æ–­å“ªä¸ªç±»å®žçŽ°äº†è¯¥æ–¹æ³• if ([_singer respondsToSelector:sel]) &#123; [anInvocation invokeWithTarget:_singer]; &#125; else if ([_artist respondsToSelector:sel]) &#123; [anInvocation invokeWithTarget:_artist]; &#125;&#125;@end/* Singerå’ŒArtistçš„å®žçŽ°åŒä¸Šè¿°ä»£ç  */ è°ƒç”¨åŽï¼Œæ­£å¸¸æ‰§è¡Œã€‚å®žé™…ä¸Šåœ¨å®žçŽ°å¤šç»§æ‰¿æ–¹é¢å¹¶æ²¡æœ‰å¿…è¦ä½¿ç”¨æ ‡å‡†æ¶ˆæ¯è½¬å‘ï¼Œå®ƒå¯ä»¥åœ¨æˆ‘ä»¬éœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†æ—¶å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚ åŒ…å«çˆ¶ç±»æ–¹æ³•è¿™ä¸ªå…¶å®žå°±æ˜¯ä¸ºProgrammeræ·»åŠ Singerå’ŒArtistæˆå‘˜å˜é‡ï¼Œå¹¶ä¸ºå‰è€…æä¾›æŽ¥å£è°ƒç”¨åŽä¸¤è€…çš„æ–¹æ³•ã€‚è¿™ç§æ–¹å¼è™½ç„¶åœ¨æ•ˆæžœä¸Šå®žçŽ°äº†å¤šç»§æ‰¿ï¼Œä½†æ˜¯æ²¡æœ‰å®žçŽ°çš„æ„ä¹‰ï¼Œæ—¢ç„¶æ‰€æœ‰ä¸œè¥¿éƒ½è¦åœ¨å­ç±»å®žçŽ°ä¸€éï¼Œé‚£ä¹ˆä¹Ÿæœ‰æ‚–äºŽâ€ç»§æ‰¿â€è¿™ä¸€æ¦‚å¿µï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚ å‡ ç§å¤šç»§æ‰¿æ–¹å¼çš„å¯¹æ¯” æ–¹æ³• æ·»åŠ å±žæ€§ æ·»åŠ æ–¹æ³• ç»§æ‰¿çˆ¶ç±»çš„å®žçŽ° åè®®(Protocol) â—‹ â— â—‹ åˆ†ç±»(Catagory) â— â— â—‹ æ¶ˆæ¯è½¬å‘ â— â— â— å¯¹äºŽä¸Šè¿°çš„å†…å®¹è¿›è¡Œä¸€äº›è¡¥å……: åˆ†ç±»çš„å±žæ€§å®žçŽ°æ˜¯é€šè¿‡Runtimeå…³è”å¯¹è±¡ï¼Œè€Œæ¶ˆæ¯è½¬å‘çš„å±žæ€§å®žçŽ°ä¹Ÿæ˜¯ç±»ä¼¼æ–¹æ³•ã€‚ åˆ†ç±»å’Œæ¶ˆæ¯è½¬å‘æ›´æŽ¥è¿‘äºŽçœŸæ­£æ„ä¹‰çš„å¤šç»§æ‰¿ï¼Œä¹Ÿæ–¹ä¾¿ç®¡ç†ï¼Œæ·»åŠ åˆ é™¤çˆ¶ç±»æ–¹ä¾¿ã€‚]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Objective-C</tag>
        <tag>Runtime</tag>
        <tag>Cocoa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSçš„å¤šçº¿ç¨‹]]></title>
    <url>%2F2017%2F08%2F01%2FiOS%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[åœ¨iOSå¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸æ¶‰åŠåˆ°å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œå¤šçº¿ç¨‹å¹¿æ³›ç”¨äºŽè€—æ—¶æ“ä½œã€å¹¶å‘ã€å•ä¾‹ç­‰æ–¹é¢ã€‚æ•…æ€»ç»“ä¸€ä¸‹å¤šçº¿ç¨‹çš„ç›¸å…³çŸ¥è¯†åŠç”¨æ³•(pthread NSThread GCD NSOperation)ã€‚ åŸºæœ¬æ¦‚å¿µè¿›ç¨‹: æ“ä½œç³»ç»Ÿè¿è¡Œä¸­çš„ä»»åŠ¡é€šå¸¸å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œå½“è¿›ç¨‹è¿›å…¥å†…å­˜åŽï¼ŒåŠå˜æˆä¸€ä¸ªè¿›ç¨‹ã€‚åœ¨iOSä¸­æ¯ä¸ªå¯åŠ¨çš„APPå³ä¸ºä¸€ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹ä¹‹é—´ç‹¬ç«‹ä¸”å—ä¿æŠ¤ã€‚çº¿ç¨‹: è¿›ç¨‹å†…éƒ¨æ¯ä¸ªé¡ºåºæ‰§è¡Œæµå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚ä»»åŠ¡: ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼Œè¡¨ç¤ºéœ€è¦æ‰§è¡Œçš„å·¥ä½œã€‚ å¤šçº¿ç¨‹åŽŸç†:å•ä¸ªå¤„ç†å™¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªçº¿ç¨‹ï¼Œé€šè¿‡å¿«é€Ÿåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´è½®æ¢æ‰§è¡Œï¼Œä½¿å¾—å®è§‚ä¸Šå…·æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæžœã€‚å¤šçº¿ç¨‹å…·ä½“å†…å®¹è§æ“ä½œç³»ç»ŸåŽŸç†ã€‚ ä¼˜ç¼ºç‚¹å¤šçº¿ç¨‹çš„ä¼˜ç‚¹ä¸è¨€è€Œå–»ï¼Œæ¯”å¦‚å¯ä»¥æé«˜ç¨‹åºæ‰§è¡Œæ•ˆçŽ‡ã€æé«˜èµ„æºåˆ©ç”¨çŽ‡ã€å¹¶åœ¨æ‰§è¡Œå®Œä»»åŠ¡åŽè‡ªåŠ¨é”€æ¯ã€‚ä½†å¤šçº¿ç¨‹çš„ä½¿ç”¨ä¾ç„¶è¦é€‚åº¦ï¼Œå¤šçº¿ç¨‹å­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚ é¦–å…ˆï¼Œå¼€å¯å¤šçº¿ç¨‹éœ€è¦ä¸€å®šçš„å†…å­˜å¼€é”€: æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜Žï¼Œä¸»è¦çº¿ç¨‹å ç”¨ç©ºé—´1MB(å…¶å®žå®žé™…åªå ç”¨äº†512k)ï¼Œæ¬¡è¦çº¿ç¨‹æ¯å¼€å¯ä¸€ä¸ªå ç”¨512kb(æˆ‘ä»¬æ‰€åˆ›å»ºçš„çº¿ç¨‹å³æ˜¯æ¬¡è¦çº¿ç¨‹)ã€‚æ¯æ¬¡çº¿ç¨‹åˆ›å»ºè€—æ—¶90msã€‚æ‰€ä»¥ï¼Œè¿‡åº¦ä½¿ç”¨å¤šçº¿ç¨‹åè€Œä¼šä½¿æ€§èƒ½é™ä½Žã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬çŸ¥é“CPUæ˜¯é€šè¿‡çº¿ç¨‹çš„è½®æ¢è€Œå®žçŽ°å¤šçº¿ç¨‹çš„ï¼Œé‚£ä¹ˆæ¯æ¬¡åˆ‡æ¢çº¿ç¨‹éƒ½ä¼šåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶äº§ç”Ÿæ€§èƒ½å¼€é”€ã€‚æœ€åŽï¼Œçº¿ç¨‹é—´é€šä¿¡ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼Œå³ç”Ÿäº§è€…â€“æ¶ˆè´¹è€…é—®é¢˜ï¼Œå¢žåŠ äº†æ•°æ®å…±äº«çš„éš¾åº¦ã€‚ iOSç³»ç»Ÿå¤šçº¿ç¨‹åŽŸåˆ™åŠæ–¹æ¡ˆiOSå¤šçº¿ç¨‹åŽŸåˆ™é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè§£é‡Šä¸€ä¸ªæ¦‚å¿µ: UIçº¿ç¨‹/ä¸»çº¿ç¨‹åœ¨å¼€å‘ä¸­å¸¸æåˆ°â€UIçº¿ç¨‹â€æˆ–â€ä¸»çº¿ç¨‹â€ï¼ŒiOSç³»ç»Ÿåœ¨ç¨‹åºè¿è¡Œä¹‹åŽä¼šé»˜è®¤å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥ä½œä¸ºä¸»çº¿ç¨‹ï¼Œå…¶ä¸€èˆ¬ç”¨äºŽåˆ·æ–°UIç•Œé¢ï¼Œå¤„ç†UIäº‹ä»¶ã€‚æˆ‘ä»¬åœ¨æ²¡æœ‰æŒ‡å®šä»»åŠ¡åœ¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¹Ÿæ˜¯ç›´æŽ¥åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ã€‚æ‰€æœ‰UIæ›´æ–°æ“ä½œéƒ½åº”è¯¥åœ¨ä¸»çº¿ç¨‹è¿›è¡Œã€‚å› ä¸ºiOSçš„UIæŽ§ä»¶é»˜è®¤éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè¿™æ˜¯å‡ºäºŽæ€§èƒ½çš„è€ƒè™‘ã€‚å¦‚æžœåœ¨å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œæœ‰ä¸€å®šå‡ çŽ‡å‡ºçŽ°é—®é¢˜ã€‚è€—æ—¶æ“ä½œä¸åº”æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œã€‚æ­£æ˜¯å› ä¸ºUIæ›´æ–°éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹å®Œæˆçš„ï¼Œé‚£ä¹ˆå¦‚æžœæˆ‘ä»¬å°†è€—æ—¶æ“ä½œæ”¾åœ¨ä¸»çº¿ç¨‹ï¼Œå°†ä¼šé˜»å¡žä¸»çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢å¡ä½ï¼Œé™ä½Žç”¨æˆ·ä½“éªŒã€‚ iOSçš„å¤šçº¿ç¨‹æŠ€æœ¯æ–¹æ¡ˆiOSç³»ç»Ÿå­˜åœ¨ç€4ä¸­å¤šçº¿ç¨‹æŠ€æœ¯æ–¹æ¡ˆ: pthreadã€NSThreadã€GCDã€NSOperationã€‚(Swiftä¸­åç§°ç•¥æœ‰ä¸åŒ) å¤šçº¿ç¨‹æ–¹æ¡ˆ è¯­è¨€ ARCä¸‹çš„å†…å­˜ç®¡ç† ä½¿ç”¨é¢‘çŽ‡ pthread C ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç† â˜…â˜†â˜†â˜†â˜† NSThread OC/Swift(Thread) ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç† â˜…â˜…â˜†â˜†â˜† GCD C/OC/Swift ARCè‡ªåŠ¨ç®¡ç†(å¤šæ•°æƒ…å†µ) â˜…â˜…â˜…â˜…â˜… NSOperation OC/Swift ARCè‡ªåŠ¨ç®¡ç† â˜…â˜…â˜…â˜…â˜† Tips: ä¸»è¦ä»¥OCè®²è§£ï¼Œåœ¨Swift 3.0+ä¸­åç§°ä¸Žç”¨æ³•ç•¥æœ‰ä¸åŒã€‚(å¦‚NSThread -&gt; Thread, dispatch_XXX -&gt; DispatchQueue) å¤šçº¿ç¨‹çš„ä½¿ç”¨pthread (POSIX threads)è¿™ä¸ªæ˜¯æœ€è€ç›˜çš„å¤šçº¿ç¨‹æ–¹æ¡ˆäº†ï¼Œåœ¨ç±»Unixæ“ä½œç³»ç»Ÿï¼ˆUnixã€Linuxã€Mac OS Xç­‰ï¼‰ä¸­ï¼Œéƒ½ä½¿ç”¨pthreadä½œä¸ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ã€‚iOSå¼€å‘ä¸­åŸºæœ¬ä¸ä¼šç”¨åˆ°(å¦‚æžœä½ é¢‘ç¹ä½¿ç”¨pthreadï¼Œé‚£ä¹ˆå—æˆ‘ä¸€æ‹œâ€¦)ã€‚ ä½¿ç”¨pthreadéœ€è¦å¯¼å…¥å¤´æ–‡ä»¶: #import &lt;pthread.h&gt; æˆ– #import &lt;pthread/pthread.h&gt; ä½¿ç”¨æ–¹æ³•ï¼š1234567891011121314151617181920212223242526272829303132333435- (void)pthreadTest &#123; /* åˆ›å»ºçº¿ç¨‹ä½¿ç”¨pthread_createå‡½æ•° å‡½æ•°åŽŸåž‹: pthread_create(pthread_t _Nullable *restrict _Nonnull, const pthread_attr_t *restrict _Nullable, void * _Nullable (* _Nonnull)(void * _Nullable), void *restrict _Nullable) å‚æ•°ï¼š 1) çº¿ç¨‹æ ‡è¯†ç¬¦æŒ‡é’ˆï¼Œpthread_t 2) çº¿ç¨‹å±žæ€§(æ³¨æ„ç©ºåœ°å€ä¸ºNULL,ç©ºå¯¹è±¡æ˜¯nil) 3) è¦æ‰§è¡Œçš„å‡½æ•°æŒ‡é’ˆ 4) æ‰§è¡Œå‡½æ•°çš„å‚æ•° è¿”å›žå€¼ï¼š - åˆ›å»ºæˆåŠŸï¼Œè¿”å›ž0 - åˆ›å»ºå¤±è´¥ï¼Œè¿”å›žå‡ºé”™ä»£ç  */ pthread_t id = NULL; NSString *paraStr = @&quot;Hello World&quot;; int res = pthread_create(&amp;id, NULL, taskFunction, (__bridge void *)(paraStr)); if (res == 0) &#123; NSLog(@&quot;çº¿ç¨‹åˆ›å»ºå®Œæˆ&quot;); &#125; else &#123; NSLog(@&quot;çº¿ç¨‹åˆ›å»ºå¤±è´¥ é”™è¯¯:%d&quot;, res); &#125; pthread_detach(id);&#125;void *taskFunction(void *params) &#123; NSString *str = (__bridge NSString *)(params); NSLog(@&quot;Thread:%@ -&gt; Message:%@&quot;, [NSThread currentThread], str); return NULL;&#125; è¡¥å……: __bridgeåœ¨OCä¸ŽCè¿›è¡Œæ··ç¼–æ—¶ï¼Œä¼šé‡åˆ°OCå¯¹è±¡ä¸ŽCå˜é‡ä¹‹é—´çš„è½¬æ¢é—®é¢˜ã€‚åœ¨OCä¸­idä¸ºä¸‡èƒ½æŒ‡é’ˆï¼Œè€ŒCä¸­void *ä¸ºä¸‡èƒ½æŒ‡é’ˆã€‚åœ¨idç±»åž‹æˆ–å¯¹è±¡ç±»åž‹å˜é‡èµ‹å€¼ç»™void *ç±»åž‹æˆ–åå‘èµ‹å€¼æ—¶ï¼Œéœ€è¦è¿›è¡Œç‰¹å®šè½¬æ¢ã€‚ ä¸ºä»€ä¹ˆè¦è¿›è¡Œè½¬æ¢å‘¢ï¼Ÿè¿™ä¸»è¦æ˜¯å› ä¸ºé¢å‘å¯¹è±¡æ¶‰åŠåˆ°çš„å†…å­˜ç®¡ç†é—®é¢˜ï¼ŒOCä¸­å¯¹è±¡ç”±MRCã€ARCæ¥è¿›è¡Œç®¡ç†ï¼Œè€Œå…¶ä¸èƒ½ç®¡ç†Cå˜é‡ï¼Œé‚£ä¹ˆåœ¨è½¬æ¢æ—¶ä¼šé€ æˆå†…å­˜ç®¡ç†çš„å†²çªã€‚__bridgeå³å‘ŠçŸ¥ç¼–è¯‘å™¨ï¼Œè¯¥å˜é‡å†…å­˜ç”±ç¨‹åºå‘˜è‡ªè¡Œè¿›è¡Œç®¡ç†ã€‚ åŒæ—¶æ¡¥æŽ¥è½¬æ¢è¿˜æœ‰å¦å¤–ä¸¤ç§ç±»åž‹: __bridge_retainedå’Œ__bridge_transferï¼Œå‰è€…ä¸ºæ˜¯è¢«èµ‹å€¼çš„å˜é‡æŒæœ‰è¯¥å¯¹è±¡ï¼ŒåŽè€…ä¸ºè¢«èµ‹å€¼çš„å˜é‡æŒæœ‰è¯¥å¯¹è±¡å¹¶ä½¿èµ‹å€¼çš„å¯¹è±¡é‡Šæ”¾å…¶æŒæœ‰ã€‚ç”±äºŽæ¶‰åŠåˆ°å¼•ç”¨è®¡æ•°çŸ¥è¯†ï¼Œåœ¨æ­¤ä¸èµ˜è¿°ã€‚å¦‚æžœåªæ˜¯ä¸ºäº†å•çº¯èµ‹å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨__bridgeå³å¯ã€‚ NSThreadç”±äºŽpthreadè¿‡äºŽåº•å±‚ï¼Œå¤æ‚æ€§ä¸åˆ©äºŽå¼€å‘ã€‚æ•…è‹¹æžœå°è£…æˆäº†NSThreadï¼Œè¿™æ˜¯ä¸€æ¬¾è¾ƒè½»é‡çš„å¤šçº¿ç¨‹å®žçŽ°æ–¹æ¡ˆï¼Œä½¿ç”¨é¢å‘å¯¹è±¡è¯­æ³•ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸéœ€è¦ç¨‹åºå‘˜è‡ªè¡Œç®¡ç†ã€‚åœ¨MacOSå’ŒiOSéƒ½å¯ä½¿ç”¨ã€‚(Swiftä¸­ä¸ºThread)ã€‚NSThreadç±»ä»£è¡¨çº¿ç¨‹ï¼Œåˆ›å»ºæ–°çº¿ç¨‹ä¹Ÿå°±æ˜¯åˆ›å»ºNSThreadå¯¹è±¡ã€‚ åˆ›å»ºçº¿ç¨‹NSThreadåˆ›å»ºåˆ†åŠ¨æ€æ–¹æ³•å’Œé™æ€æ–¹æ³•ä¸¤ç§:12345678910/// åˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹+ (void)detachNewThreadSelector:(SEL)selector toTarget:(id)target withObject:(id)argument; /// ä»…åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè¿”å›žNSThreadå¯¹è±¡ï¼Œå¹¶æœªå¯åŠ¨çº¿ç¨‹- (id)initWithTarget:(id)target selector:(SEL)selector object:(id)argument; /* - SEL æ‰€è¦æ‰§è¡Œçš„æ–¹æ³• - target selectoræ¶ˆæ¯çš„æŽ¥æ”¶å¯¹è±¡ - argument æ–¹æ³•å”¯ä¸€å‚æ•°ï¼Œæˆ–nil */ å¯ä»¥å‘çŽ°ï¼Œå‰è€…ä¸ŽåŽè€…å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œåªæ˜¯å‰è€…ä¸ä¼šè¿”å›žNSThreadå¯¹è±¡ï¼Œåˆ›å»ºçº¿ç¨‹åŽç«‹å³å¯åŠ¨ï¼Œè€ŒåŽè€…åªæ˜¯åˆ›å»ºä¸€ä¸ªNSThreadå¯¹è±¡å¹¶è¿”å›žï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ åŒæ—¶è¿˜æœ‰ä¸€ç±»éšå¼åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•:1- (void)performSelectorInBackground:(SEL)aSelector withObject:(id)arg; performXxx è¿™ä¸€ç±»æ–¹æ³•ï¼Œåœ¨åˆ›å»ºçº¿ç¨‹æ—¶ä¹Ÿæ˜¯ä½¿ç”¨çš„NSThreadã€‚ çº¿ç¨‹çš„çŠ¶æ€é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çº¿ç¨‹æ‰§è¡Œçš„çŠ¶æ€: å‰é¢æåˆ°ï¼Œå¤šçº¿ç¨‹çš„åŽŸç†æ˜¯CPUè½®æ¢è°ƒåº¦å¤šä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥æŸçº¿ç¨‹åœ¨æŸä¸€æ—¶åˆ»ä¸ä¸€å®šæ­£åœ¨è¢«æ‰§è¡Œã€‚ç®€å•è§£é‡Šä¸€ä¸‹çº¿ç¨‹çš„å‡ ä¸ªçŠ¶æ€:å°±ç»ª: çº¿ç¨‹å‡†å¤‡å°±ç»ªå¯ä»¥è¢«æ‰§è¡Œæ—¶ï¼Œä¼šæ”¾å…¥å¯è°ƒåº¦çº¿ç¨‹æ± ï¼Œä¾›CPUè°ƒç”¨ã€‚é˜»å¡ž: å½“çº¿ç¨‹çš„æ­£å¸¸æ‰§è¡Œè¢«ç»„æ­¢ï¼Œæ¯”å¦‚è°ƒç”¨äº†sleepæ–¹æ³•æˆ–çº¿ç¨‹åœ¨ç­‰å¾…åŒæ­¥é”ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡žçŠ¶æ€ã€‚æ³¨æ„ï¼Œæ­¤â€é˜»å¡žâ€ä¸Žå¸¸è¯´çš„â€è€—æ—¶æ“ä½œé˜»å¡žUIçº¿ç¨‹â€å¹¶éžåŒä¸€æ¦‚å¿µï¼ŒåŽè€…åªæ˜¯å ç”¨UIçº¿ç¨‹èµ„æºå¯¼è‡´UIæ“ä½œæ— æ³•æ­£å¸¸æ‰§è¡Œã€‚æ­»äº¡: å½“çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åŽä¼šè‡ªåŠ¨é”€æ¯ã€‚åŒæ—¶å½“é‡åˆ°å¼‚å¸¸æ—¶ï¼Œæˆ–æˆ‘ä»¬è‡ªè¡Œä½¿ç”¨exitæ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ï¼Œçº¿ç¨‹éƒ½ä¼šæ­»äº¡ï¼Œä¸å†å¯ç”¨ã€‚ NSThreadæä¾›çš„API ä¼˜å…ˆçº§: çº¿ç¨‹ä¸ºæˆ‘ä»¬æä¾›äº†çº¿ç¨‹ä¼˜å…ˆçº§å±žæ€§ä»¥å¹²é¢„å…¶æ‰§è¡Œï¼Œå¯¹åº”threadPriorityå±žæ€§ï¼ŒèŒƒå›´æ˜¯0.0~1.0ï¼Œæƒå€¼è¶Šé«˜ä¼˜å…ˆçº§è¶Šé«˜ã€‚ä½†æ³¨æ„ï¼Œè¯¥æƒå€¼ä»…ä¸ºçº¿ç¨‹åœ¨è°ƒåº¦æ—¶çš„ä¼˜å…ˆæƒé‡ï¼Œå¹¶éžç»å¯¹ä¼˜å…ˆã€‚ çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•: å¯¹åº”executing, finishedä¸¤ä¸ªå±žæ€§ï¼Œå‰è€…åœ¨çº¿ç¨‹æ­£åœ¨æ‰§è¡Œæ—¶ä¸ºYESï¼ŒåŽè€…åœ¨æ‰§è¡Œå®Œæ¯•æ—¶ä¸ºYESã€‚ çº¿ç¨‹å–æ¶ˆæ ‡è®°: NSThreadæä¾›äº†cancelå®žä¾‹æ–¹æ³•ï¼Œå¯¹åº”çš„æœ‰cancelledå±žæ€§ï¼Œä½†æ˜¯æ³¨æ„è¯¥æ–¹æ³•å¹¶éžçœŸæ­£ç»ˆæ­¢è¯¥çº¿ç¨‹ï¼Œè€Œæ˜¯å°†cancelledæ ‡è®°ä¸ºYESï¼Œè€ŒåŽç”±ç¨‹åºå‘˜æ‰‹åŠ¨åˆ¤æ–­cancelledå±žæ€§å¹¶ä½œå‡ºå†³ç­–ã€‚å¦‚æžœéœ€è¦å¼ºåˆ¶ç»“æŸï¼Œåº”ä½¿ç”¨exitæ–¹æ³•ã€‚ çº¿ç¨‹ç¡çœ å¦‚æžœéœ€è¦è®©å½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´ï¼Œå¯ä»¥è°ƒç”¨sleepXXX æ–¹æ³•é˜»å¡žçº¿ç¨‹ã€‚ 1234// é˜»å¡žä¸€æ®µæ—¶é—´+ (void)sleepForTimeInterval:(NSTimeInterval)ti;// é˜»å¡žåˆ°æŒ‡å®šæ—¶é—´+ (void)sleepUntilDate:(NSDate *)date; è¢«é˜»å¡žçš„çº¿ç¨‹æ˜¯æš‚æ—¶ä¸å¯æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥å¯è°ƒåº¦çº¿ç¨‹æ± ã€‚åœ¨å…¶é˜»å¡žç»“æŸåŽï¼Œä¼šè¿›å…¥å¯è°ƒåº¦çº¿ç¨‹æ± å¹¶åœ¨CPUæ—¶é—´ç‰‡åˆ°æ¥æ—¶å¼€å§‹æ‰§è¡Œã€‚ ç»ˆæ­¢çº¿ç¨‹å‰é¢æåˆ°ï¼Œçº¿ç¨‹çš„ç»ˆæ­¢æœ‰ä¸‰ç§æƒ…å†µ: çº¿ç¨‹æ‰§è¡Œä½“æ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹æ­£å¸¸ç»“æŸã€‚ çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹å‡ºçŽ°é”™è¯¯ï¼Œå¼‚å¸¸é€€å‡ºã€‚ æ‰‹åŠ¨è°ƒç”¨exitæ–¹æ³•ç»ˆæ­¢äº†çº¿ç¨‹ã€‚ æä¸€ä¸ªå°é—®é¢˜: å½“ä¸»çº¿ç¨‹ç»“æŸæ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šå—å½±å“å—ï¼Ÿ ç­”æ¡ˆæ˜¯ä¸ä¼šï¼Œå½“çº¿ç¨‹è¢«å¯åŠ¨ï¼Œå…¶æœ¬è´¨ä¸Šä¸Žä¸»çº¿ç¨‹æ˜¯ç›¸åŒåœ°ä½çš„ï¼Œå¹¶ä¸ä¼šå—åˆ°å…¶å½±å“ã€‚ çº¿ç¨‹å®‰å…¨é—®é¢˜çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€ç›´æ˜¯å¤šçº¿ç¨‹éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ï¼Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ä¸€èˆ¬é‡‡ç”¨åŠ é”çš„æ–¹å¼ã€‚iOSæä¾›äº†å¾ˆå¤šç§é”çš„æ–¹æ¡ˆï¼Œæœ¬è´¨ä¸Šä¸ºåŒæ­¥é”ã€äº’æ–¥é”ä¸¤ç§ã€‚ äº’æ–¥é”: å‘çŽ°å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰§è¡Œé”å®šä»£ç åŽï¼Œçº¿ç¨‹ä¼šè¿›å…¥ä¼‘çœ (é˜»å¡ž)ï¼Œå¾…åŠ é”çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰“å¼€é”æ—¶ï¼Œä¼šå”¤é†’è¯¥ä¼‘çœ çº¿ç¨‹ã€‚è‡ªæ—‹é”: å‘çŽ°å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰§è¡Œé”å®šä»£ç åŽï¼Œçº¿ç¨‹ä¼šé‡‡ç”¨æ­»å¾ªçŽ¯æ–¹å¼è½®è¯¢ï¼Œç›´åˆ°é”è¢«æ‰“å¼€ã€‚ç®€å•æ¥è¯´ï¼Œè‡ªæ—‹é”ç”±äºŽé‡‡ç”¨äº†æ­»å¾ªçŽ¯è½®è¯¢ï¼Œä¼šæ¯”äº’æ–¥é”æœ‰æ›´é«˜çš„æ•ˆçŽ‡ï¼Œä½†åŒæ—¶ä¹Ÿé€ æˆæ›´å¤§çš„æ€§èƒ½æ¶ˆè€—ã€‚ OCå¯¹è±¡çš„atomicå±žæ€§ä¿®é¥°ç¬¦å°±æ˜¯ä½¿ç”¨äº†è‡ªæ—‹é”ï¼Œè‡ªæ—‹é”åŒä¸€æ—¶é—´å¯ä»¥æœ‰ä¸€ä¸ªå†™è€…æˆ–å¤šä¸ªè¯»è€…ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶æ—¢æœ‰è¯»è€…åˆæœ‰å†™è€…ã€‚ iOSå¸¸ç”¨çš„åŠ é”æ–¹æ¡ˆæœ‰: @synchronized, NSLock, NSConditionã€‚åŠ é”æ–¹å¼å’ŒåŒºåˆ«å°†åœ¨å…¶ä»–æ–‡ç« ä»‹ç»ã€‚ å‡ ä¹Žæ‰€æœ‰UIKitæä¾›çš„ç±»éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ‰€æœ‰åŒ…å«â€™Mutableâ€™çš„ç±»éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ æ­»é”å½“ä¸€ç»„è¿›ç¨‹ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œè¿™ä¸€äº‹ä»¶åªèƒ½ç”±è¿™ä¸€ç»„è¿›ç¨‹çš„å¦ä¸€è¿›ç¨‹å¼•èµ·ï¼Œé‚£ä¹ˆè¿™ç»„è¿›ç¨‹å°±å¤„äºŽæ­»é”çŠ¶æ€ã€‚æ­»é”é—®é¢˜æ˜¯æ“ä½œç³»ç»Ÿçš„ç»å…¸é—®é¢˜ï¼Œè¯¦è§æ“ä½œç³»ç»ŸåŽŸç†ã€‚ æ­»é”å‘ç”Ÿçš„å¿…è¦æ¡ä»¶: äº’æ–¥: è‡³å°‘æœ‰ä¸€ä¸ªèµ„æºå¿…é¡»å¤„äºŽéžå…±äº«æ¨¡å¼ï¼Œå¦‚æžœå¦ä¸€çº¿ç¨‹ç”³è¯·è¯¥èµ„æºï¼Œé‚£ä¹ˆç”³è¯·çº¿ç¨‹å¿…é¡»ç­‰å¾…è¯¥èµ„æºè¢«é‡Šæ”¾ä¸ºæ­¢ã€‚å¦‚äº’æ–¥é”è¿™ä¸€æƒ…å†µã€‚ å æœ‰å¹¶ç­‰å¾…: è¯¥çº¿ç¨‹ç­‰å¾…æŸèµ„æºï¼Œè€Œè¯¥èµ„æºä¸ºå…¶ä»–çº¿ç¨‹æ‰€æœ‰ã€‚ éžæŠ¢å : èµ„æºä¸èƒ½è¢«æŠ¢å ï¼Œåªèƒ½åœ¨çº¿ç¨‹å®Œæˆä»»åŠ¡åŽè‡ªåŠ¨é‡Šæ”¾ã€‚ å¾ªçŽ¯ç­‰å¾…: ä¸€ç»„ç­‰å¾…çº¿ç¨‹T1~Tn,å…¶ä¸­Tiçš„èµ„æºè¢«Ti+1æ‰€å æœ‰ï¼Œé€ æˆå¾ªçŽ¯ç­‰å¾…ã€‚ GCD (Grand Central Dispatch)NSThreadæ˜¯ä¸€æ¬¾è¾ƒä¸ºè½»é‡çš„å¤šçº¿ç¨‹å®žçŽ°ï¼Œç¨‹åºå‘˜éœ€è¦è‡ªè¡ŒæŽ§åˆ¶åŒæ­¥å’Œå¹¶å‘ï¼Œè¾ƒä¸ºå¤æ‚ã€‚iOSåœ¨4.0ä¹‹åŽæä¾›äº†GCDæ¥å®žçŽ°å¤šçº¿ç¨‹ã€‚å…¶å¼±åŒ–äº†å•ä¸ªçº¿ç¨‹çš„æ¦‚å¿µï¼Œå¼ºè°ƒé˜Ÿåˆ—å’Œä»»åŠ¡ä¸¤å¤§æ ¸å¿ƒæ¦‚å¿µã€‚ é˜Ÿåˆ—: GCDä¸ºç”¨æˆ·å°è£…å‡ºäº†ä¸²è¡Œé˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—ä¸¤ç§é˜Ÿåˆ—ã€‚é˜Ÿåˆ—è´Ÿè´£ç®¡ç†å¼€å‘è€…æäº¤çš„ä»»åŠ¡ï¼Œé‡‡ç”¨FIFO(å…ˆè¿›å…ˆå‡º)çš„æ–¹å¼ã€‚ä¸²è¡Œé˜Ÿåˆ—æäº¤çš„åŽä¸€ä¸ªä»»åŠ¡åªèƒ½ç­‰åˆ°å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç»“æŸåŽæ‰èƒ½å¼€å§‹æ‰§è¡Œï¼›å¹¶å‘é˜Ÿåˆ—çš„ä»»åŠ¡æŒ‰FIFOæœºåˆ¶å¹¶å‘å¯åŠ¨å¹¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ä»»åŠ¡: å¼€å‘è€…æäº¤ç»™é˜Ÿåˆ—çš„å·¥ä½œå•å…ƒã€‚ GCDçš„å®žçŽ°æœºåˆ¶GCDåº•å±‚ç»´æŠ¤äº†ä¸€ä¸ªå¯é‡ç”¨çº¿ç¨‹æ± ï¼Œå½“çº¿ç¨‹ç»“æŸåŽï¼Œç³»ç»Ÿå¹¶ä¸ç¬¬ä¸€æ—¶é—´é”€æ¯è¯¥çº¿ç¨‹ï¼Œè€Œæ˜¯å°†å…¶æ”¾å…¥çº¿ç¨‹æ± ä¸­å¾…ç”¨ï¼Œè‹¥ä¸€æ®µæ—¶é—´åŽä»æœªä½¿ç”¨ï¼Œåˆ™é”€æ¯ã€‚ ä¸²è¡Œé˜Ÿåˆ—åº•å±‚çš„çº¿ç¨‹æ± åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå› æ­¤åªæä¾›ä¸€ä¸ªçº¿ç¨‹ç”¨æ¥æ‰§è¡Œä»»åŠ¡ã€‚è€Œå¹¶å‘é˜Ÿåˆ—éœ€è¦å¤šä¸ªçº¿ç¨‹æ¥å®žçŽ°å¹¶å‘ï¼Œæ‰€ä»¥çº¿ç¨‹æ± ä¸­ç»´æŠ¤äº†å¤šä¸ªçº¿ç¨‹ã€‚ GCDä½¿ç”¨æ­¥éª¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„é˜Ÿåˆ—ï¼ŒèŽ·å–æ–¹æ³•å¦‚ä¸‹ 12345// æ ¹æ®æŒ‡ä»¤çš„ä¼˜å…ˆçº§ã€é¢å¤–æ——æ ‡èŽ·å–å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚// ä¼˜å…ˆçº§idä¸ºDISPATCH_QUEUE_PRIORITY_XXXdispatch_queue_t dispatch_get_global_queue(long identifier, unsigned long flags);// èŽ·å–ä¸»çº¿ç¨‹æ‰€å…³è”çš„é˜Ÿåˆ—(ä¸²è¡Œé˜Ÿåˆ—)dispatch_queue_t dispatch_get_main_queue(void); åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªè¡Œåˆ›å»ºé˜Ÿåˆ—ï¼Œä½†æ˜¯ARCå¹¶ä¸èƒ½ç®¡ç†è‡ªè¡Œåˆ›å»ºçš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªè¡Œç®¡ç†å†…å­˜:123456789/* - æ ¹æ®æŒ‡å®šå­—ç¬¦ä¸²æ ‡ç­¾åˆ›å»ºé˜Ÿåˆ— - label ä¸ºå­—ç¬¦ä¸²æ ‡ç­¾ - attr æŽ§åˆ¶é˜Ÿåˆ—æ˜¯ä¸²è¡Œé˜Ÿåˆ—è¿˜æ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œå‰è€…ä¸ºDISPATCH_QUEUE_SERIALï¼ŒåŽè€…ä¸ºDISPATCH_QUEUE_CONCURRENTã€‚ */dispatch_queue_t dispatch_queue_create(const char *label, dispatch_queue_attr_t attr);// éœ€è¦è‡ªè¡Œé‡Šæ”¾å†…å­˜dispatch_release() åŒæ­¥/å¼‚æ­¥æäº¤ä»»åŠ¡GCDå¯¹äºŽä»»åŠ¡çš„æäº¤ï¼Œæä¾›äº†åŒæ­¥/å¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼ŒåŒæ—¶æ”¯æŒBlockå’Œå‡½æ•°æŒ‡é’ˆä¸¤ç§å½¢å¼çš„ä»»åŠ¡ã€‚ 1234567891011121314151617/// å¼‚æ­¥// Blockvoid dispatch_async(dispatch_queue_t queue, dispatch_block_t block);// å‡½æ•°void dispatch_async_f(dispatch_queue_t queue, void *context, dispatch_function_t work);/// åŒæ­¥// Blockvoid dispatch_sync(dispatch_queue_t queue, dispatch_block_t block);// å‡½æ•°void dispatch_sync_f(dispatch_queue_t queue, void *context, dispatch_function_t work);/// å»¶æ—¶ä»»åŠ¡// Blockvoid dispatch_after(dispatch_time_t when, dispatch_queue_t queue, dispatch_block_t block);// å‡½æ•°void dispatch_after_f(dispatch_time_t when, dispatch_queue_t queue, void *context, dispatch_function_t work); åŒæ—¶ï¼Œè¿˜æä¾›äº†å¤šæ¬¡æ‰§è¡Œä»»åŠ¡å’Œå•æ¬¡æ‰§è¡Œä»»åŠ¡ï¼ŒåŽè€…å¯ä»¥ç”¨äºŽå•ä¾‹æ¨¡å¼ã€‚123456789101112/// å¤šæ¬¡æ‰§è¡Œ// Blockvoid dispatch_apply(size_t iterations, dispatch_queue_t queue, void (^block)(size_t));// å‡½æ•°void dispatch_apply_f(size_t iterations, dispatch_queue_t queue, void *context, void (*work)(void *, size_t));/// å•æ¬¡æ‰§è¡Œ/* éœ€è¦æä¾›ä¸€ä¸ªdispatch_once_tçš„æŒ‡é’ˆæœ€ä¸ºæ ‡è®° */// Blockvoid dispatch_once(dispatch_once_t *predicate, dispatch_block_t block);// å‡½æ•°void dispatch_once_f(dispatch_once_t *predicate, void *context, dispatch_function_t function); å…¶ä»–å¸¸è§APIé˜Ÿåˆ—ä¼˜å…ˆçº§è®¾ç½®é˜Ÿåˆ—ä¼˜å…ˆçº§ä¸Žç›®æ ‡é˜Ÿåˆ—ä¸€è‡´ï¼Œå®žçŽ°å¯¹é˜Ÿåˆ—ä¼˜å…ˆçº§çš„æŽ§åˆ¶ä»¥åŠå¤šä¸ªä¸²è¡Œé˜Ÿåˆ—çš„æœ‰åºæ‰§è¡Œã€‚1234567891011121314/* - å‚æ•°1: éœ€è¦è¢«è®¾ç½®ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ã€‚ - å‚æ•°2: è®¾ç½®ä¼˜å…ˆçº§æ—¶çš„ç›®æ ‡é˜Ÿåˆ—ã€‚ */void dispatch_set_target_queue(dispatch_object_t object, dispatch_queue_t queue);// æƒ…å†µ1: ç›®æ ‡é˜Ÿåˆ—ä¸ºä¸åŒä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œè¢«è®¾ç½®çš„é˜Ÿåˆ—å°†æ‹¥æœ‰å’Œç›®æ ‡é˜Ÿåˆ—ç›¸åŒçš„ä¼˜å…ˆçº§dispatch_queue_t serialDispatchQueue = dispatch_queue_create(&quot;serialDispatchQueue&quot;, NULL);dispatch_queue_t backgroundDispatchQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0);dispatch_set_target_queue(serialDispatchQueue, backgroundDispatchQueue);// æƒ…å†µ2: ç›®æ ‡é˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ï¼Œè€Œå¤šä¸ªä¸²è¡Œé˜Ÿåˆ—è®¾ç½®å…¶ä¸ºç›®æ ‡é˜Ÿåˆ—åŽå°†äº’ç›¸ä¸²è¡Œï¼ŒåŒä¸€æ—¶é—´åªæœ‰å…¶ä¸­ä¸€ä¸ªé˜Ÿåˆ—æ‰§è¡Œä¸²è¡Œä»»åŠ¡ã€‚ è°ƒåº¦ç»„(Dispatch Group)é’ˆå¯¹å¸Œæœ›åœ¨è¿½åŠ åˆ°Dispatch Queueé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å…¨éƒ¨å®ŒæˆåŽæ‰§è¡ŒæŸä¸€ç‰¹å®šä»»åŠ¡çš„æƒ…å†µï¼Œæä¾›äº†Dispatch Groupè¿™ä¸€ç‰¹æ€§ã€‚åˆ›å»ºçº¿ç¨‹ç»„åŽï¼Œå¯ä»¥å‘å…¶ä¸­è¿½åŠ ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å…¨éƒ¨å®Œæˆæ—¶ï¼Œä¼šæ‰§è¡Œé€šçŸ¥ä»»åŠ¡ï¼Œé€šçŸ¥ä»»åŠ¡çš„å…·ä½“å†…å®¹ç”±ç¨‹åºå‘˜è®¾ç½®ã€‚ 1234567891011121314// åˆ›å»ºDispatch Groupdispatch_group_t group = dispatch_group_create();// èŽ·å–ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRORITY_DEFAULT, 0);// è¿½åŠ ä¸¤ä¸ªä»»åŠ¡dispatch_group_async(group, queue, ^&#123;NSLog(@&quot;No.1&quot;); &#125;);dispatch_group_async(group, queue, ^&#123;NSLog(@&quot;No.2&quot;); &#125;);//è®¾ç½®å®Œæˆæ—¶çš„ä»»åŠ¡dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;NSLog(@&quot;All task done&quot;)&#125;);// Dispatch Groupéœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜dispatch_release(group) Dispatch Barrierä¸ºäº†è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯»å–å¤„ç†æ”¾å…¥å¹¶å‘é˜Ÿåˆ—ä¸­ï¼Œå°†å†™å…¥å¤„ç†æ”¾å…¥ä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯åœ¨æ²¡æœ‰è¯»å–æ“ä½œæ—¶å†™å…¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é˜Ÿåˆ—ä¼˜å…ˆçº§å’Œè°ƒåº¦ç»„ç»“åˆå®žçŽ°ï¼Œä½†æ˜¯è¿™æ ·è¿‡äºŽå¤æ‚ã€‚GCDæä¾›äº†dispatch_barrier_asyncå‡½æ•°æ¥å®žçŽ°è¿™ä¸€ç‚¹ã€‚ dispatch_barrier_asyncå‡½æ•°ä¼šç­‰å¾…è¿½åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å…¨éƒ¨å®ŒæˆåŽæ‰å°†è‡ªå·±çš„å¤„ç†è¿½åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ï¼Œä½†æ­¤æ—¶å¹¶å‘é˜Ÿåˆ—ä»…è¿è¡Œè¯¥ä»»åŠ¡ï¼Œå¾…è¯¥ä»»åŠ¡æ‰§è¡Œå®ŒåŽï¼Œå¹¶å‘é˜Ÿåˆ—æ¢å¤æ­£å¸¸ç»§ç»­å¹¶å‘æ‰§è¡Œã€‚ 123456789101112// åˆ›å»ºå¹¶å‘é˜Ÿåˆ—dispatch_queue_t queue = dispatch_queue_create(&quot;barrierTest&quot;, DISPATCH_QUEUE_CONCURRENT);// è¯»å–æ“ä½œdispatch_async(queue, readingBlock1);dispatch_async(queue, readingBlock2);dispatch_async(queue, readingBlock3);// å†™å…¥æ“ä½œdispatch_barrier_async(queue, writingBlock1);// è¯»å–æ“ä½œdispatch_async(queue, readingBlock4);dispatch_async(queue, readingBlock5); çº¿ç¨‹çš„æŒ‚èµ·/æ¢å¤ å¯ä»¥å°†çº¿ç¨‹æš‚æ—¶æŒ‚èµ·ï¼ŒåŽé¢å†è¿›è¡Œæ¢å¤æ‰§è¡Œã€‚ä½†ä»…é™äºŽè¿˜æœªæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå·²æ‰§è¡Œçš„å’Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¸å—å½±å“ã€‚12345// æŒ‚èµ·çº¿ç¨‹dispatch_suspend(queue);// æ¢å¤çº¿ç¨‹dispatch_resume(queue); Dispatch Semaphore(ä¿¡å·é‡)æŽ§åˆ¶ä¸ºäº†ç²¾ç¡®æŽ§åˆ¶å¹¶è¡Œå¤„ç†ï¼ŒGCDæä¾›äº†ä¿¡å·é‡12345// ç”ŸæˆDispatch Semaphoreå¹¶æŒ‡å®šä¿¡å·é‡dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);// ç­‰å¾…ä¿¡å·é‡å¤§äºŽç­‰äºŽ1dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSOperationé™¤äº†ä½¿ç”¨GCDä¹‹å¤–ï¼ŒiOSè¿˜æä¾›äº†NSOperation/NSOperationQueueè¿™ä¸€å¤šçº¿ç¨‹å®žçŽ°æ–¹å¼ã€‚ å®žçŽ°æœºåˆ¶NSOperationä»£è¡¨ä¸€ä¸ªå¤šçº¿ç¨‹ä»»åŠ¡ã€‚NSOperationQueueä»£è¡¨ä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œå…¶åº•éƒ¨ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä¼šæŒ‰ç…§å…ˆå…¥å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œæäº¤ç»™é˜Ÿåˆ—çš„NSOperationä»»åŠ¡ã€‚ ä½¿ç”¨æ­¥éª¤ä½¿ç”¨NSOperationQueueè¾ƒä¸ºç®€å•ï¼Œå…¶è´Ÿè´£ç®¡ç†ã€æ‰§è¡Œæ‰€æœ‰NSOperationï¼Œå¼€å‘è€…èƒ½å¤Ÿå°†æ³¨æ„åŠ›æ›´å¤šçš„æ”¾åœ¨ä»»åŠ¡ä¸Šè€Œéžé˜Ÿåˆ—çš„ä½¿ç”¨ä¸Šã€‚å…¶ä¸»è¦æä¾›äº†ä»¥ä¸‹API:123456789101112// æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­- (void)addOperation:(NSOperation *)op;// æ·»åŠ å¹¶é˜»å¡žå½“å‰çº¿ç¨‹è‡³æ‰€æœ‰ä»»åŠ¡å®Œæˆ- (void)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)wait;// å–æ¶ˆæ‰€æœ‰æ“ä½œ- (void)cancelAllOperations;// è®¾ç½®NSOperationQueueé˜Ÿåˆ—æœ€å¤§æ”¯æŒçš„å¹¶å‘çº¿ç¨‹æ•°é‡@property NSInteger maxConcurrentOperationCount;// è®¾ç½®å’Œè¿”å›žæ˜¯æ˜¯å¦æš‚åœè°ƒåº¦å½“å‰æ­£åœ¨æŽ’é˜Ÿçš„ä»»åŠ¡ï¼Œéœ€è¦ä½¿ç”¨KVCè®¾ç½®@property(getter=isSuspended) BOOL suspended; NSOperationä½¿ç”¨NSOperationä¸€èˆ¬ä¸ç›´æŽ¥ä½¿ç”¨ï¼Œè€Œæ˜¯åˆ›å»ºå…¶å­ç±»æ¥ä½¿ç”¨ã€‚ç»§æ‰¿NSOperationéœ€è¦é‡å†™å…¶mainæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„æ–¹æ³•ä½“ç”¨äºŽNSOperationQueueæ¥æ‰§è¡Œä»»åŠ¡ã€‚ è€Œé»˜è®¤ä¸ºæˆ‘ä»¬æä¾›äº†NSInvocationOperationå’ŒNSBlockOperationä¸¤ç§å­ç±»ï¼Œåˆ†åˆ«å¯¹åº”äº†SELå’ŒBlockä¸¤ç§ä»»åŠ¡æäº¤æ–¹å¼ã€‚12345// NSInvocationOperation- (instancetype)initWithTarget:(id)target selector:(SEL)sel object:(id)arg;// NSBlockOperation+ (instancetype)blockOperationWithBlock:(void (^)(void))block; æ€»ç»“æœ¬æ–‡ä¸»è¦æ€»ç»“iOSå¼€å‘ä¸­çš„å¤šçº¿ç¨‹æ¦‚å¿µã€æŠ€æœ¯æ–¹æ¡ˆä»¥åŠç®€å•å®žç”¨ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼ä¸å†èµ˜è¿°ã€‚å¼€å‘ä¸­å¸¸ç”¨åˆ°GCDå’ŒNSOperationï¼Œè€Œå‰è€…åœ¨åŠŸèƒ½ä¸°å¯Œæ€§å’Œå¤æ‚æ€§ä¸Šä¹Ÿè®¸æœ‰ç€æ›´å¥½çš„å‡è¡¡ã€‚ åŒæ—¶æœ¬æ–‡è¿˜æ¶‰åŠåˆ°äº†çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹ä¸­é”çš„æŠ€æœ¯æ–¹æ¡ˆã€çº¿ç¨‹çš„ä½¿ç”¨è§„åˆ™ç­‰é—®é¢˜ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶ã€‚ ç›¸å…³èµ„æ–™ iOSå¤šçº¿ç¨‹ç¼–ç¨‹æŒ‡å—: Threading Programming Guide iOSå¹¶è¡Œç¼–ç¨‹æŒ‡å—: Concurrency Programming Guide]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>GCD</tag>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>iOSæŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Objective-Cåè®®éµå®ˆNSObjectåè®®çš„åŽŸå› ]]></title>
    <url>%2F2017%2F03%2F24%2FObjective-C%E5%8D%8F%E8%AE%AE%E9%81%B5%E5%AE%88NSObject%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%8E%9F%E5%9B%A0%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©å°†ç”¨OCå†™çš„æ¡†æž¶è¿ç§»è‡³Swiftæ—¶ï¼Œå‘çŽ°OCå†™çš„åè®®éƒ½éµå®ˆäº†NSObjectï¼Œè€Œåœ¨Swiftä¸­æ²¡æœ‰æ­¤åè®®ã€‚æ‰€ä»¥è®°å½•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜çš„åŽŸå› ï¼š åœ¨Objective-C 2.0ä¹‹åŽï¼Œæ–¹æ³•ä¿®é¥°ç¬¦æœ‰@requiredå’Œ@optional(æ–°å¢ž)ï¼Œä¹Ÿå°±æ˜¯è¯´å¢žåŠ äº†å¯é€‰æ–¹æ³•ã€‚å¯¹åº”çš„ï¼Œä¹Ÿå°±éœ€è¦åœ¨è°ƒç”¨ä»£ç†æ–¹æ³•ä¹‹å‰åˆ¤æ–­å…¶æ˜¯å¦è¢«å®žçŽ°ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å¦‚ä¸‹å†™æ³•: 123if (self.delegate != nil &amp;&amp; [self.delegate respondsToSelector:@selector(protocolFunc)]) &#123;[self.delegate protocolFunc];&#125; NSObjectçš„åè®®ä¸»è¦å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªå¸¸è§æ–¹æ³•: - (BOOL)isKindOfClass:(Class)aClass; - (BOOL)isMemberOfClass:(Class)aClass; - (BOOL)conformsToProtocol:(Protocol *)aProtocol; - (BOOL)respondsToSelector:(SEL)aSelector; etcâ€¦ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ç»§æ‰¿NSObjectã€‚è€ŒSwiftè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†å¯é€‰é¡¹ï¼Œä¿è¯äº†è°ƒç”¨çš„å®‰å…¨æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹æ³•ä½¿ç”¨: 1234567891011121314151617181920// å®šä¹‰åè®®@objc protocol MCTestViewDelegate: class &#123;@objc func testViewNeedsOperate()@objc optional func testViewDidUpdate()&#125;/* ... */// åˆ¤æ–­æ˜¯å¦éµå®ˆåè®®å¹¶è°ƒç”¨if let delegate = testView is MCTestViewDelegate &#123;delegate.testViewNeedsOperate()&#125;// åˆ¤æ–­ä»£ç†å¯¹è±¡æ˜¯å¦å®žçŽ°è¯¥ä»£ç†æ–¹æ³•if (delegate as? MCTestViewDelegate)?.testViewDidUpdate != nil &#123;// å¤„ç†...&#125;// ä¸€å¥è¯å®žçŽ°(delegate as? MCTestViewDelegate)?.testViewDidUpdate?() é€šè¿‡å¯é€‰é¡¹çš„åˆ¤æ–­ï¼Œå³å¯è½»æ¾åˆ¤æ–­æ–¹æ³•/åè®®æ˜¯å¦å®žçŽ°ï¼Œå‡å°‘äº†ä»£ç é‡ã€‚]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Swift</tag>
        <tag>Objective-C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Gitæ·»åŠ Tagçš„æ–¹æ³•]]></title>
    <url>%2F2016%2F10%2F21%2F%E4%BD%BF%E7%94%A8Git%E6%B7%BB%E5%8A%A0Tag%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ç®€è¿°ä½œä¸ºç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼ŒGitå¯ä»¥å¯¹æŸä¸ªç‰ˆæœ¬æ‰“ä¸Šæ ‡ç­¾(tag)ï¼Œè¡¨ç¤ºæœ¬ç‰ˆæœ¬ä¸ºå‘è¡Œç‰ˆã€‚åœ¨å‘å¸ƒè½¯ä»¶ï¼Œä»¥åŠä½¿ç”¨CocoaPodsåˆ›å»ºä¾èµ–åº“ç­‰æƒ…å†µæ—¶ï¼Œéœ€è¦å¯¹å…¶ç‰ˆæœ¬ä½¿ç”¨æ ‡ç­¾æ³¨é‡Šã€‚æ•…ç®€å•æ€»ç»“ä¸€ä¸‹æ·»åŠ tagçš„æ–¹å¼ã€‚ ä½¿ç”¨Gitå‘½ä»¤æŸ¥çœ‹æ ‡ç­¾æ‰“å°æ‰€æœ‰æ ‡ç­¾1git tag` æ‰“å°ç¬¦åˆæ£€ç´¢æ¡ä»¶çš„æ ‡ç­¾1git tag -l &lt;ç‰ˆæœ¬å·&gt; å¦‚ git tag -l 1.*.* ä¸ºæœç´¢ä¸€çº§ç‰ˆæœ¬ä¸º1çš„ç‰ˆæœ¬ æŸ¥çœ‹å¯¹åº”æ ‡ç­¾çŠ¶æ€1git checkout &lt;ç‰ˆæœ¬å·&gt; åˆ›å»ºæœ¬åœ°æ ‡ç­¾åˆ›å»ºè½»é‡æ ‡ç­¾è½»é‡æ ‡ç­¾æŒ‡å‘ä¸€ä¸ªå‘è¡Œç‰ˆçš„åˆ†æ”¯ï¼Œå…¶åªæ˜¯ä¸€ä¸ªåƒæŸcommitçš„å¼•ç”¨ï¼Œä¸å­˜å‚¨åç§°æ—¶é—´æˆ³åŠæ ‡ç­¾è¯´æ˜Žç­‰ä¿¡æ¯ã€‚å®šä¹‰æ–¹æ³•å¦‚ä¸‹1git tag &lt;ç‰ˆæœ¬å·&gt;-light åˆ›å»ºå¸¦é™„æ³¨æ ‡ç­¾ç›¸å¯¹äºŽè½»é‡æ ‡ç­¾ï¼Œé™„æ³¨æ ‡ç­¾æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ ‡ç­¾å¯¹è±¡ï¼ŒåŒ…å«äº†åç§°æ—¶é—´æˆ³ä»¥åŠæ ‡ç­¾å¤‡æ³¨ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶æŒ‡å‘å¯¹åº”çš„commitã€‚å®šä¹‰æ–¹æ³•å¦‚ä¸‹1git tag -a &lt;ç‰ˆæœ¬å·&gt; -m "&lt;å¤‡æ³¨ä¿¡æ¯&gt;" åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒç‰¹å®šçš„commitæ·»åŠ æ ‡ç­¾ï¼Œä½¿ç”¨è¯¥commitå¯¹åº”çš„SHAå€¼å³å¯1git tag -a &lt;ç‰ˆæœ¬å·&gt; &lt;SHAå€¼&gt; -m "&lt;å¤‡æ³¨ä¿¡æ¯&gt;" æ¯”å¦‚ git tag -a 1.0.0 0c3b62d -m &quot;Release Edition v1.0.0&quot; å°±æ˜¯ä¸ºSHAä¸º0c3b62dçš„è¿™æ¬¡æäº¤æ‰“äº†1.0å‘è¡Œç‰ˆçš„tag åˆ é™¤æœ¬åœ°æ ‡ç­¾1git tag -d &lt;ç‰ˆæœ¬å·&gt; å°†æœ¬åœ°æ ‡ç­¾æäº¤åˆ°è¿œç¨‹ä»“åº“å‰é¢æ‰€æåˆ°çš„åˆ›å»ºæ ‡ç­¾ï¼Œåªæ˜¯å°†æ ‡ç­¾æ·»åŠ åˆ°äº†æœ¬åœ°çš„ç‰ˆæœ¬ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ›å»ºä¹‹åŽå°†æœ¬åœ°æ ‡ç­¾åŒæ­¥åˆ°è¿œç¨‹ä»“åº“ï¼Œå¦‚Githubã€‚ æŽ¨é€æ‰€æœ‰æ ‡ç­¾1git push origin --tags æŽ¨é€æŒ‡å®šç‰ˆæœ¬çš„æ ‡ç­¾1git push origin &lt;ç‰ˆæœ¬å·&gt; åˆ é™¤è¿œç¨‹ä»“åº“çš„æ ‡ç­¾åŒåˆ›å»ºæœ¬åœ°æ ‡ç­¾ä¸€æ ·ï¼Œåˆ é™¤äº†æœ¬åœ°æ ‡ç­¾ä¹‹åŽä¹Ÿè¦åŒæ—¶åˆ é™¤è¿œç¨‹ä»“åº“çš„æ ‡ç­¾ã€‚ æ–°ç‰ˆæœ¬Git (&gt; v1.7.0)1git push origin --delete &lt;ç‰ˆæœ¬å·&gt; æ–°æ—§ç‰ˆæœ¬é€šç”¨æ–¹æ³•æ—§ç‰ˆæœ¬Gitå¹¶æ²¡æœ‰æä¾›ç›´æŽ¥åˆ é™¤çš„æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸€ä¸ªç©ºæ ‡ç­¾æ›¿æ¢çŽ°æœ‰æ ‡ç­¾æ¥å®žçŽ°åˆ é™¤æ ‡ç­¾ï¼Œå³å¦‚ä¸‹å‘½ä»¤1git push origin :refs/tags/&lt;ç‰ˆæœ¬å·&gt; è¡¥å……ï¼šä½¿ç”¨Githubæ·»åŠ æ ‡ç­¾Githubä¸ºæˆ‘ä»¬æä¾›äº†åœ¨é¡µé¢ä¸Šè¿›è¡Œç¼–è¾‘å‘è¡Œç‰ˆæœ¬çš„æ–¹å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨Githubä¸Šä¸ºé¡¹ç›®æ‰“tagå¯åœ¨releaseé¡µé¢ï¼Œé€‰æ‹©åˆ›å»ºæ–°tagå¹¶æŒ‰ä¸‹å›¾æ‰€ç¤ºå¡«å†™å³å¯ã€‚åˆ é™¤tagä¹ŸåŒç†ã€‚æ¯ã€‚ æ€»ç»“æœ€åŽæ€»ç»“ä¸€ä¸‹å¸¸ç”¨å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚ 123456789101112131415161718192021222324252627282930/// æŸ¥çœ‹æ ‡ç­¾// æ‰“å°æ‰€æœ‰æ ‡ç­¾git tag// æ‰“å°ç¬¦åˆæ£€ç´¢æ¡ä»¶çš„æ ‡ç­¾git tag -l 1.*.*// æŸ¥çœ‹å¯¹åº”æ ‡ç­¾çŠ¶æ€git checkout 1.0.0/// åˆ›å»ºæ ‡ç­¾(æœ¬åœ°)// åˆ›å»ºè½»é‡æ ‡ç­¾git tag 1.0.0-light// åˆ›å»ºå¸¦å¤‡æ³¨æ ‡ç­¾(æŽ¨è)git tag -a 1.0.0 -m "è¿™æ˜¯å¤‡æ³¨ä¿¡æ¯"// é’ˆå¯¹ç‰¹å®šcommitç‰ˆæœ¬SHAåˆ›å»ºæ ‡ç­¾git tag -a 1.0.0 0c3b62d -m "è¿™æ˜¯å¤‡æ³¨ä¿¡æ¯"/// åˆ é™¤æ ‡ç­¾(æœ¬åœ°)git tag -d 1.0.0/// å°†æœ¬åœ°æ ‡ç­¾å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“// å‘é€æ‰€æœ‰git push origin --tags// æŒ‡å®šç‰ˆæœ¬å‘é€git push origin 1.0.0/// åˆ é™¤è¿œç¨‹ä»“åº“å¯¹åº”æ ‡ç­¾// Gitç‰ˆæœ¬ &gt; V1.7.0git push origin --delete 1.0.0// æ—§ç‰ˆæœ¬Gitgit push origin :refs/tags/1.0.0]]></content>
      <categories>
        <category>å¼€æºæ¡†æž¶</category>
      </categories>
      <tags>
        <tag>Github</tag>
        <tag>CocoaPods</tag>
        <tag>OpenSource</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CALayerçš„å¯„å®¿å›¾]]></title>
    <url>%2F2016%2F09%2F01%2FCALayer%E7%9A%84%E5%AF%84%E5%AE%BF%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[å¯„å®¿å›¾æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè§†å›¾å¯ä»¥å¯¼å…¥å›¾ç‰‡ï¼Œå¹¶è®¾ç½®å…¶æ‹‰ä¼¸æ¨¡å¼ã€æ”¾å¤§æ¯”ä¾‹ä¹‹ç±»ã€‚è€Œå›¾å±‚ä¹Ÿå¯ä»¥å¯¼å…¥å›¾ç‰‡ï¼ŒCALayeræä¾›äº†å¯„å®¿å›¾çš„æ¦‚å¿µæ¥å®žçŽ°è¿™ä¸€ç‚¹ã€‚ç®€å•æ¥è¯´ï¼Œå¯„å®¿å›¾å°±æ˜¯å›¾å±‚ä¹‹ä¸­åŒ…å«çš„å›¾ã€‚ CALayerçš„contentså±žæ€§åœ¨è®¾ç½®å›¾å±‚å›¾ç‰‡æ—¶ï¼Œéœ€è¦ç»™contentsèµ‹å€¼ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š@property(nullable, strong) id contents;å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ˜¯ä¸€ä¸ªidç±»åž‹çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™æ˜¯ä¸ºäº†å…¼å®¹OSXå¼€å‘ä¸­CoreAnimationã€AppKitä¸­çš„CGImageå’ŒNSImageä¸¤ç§ç±»åž‹è€Œè®¾ç½®ã€‚å¯¹äºŽUIKitçš„UIImageå¹¶ä¸æ”¯æŒï¼Œè®¾ç½®äº†æ— æ³•è¯†åˆ«çš„å¯¹è±¡æ˜¯ä¸èƒ½æ˜¾ç¤ºçš„ï¼Œæ‰€ä»¥ä½¿ç”¨UIImageéœ€è¦è°ƒç”¨ä¸‹è¿°çš„è½¬æ¢æ–¹æ³•ï¼š- (nullable CGImageRef)CGImageç”±äºŽè½¬æ¢çš„æ˜¯CGImageRefï¼Œæˆ‘ä»¬çŸ¥é“Cç±»åž‹æ˜¯ä¸å—ARCç®¡ç†çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œç±»åž‹æ¡¥æŽ¥ã€‚æœ€ç»ˆå°±æ˜¯å¦‚ä¸‹æ•ˆæžœï¼šlayer.contents = (__bridge id)image.CGImage; contentsç›¸å…³å±žæ€§è®¾ç½®äº†å¯„å®¿å›¾ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹å…¶è¿›è¡Œå‚æ•°è°ƒæ•´ã€‚å›¾å±‚åœ¨æ ·å¼å’ŒåŠ¨ç”»æ–¹é¢æä¾›äº†æ¯”è§†å›¾æ›´å¤šçš„é€‰æ‹©ï¼š contentGravity // æ‹‰ä¼¸æ¨¡å¼ contentsScale // åƒç´ æ¯”ä¾‹ maskToBounds // æ˜¯å¦è£åˆ‡ contentsRect // æ˜¾ç¤ºåŒºåŸŸ contentsCenter // æ‹‰ä¼¸åŒºåŸŸ contentsGravityå½“æˆ‘ä»¬ä¸ºcontentè®¾ç½®äº†å›¾ç‰‡åŽï¼Œå›¾ç‰‡é»˜è®¤æ˜¯ä¼šæ‹‰ä¼¸è‡³å›¾å±‚å¤§å°çš„ï¼Œè€Œå¦‚åŒè§†å›¾çš„contetModeï¼Œå›¾å±‚ä¸ºæˆ‘ä»¬æä¾›äº†contentGravityå±žæ€§ã€‚@property(copy) NSString *contentsGravity;å®ƒæ˜¯NSStringç±»åž‹ï¼Œå¯é€‰çš„å¸¸é‡å€¼ä¸ºkCAGravity**,å…·ä½“å¦‚ä¸‹ kCAGravityCenter kCAGravityTop kCAGravityBottom kCAGravityLeft kCAGravityRight kCAGravityTopLeft kCAGravityTopRight kCAGravityBottomLeft kCAGravityBottomRight kCAGravityResize kCAGravityResizeAspect kCAGravityResizeAspectFill å¯¹äºŽå›¾ç‰‡è¢«æ‹‰ä¼¸çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¤„ç†ä¹‹åŽå¦‚ä¸‹: contentsScaleç”±äºŽè‹¹æžœè®¾å¤‡å¤šé‡‡ç”¨äº†Retinaå±å¹•ï¼Œå±å¹•çš„å®žé™…åˆ†è¾¨çŽ‡(æ‰‹æœºåƒç´ )å’Œè®¾è®¡åˆ†è¾¨çŽ‡(è§†å›¾çš„ç‚¹)ä¹‹é—´å­˜åœ¨ç€åŒºåˆ«ã€‚æ¯”å¦‚å¯¹äºŽiPhone 6ï¼Œè§†å›¾å¤§å°ä¸º375Ã—677(å•ä½:ç‚¹)ï¼Œä½†å®žé™…åƒç´ ä¸º750Ã—1334(å•ä½:åƒç´ )ï¼Œåœ¨ç•Œé¢å¼€å‘æ—¶å¹¶æ— å¤§ç¢ï¼Œè€Œå¯¹äºŽå›¾ç‰‡ç´ æï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¸å¸Œæœ›é«˜åˆ†å±ä¸Žå›¾ç‰‡çš„åƒç´ ç»˜åˆ¶æ¯”ä¾‹ä¸º1:1ï¼Œä¸ºäº†ä¸è®©å›¾ç‰‡æ¢ç®—æˆè§†å›¾å¤§å°åŽå¤ªå°ï¼Œå°±è¦è®¾ç½®å®žé™…ç¼©æ”¾æ¯”ï¼Œä»Žè€Œè®©é«˜åˆ†å±ç”¨å¤šä¸ªåƒç´ æ˜¾ç¤ºå›¾ç‰‡1ä¸ªåƒç´ çš„å†…å®¹ã€‚è‹¹æžœä¸ºæˆ‘ä»¬æä¾›äº†contentsScaleå±žæ€§æ¥è®¾ç½®ã€‚ æ¯”å¦‚å½“æˆ‘ä»¬è®¾ç½®contentsScaleä¸º1.0ï¼Œå³å±å¹•æ¯ä¸€ä¸ªç‚¹ç»˜åˆ¶å›¾ç‰‡çš„1ä¸ªåƒç´ ã€‚è€ŒcontentsScaleä¸º2.0æ—¶ï¼Œå±å¹•æ¯ä¸€ä¸ªç‚¹ç»˜åˆ¶å›¾ç‰‡çš„2ä¸ªåƒç´ ã€‚æ˜¾ç¤ºæ•ˆæžœå¦‚ä¸‹: Tips: éœ€è¦æ³¨æ„ï¼Œç¼©æ”¾åªæœ‰åœ¨å›¾ç‰‡é€‚é…æ¨¡å¼ä¸æ˜¯kCAGravityResize*(æ‹‰ä¼¸)æ¨¡å¼æ—¶æ‰æœ‰æ•ˆã€‚ maskToBoundsè¿™ä¸ªå±žæ€§å¯¹åº”è§†å›¾çš„clipToBoundså±žæ€§ã€‚é»˜è®¤æƒ…å†µä¸‹è§†å›¾å’Œå›¾å±‚éƒ½å…è®¸å­è§†å›¾å’Œå­å›¾å±‚çš„ç»˜åˆ¶èŒƒå›´è¶…å‡ºè‡ªå·±çš„è¾¹ç•Œã€‚ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸æƒ³è¦è¿™ä¸ªæ•ˆæžœï¼Œå¾ˆå¤šæ ·å¼éƒ½éœ€è¦è£åˆ‡å­å›¾å±‚ã€‚æ•ˆæžœå¦‚ä¸‹: contentsRectcontentsRectç”¨æ¥æŒ‡å®šå†…å®¹æ˜¾ç¤ºçš„åŒºåŸŸï¼Œæ¯”å¦‚æ˜¾ç¤ºå›¾ç‰‡çš„æŸä¸ªå±€éƒ¨ç»†èŠ‚ã€‚æ³¨æ„æ•°å€¼æ˜¯æ¯”ä¾‹å¤§å°(0.0~1.0)ï¼Œè€Œéžè§†å›¾å¤§å°ã€‚å…¶åªæ˜¯è®¾ç½®æ˜¾ç¤ºåŒºåŸŸï¼Œè€Œéžè£å‰ªå›¾ç‰‡ï¼Œå†…å­˜ä¸­ä¿å­˜çš„ä¾æ—§æ˜¯æ•´ä¸ªå›¾ç‰‡ï¼Œå¦‚æžœè¦å¤„ç†å›¾ç‰‡åº”ä½¿ç”¨Core Graphicã€‚ contentsCenterUIImageæä¾›äº†resizableImageWithCapInsetsæ–¹æ³•æ¥é…ç½®å›¾ç‰‡çš„æ‹‰ä¼¸ï¼Œè€Œåœ¨å›¾å±‚ä¸­å¯ä»¥é€šè¿‡è®¾ç½®ccontentsCenterå±žæ€§æ¥è®¾ç½®ä¸€ä¸ªå¯æ‹‰ä¼¸åŒºåŸŸï¼Œä»Žè€Œä¿è¯å›¾ç‰‡åœ¨æ”¶åˆ°æ‹‰ä¼¸æ—¶å±€éƒ¨ä¸å˜å½¢ã€‚ æˆ‘ä»¬é€‰æ‹©ä¸€å¼ èŠå¤©æ°”æ³¡çš„ç…§ç‰‡ï¼Œç„¶åŽç¼–å†™å¦‚ä¸‹ä»£ç æ¥æµ‹è¯•:123456789101112- (void)viewDidLoad &#123;[super viewDidLoad];self.view.backgroundColor = [UIColor lightGrayColor];UIImage *image = [UIImage imageNamed:@&quot;bubble&quot;];self.layerView1.layer.contents = (__bridge id)image.CGImage;self.layerView2.layer.contents = (__bridge id)image.CGImage;self.layerView2.layer.contentsCenter = CGRectMake(0.75, 0.75, 0.1, 0.1);&#125; åŽŸå›¾åŠè£åˆ‡æ•ˆæžœä¸ºï¼š é€šè¿‡Core Graphicç»˜åˆ¶CALayeré™¤äº†é€šè¿‡Core Animationæ¡†æž¶çš„å±žæ€§æ¥è®¾ç½®å¤–ï¼Œè¿˜å¯ä»¥ç›´æŽ¥é€šè¿‡Core Graphicæ¥ç»˜åˆ¶ã€‚ UIViewçš„æ˜¾ç¤ºæœºåˆ¶å½“è§†å›¾åœ¨å±å¹•ä¸Šå‡ºçŽ°æ—¶ï¼Œå®ƒä¼šæ£€æµ‹-(void)rawRect:æ˜¯å¦è¢«å®žçŽ°(è¯¥æ–¹æ³•æ— é»˜è®¤å®žçŽ°)ï¼Œå¦‚æžœå®žçŽ°äº†åˆ™ä¸ºè§†å›¾åˆ›å»ºä¸€ä¸ªå¯„å®¿å›¾ï¼Œå…¶å¤§å°ç­‰äºŽè§†å›¾å¤§å°Ã—contentsScaleã€‚(è‹¥ä¸å®žçŽ°è¯¥æ–¹æ³•åˆ™ä¸ä¼šåˆ›å»ºï¼Œè¿›è€Œä¼˜åŒ–æ€§èƒ½)ã€‚ -(void)drawRect:æ˜¯è§†å›¾çš„æ–¹æ³•è€Œä¸æ˜¯å›¾å±‚çš„ï¼Œå›¾å±‚æä¾›äº†å›¾å±‚æ–¹æ³•çš„ä»£ç†ï¼Œå¯ç”±è§†å›¾é€šè¿‡å®žçŽ°ä»£ç†æ–¹æ³•å®Œæˆç»˜å›¾ã€‚-(void)drawRect:ä¸èƒ½æ‰‹åŠ¨è°ƒç”¨ï¼Œéœ€è¦è°ƒç”¨-(void)setNeedsDisplayæ¥é€šçŸ¥é‡ç»˜ã€‚ è°ƒç”¨-(void)setNeedsDisplayåŽä¼šå‡ºå‘ä»£ç†æ–¹æ³•-(void)displayLayer:(CALayer )layerå’Œ-(void)drawLayer:(CALayer )layer inContext:(CGContextRef)ctxã€‚ (æ³¨ï¼šå¦‚æžœä¸¤ç§æ–¹æ³•åŒæ—¶å­˜åœ¨ï¼Œåˆ™åªä¼šè°ƒç”¨åŽè€…)ã€‚]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>iOSåŠ¨ç”»</tag>
        <tag>Core Animation</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSè“ç‰™æ¡†æž¶CoreBluetoothåŠå°ç±³æ‰‹çŽ¯Demo]]></title>
    <url>%2F2016%2F08%2F15%2FiOS%E8%93%9D%E7%89%99%E6%A1%86%E6%9E%B6CoreBluetooth%E5%8F%8A%E5%B0%8F%E7%B1%B3%E6%89%8B%E7%8E%AFDemo%2F</url>
    <content type="text"><![CDATA[ç« èŠ‚ç›®å½• iOSè“ç‰™æ¡†æž¶ä»‹ç» CoreBluetooth.frameworkå¯¼å…¥ CoreBluetoothçš„åŸºç¡€ä½¿ç”¨ è“ç‰™è¿žæŽ¥æ‰€æ¶‰åŠåˆ°çš„ç±» å°ç±³æ‰‹çŽ¯Demo iOSè“ç‰™æ¡†æž¶ä»‹ç»CoreBluetoothä»‹ç»åœ¨iOSå¼€å‘ä¸­ï¼Œå®žçŽ°è“ç‰™é€šä¿¡çš„æ–¹æ³•æœ‰ä¸¤ç§ã€‚åˆ†åˆ«æ˜¯GameKit.frameworkä»¥åŠCoreBluetooth.frameworkï¼Œå‰è€…åœ¨iOS5åŽåŸºæœ¬è¢«æ·˜æ±°ã€‚ åœ¨è‹¹æžœæ–‡æ¡£ä¸­ï¼Œå†™äº†Communicate with Bluetooth 4.0 low-energy devicesï¼Œä¹Ÿå°±æ˜¯è¯´ä»…æ”¯æŒè“ç‰™4.0ä½ŽåŠŸè€—åè®®(BLE)ã€‚ å¯¹äºŽiOS10ä»¥ä¸Šçš„è®¾å¤‡ï¼Œè‹¹æžœæ³¨æ˜Žä»¥ä¸‹ä¿¡æ¯: An iOS app linked on or after iOS 10.0 must include in its Info.plist file the usage description keys for the types of data it needs to access or it will crash. To access Bluetooth peripheral data specifically, it must include NSBluetoothPeripheralUsageDescription. ä¹Ÿå°±æ˜¯è¯´éœ€è¦å£°æ˜Žå¹¶æ³¨å†Œè“ç‰™æƒé™çš„ä½¿ç”¨ã€‚ CoreBluetoothåè®®é¦–å…ˆæåŠè“ç‰™ä½¿ç”¨ï¼Œåœ¨æ­¤å¼•å…¥ä¸¤ä¸ªæ¦‚å¿µï¼šä¸­å¿ƒè®¾å¤‡å’Œå¤–å›´è®¾å¤‡ã€‚ ä¸­å¿ƒè®¾å¤‡(å®¢æœç«¯)ï¼šä½œä¸ºä¸­å¤®ç®¡ç†å™¨çš„è®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯æœ¬å®žä¾‹ä¸­çš„iOSè®¾å¤‡ã€‚ å¤–å›´è®¾å¤‡(æœåŠ¡å™¨)ï¼šä¹Ÿå°±æ˜¯å¤–éƒ¨è®¾å¤‡ï¼Œæ‰®æ¼”è€…äº§ç”Ÿæ•°æ®çš„è§’è‰²ã€‚è®¸å¤šä¼ æ„Ÿå™¨ã€è“ç‰™æœåŠ¡è®¾å¤‡å‡æ˜¯å¤–å›´è®¾å¤‡ã€‚æœ¬å®žä¾‹ä¸­å°ç±³æ‰‹çŽ¯å°±æ˜¯å¤–å›´è®¾å¤‡ã€‚ åŒæ—¶æ•°æ®ä¼ è¾“è¿˜æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªå€¼ï¼š UUIDï¼šç›¸å½“ä¸Žä½¿ç”¨è¿™ä¸ªæ¨¡å—å¯¹æ˜ çš„åº”ç”¨çš„æ ‡è¯†ã€‚ RSSIï¼šä¿¡å·å¼ºåº¦ï¼Œåˆ©ç”¨æ­¤ä¿¡æ¯å¯è¿›è¡Œè“ç‰™æµ‹è·ï¼ŒåŽé¢å°†è¿›è¡Œè®²è§£ã€‚ CoreBluetoothä¸­æ¶‰åŠä»¥ä¸‹å¯¹è±¡ç±»ï¼š CBCentralManagerï¼šä¸­å¿ƒè®¾å¤‡ç±» CBPeripheralï¼šå¤–å›´è®¾å¤‡ç±» CBCharacteristicï¼šè®¾å¤‡ç‰¹å¾ç±» æŽ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹å¦‚ä½•å¯¼å…¥è“ç‰™æ¡†æž¶ã€‚ CoreBluetooth.frameworkå¯¼å…¥ é¦–å…ˆæ–°å»ºXcodeé¡¹ç›® åœ¨General-&gt;TARGETS-&gt;Linked Framworks and Librariesä¸­ç‚¹å‡»æ·»åŠ å¹¶é€‰æ‹©CoreBluetooth.frameworkå¯¼å…¥ã€‚ åœ¨ä»£ç ä¸­å¯¼å…¥CoreBluetooth.frameworkSwiftï¼šimport CoreBluetoothObjective-Cï¼š#import å£°æ˜Žåè®®ï¼šä½¿ç”¨CoreBluetoothéœ€è¦æ”¯æŒCBCentralManagerDelegate, CBPeripheralDelegateåè®®ï¼Œå³å‰é¢æ‰€è¯´çš„ä¸­å¿ƒè®¾å¤‡å’Œå¤–å›´è®¾å¤‡ï¼Œå¹¶å®žçŽ°ç›¸åº”æ–¹æ³• CoreBluetoothçš„åŸºç¡€ä½¿ç”¨å¯¼å…¥æ¡†æž¶å¹¶å£°æ˜Žåè®®åŽï¼Œå³å¯å¼€å§‹å®žçŽ°å¿…è¦æ–¹æ³•ã€‚ä¸‹é¢é€šè¿‡å±•ç¤ºæ•´ä¸ªæµç¨‹æ‰€éœ€è¦çš„æ–¹æ³• åˆå§‹åŒ– 1var manager = CBCentralManager.init(delegate: self as? CBCentralManagerDelegate, queue: nil) æ‰«æè®¾å¤‡ 1234567switch manager.state &#123; case .poweredOn: NSLog("æ­£åœ¨æ‰«æ") manager.scanForPeripherals(withServices: nil, options: nil) default: break &#125; æ³¨ï¼šè¿™é‡Œä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨switchè¯­æ³•ï¼Ÿå› ä¸ºCBCentralManagerçš„Stateå±žæ€§åœ¨ä¹‹å‰æ˜¯CBCentralManagerStateï¼Œä½†æ˜¯çŽ°åœ¨å˜æˆäº†CBManagerStateï¼Œè€Œéœ€è¦iOS10ä»¥ä¸Šæ‰æ”¯æŒåŽè€…(23333)ã€‚è¿™ä¸€æ³¢å¼ºåˆ¶å‡çº§æˆ‘æ˜¯æ‹’ç»çš„ï¼Œæ‰¾äº†å¾ˆå¤šæ–¹æ³•ä¹‹åŽï¼Œå‘çŽ°è¿™æ ·å†™å¯ä»¥è¢«XcodeæŽ¥å—è€Œä¸åŽ»æ£€æŸ¥ å¤„ç†å½“å‰ä¸­å¿ƒè®¾å¤‡è“ç‰™çŠ¶æ€ 12345678func centralManagerDidUpdateState(_ central: CBCentralManager) &#123; switch central.state &#123; case .poweredOn: NSLog("è“ç‰™å·²å¼€å¯") default: NSLog("è“ç‰™æœªå¼€å¯") &#125; &#125; æ‰«æåˆ°å¤–å›´è®¾å¤‡çš„å¤„ç† 123456789func centralManager(_ central: CBCentralManager, didDiscover peripheral: CBPeripheral, advertisementData: [String : Any], rssi RSSI: NSNumber) &#123; //peripheral.nameä¸ºè®¾å¤‡åç§° //å¯ä»¥è°ƒç”¨CBCentralManagerçš„stopScanåœæ­¢æ‰«æ central.stopScan() //å¯ä»¥è°ƒç”¨CBCentralManagerçš„connectè¿žæŽ¥è®¾å¤‡ central.connect(peripheral, options: nil) &#125; &#125; æˆåŠŸè¿žæŽ¥åˆ°å¤–å›´è®¾å¤‡çš„å¤„ç† 1234567unc centralManager(_ central: CBCentralManager, didConnect peripheral: CBPeripheral) &#123; NSLog("æˆåŠŸè¿žæŽ¥") //è®¾ç½®ä»£ç† peripheral.delegate = self //è¿žæŽ¥æˆåŠŸåŽæŽ¥ä¸‹æ¥è¯¥æ‰«ææœåŠ¡ peripheral.discoverServices(nil) &#125; è¿žæŽ¥å¤±è´¥çš„å¤„ç† 123func centralManager(_ central: CBCentralManager, didFailToConnect peripheral: CBPeripheral, error: Error?) &#123; NSLog("è¿žæŽ¥è®¾å¤‡å¤±è´¥") &#125; æ‰«æå·²è¿žæŽ¥å¤–å›´è®¾å¤‡æœåŠ¡ 123456789101112func peripheral(_ peripheral: CBPeripheral, didDiscoverServices error: Error?) &#123; if ((error) != nil) &#123; NSLog("æŸ¥æ‰¾æœåŠ¡å¤±è´¥") return &#125; else &#123; for service in peripheral.services! &#123; //æ‰«æåˆ°æœåŠ¡åŽå¯¹æœåŠ¡é€ä¸ªæ‰«æç‰¹å¾å€¼ peripheral.discoverCharacteristics(nil, for: service) &#125; &#125; &#125; æ‰«æåˆ°ç‰¹å¾å€¼åŽçš„æ“ä½œ 1234567891011121314151617func peripheral(_ peripheral: CBPeripheral, didDiscoverCharacteristicsFor service: CBService, error: Error?) &#123; if ((error) != nil) &#123; NSLog("æ‰«æç‰¹å¾å€¼å¤±è´¥") &#125; else &#123; for characteristic in service.characteristics! &#123; //è®¾ç½®ç‰¹å¾å€¼åªè¦æœ‰æ›´æ–°å°±èŽ·å– peripheral.setNotifyValue(true, for: characteristic) if (characteristic.uuid.uuidString == "ä½ æƒ³åŒ¹é…çš„å­—ç¬¦ä¸²") &#123; peripheral.readValue(for: characteristic) //æˆ– characSaver = characteristic &#125; &#125; &#125; &#125; è§£é‡Šä¸€ä¸‹åŽŸç†ï¼šæ–¹æ³•å¯¹æ¯ä¸ªæœåŠ¡è¿›è¡Œæ‰«æï¼ŒèŽ·å–ç‰¹å¾å€¼ã€‚è¾¨åˆ«æ˜¯å¦æ˜¯ä½ æƒ³è¦çš„åŠŸèƒ½çš„ç‰¹å¾å€¼å°±è¦ç”¨åˆ°UUIDï¼Œç”¨UUIDåŽ»åŒ¹é…ã€‚åŒ¹é…åˆ°åŽä½ å¯ä»¥é€‰æ‹©ä¿å­˜ä»–çš„ç‰¹å¾å€¼ä»Žè€Œåœ¨åŽé¢è‡ªè¡Œæ“ä½œï¼Œæˆ–è€…ç”¨readValueè¯»å–å®ƒçš„å€¼ï¼Œå¹¶ç”±ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸‹é¢ä»‹ç»çš„æ–¹æ³• èŽ·å–å…·ä½“å€¼ä¹‹åŽçš„æ“ä½œ12345678910111213func peripheral(_ peripheral: CBPeripheral, didUpdateValueFor characteristic: CBCharacteristic, error: Error?) &#123; if ((error) != nil) &#123; statusLabel.text = "ä»Žè®¾å¤‡èŽ·å–å€¼å¤±è´¥" return &#125; else &#123; if(characteristic.uuid.uuidString == "ç‰¹å®šå€¼") &#123; var infoBytes = [UInt8](characteristic.value!) var infoVal:Int = Int.init(infoBytes[0]) NSLog("èŽ·å–çš„å€¼ä¸ºï¼š%d\n", infoVal) &#125; &#125; &#125; è“ç‰™è¿žæŽ¥æ‰€æ¶‰åŠåˆ°çš„ç±»CBCentralManageræ­¤ç±»ä¸ºä¸­å¿ƒè®¾å¤‡ç±»ï¼Œç”¨äºŽæŽ§åˆ¶ä½œä¸ºä¸­å¿ƒè®¾å¤‡æ—¶çš„è¡Œä¸º stateï¼šèŽ·å–å½“å‰ä¸­å¿ƒè®¾å¤‡çŠ¶æ€ isScanningï¼šå½“å‰ä¸­å¿ƒè®¾å¤‡æ˜¯å¦åœ¨æ‰«æå¤–å›´è®¾å¤‡ stopScan()ï¼šåœæ­¢æ‰«æå¤–å›´è®¾å¤‡ scanForPeripherals(...)ï¼šæ‰«æå¤–å›´è®¾å¤‡(è¯·ç¡®ä¿è“ç‰™å¼€å¯) connect(...)ï¼šè¿žæŽ¥å¤–å›´è®¾å¤‡(éœ€è¦å…ˆæ‰«æåˆ°å¤–å›´è®¾å¤‡) cancelPeripheralConnection(...)ï¼šæ–­å¼€å¤–å›´è®¾å¤‡ CBPeripheralæ­¤ç±»ä¸ºå¤–å›´è®¾å¤‡ç±»ï¼Œç”¨äºŽå¯¹å¤–å›´è®¾å¤‡è¿›è¡Œç®¡ç† nameï¼šèŽ·å–å¤–å›´è®¾å¤‡çš„åç§° rssiï¼šèŽ·å–å½“å‰å¤–å›´è®¾å¤‡çš„ä¿¡å·å¼ºåº¦ stateï¼šèŽ·å–å¤–å›´è®¾å¤‡çš„çŠ¶æ€(disconnected/connecting/connected) â˜…servicesï¼šèŽ·å–å¤–å›´è®¾å¤‡æ‰€æä¾›çš„æœåŠ¡(éœ€è¦å…ˆæ‰«æåˆ°æœåŠ¡) discoverServices(...)ï¼šæ‰«æè®¾å¤‡æ‰€æä¾›çš„æœåŠ¡ discoverCharacteristics(...)ï¼šæ‰«æç‰¹å¾å€¼(éœ€è¦å…ˆèŽ·å–æœåŠ¡) readValue(...)ï¼šè¯»å–ç‰¹å¾å€¼æ‰€å¯¹åº”çš„å€¼(éœ€è¦å…ˆèŽ·å–åˆ°ç‰¹å¾å€¼ï¼ŒåŒæ—¶è¦æ³¨æ„æ­¤æ–¹æ³•ä¸åå›žå€¼ï¼Œè¦ç”¨åè®®çš„didUpdateValueFor characteristicæ–¹æ³•å¤„ç†) CBCharacteristicå¤–å›´è®¾å¤‡æœåŠ¡çš„ç‰¹å¾å€¼ â˜…Valueï¼šèŽ·å–ç‰¹å¾å€¼å¯¹åº”çš„å€¼ å°ç±³æ‰‹çŽ¯Demoå¼€å‘çŽ°åœ¨å°è¯•é€šè¿‡CoreBluetoothçš„å†…å®¹ï¼Œæ¥å®žçŽ°å°ç±³æ‰‹çŽ¯çš„è¿žæŽ¥ã€æŒ¯åŠ¨ä¸Žåœæ­¢æŒ¯åŠ¨åŠŸèƒ½ã€‚ç‰¹å¾å€¼åŸºäºŽå°ç±³æ‰‹çŽ¯1ï¼Œæœ‰å…´è¶£å¯ä»¥æ”¶é›†å…¶ä»–è®¾å¤‡ç‰¹å¾å€¼ã€‚ ç•Œé¢æ­å»ºæ–¹ä¾¿èµ·è§ï¼Œè¯¥é¡¹ç›®ç›´æŽ¥é‡‡ç”¨storyboardæ­å»ºï¼Œä¸å†èµ˜è¿°é¡¹ç›®Demo 12345678@IBOutlet weak var scanButton: UIButton!@IBOutlet weak var stopButton: UIButton!@IBOutlet weak var vibrateButton: UIButton!@IBOutlet weak var stopVibrateButton: UIButton!@IBOutlet weak var loadingInd: UIActivityIndicatorView!@IBOutlet weak var statusLabel: UILabel!@IBOutlet weak var resultField: UITextView!@IBOutlet weak var vibrateLevel: UISegmentedControl! è®¾ç½®è“ç‰™æ“ä½œè¿‡ç¨‹æ‰€éœ€å¯¹è±¡æŒ‰ä¸Šè¿°è®²è§£ï¼Œå®šä¹‰æ‰€éœ€çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸­å¿ƒè®¾å¤‡å¤–å›´è®¾å¤‡ç­‰ã€‚ 123var theManager: CBCentralManager!var thePerpher: CBPeripheral!var theVibrator: CBCharacteristic! å®žçŽ°CBCentralManagerDelegateåè®®æŒ‰ä¸Šæ–‡æ‰€è¿°å®žçŽ°CBCentralManagerDelegateåè®® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161override func viewDidLoad() &#123; super.viewDidLoad() // Do any additional setup after loading the view, typically from a nib. theManager = CBCentralManager.init(delegate: self as? CBCentralManagerDelegate, queue: nil) self.scanButton.isEnabled = false statusLabel.text = "" loadingInd.isHidden = true&#125;// æ‰«æå¹¶è¿žæŽ¥@IBAction func startConnectAction(_ sender: UIButton) &#123; switch theManager.state &#123; case .poweredOn: statusLabel.text = "æ­£åœ¨æ‰«æâ€¦" theManager.scanForPeripherals(withServices: nil, options: nil) self.loadingInd.startAnimating() self.scanButton.isEnabled = false self.isDisconnected = false default: break &#125;&#125;@IBAction func disconnectAction(_ sender: UIButton) &#123; if ((thePerpher) != nil) &#123; theManager.cancelPeripheralConnection(thePerpher) thePerpher = nil theVibrator = nil statusLabel.text = "è®¾å¤‡å·²æ–­å¼€" scanButton.isEnabled = true isDisconnected = true isVibrating = false &#125;&#125;@IBAction func vibrateAction(_ sender: Any) &#123; if ((thePerpher != nil) &amp;&amp; (theVibrator != nil)) &#123; let data: [UInt8] = [UInt8.init(vibrateLevel.selectedSegmentIndex+1)]; let theData: Data = Data.init(bytes: data) thePerpher.writeValue(theData, for: theVibrator, type: CBCharacteristicWriteType.withoutResponse) &#125;&#125;@IBAction func stopVibrateAction(_ sender: UIButton) &#123; if ((thePerpher != nil) &amp;&amp; (theVibrator != nil)) &#123; let data: [UInt8] = [UInt8.init(0)]; let theData: Data = Data.init(bytes: data) thePerpher.writeValue(theData, for: theVibrator, type: CBCharacteristicWriteType.withoutResponse) isVibrating = false &#125;&#125;// å¤„ç†å½“å‰è“ç‰™ä¸»è®¾å¤‡çŠ¶æ€func centralManagerDidUpdateState(_ central: CBCentralManager) &#123; switch central.state &#123; case .poweredOn: statusLabel.text = "è“ç‰™å·²å¼€å¯" self.scanButton.isEnabled = true default: statusLabel.text = "è“ç‰™æœªå¼€å¯ï¼" self.loadingInd.stopAnimating() &#125;&#125;// æ‰«æåˆ°è®¾å¤‡func centralManager(_ central: CBCentralManager, didDiscover peripheral: CBPeripheral, advertisementData: [String : Any], rssi RSSI: NSNumber) &#123; if (peripheral.name?.hasSuffix("MI"))! &#123; thePerpher = peripheral central.stopScan() central.connect(peripheral, options: nil) statusLabel.text = "æœç´¢æˆåŠŸï¼Œå¼€å§‹è¿žæŽ¥" &#125; // ç‰¹å¾å€¼åŒ¹é…è¯·ç”¨ peripheral.identifier.uuidString resultField.text = String.init(format: "å‘çŽ°æ‰‹çŽ¯\nåç§°ï¼š%@\nUUIDï¼š%@\n", peripheral.name!, peripheral.identifier.uuidString)&#125;// æˆåŠŸè¿žæŽ¥åˆ°è®¾å¤‡func centralManager(_ central: CBCentralManager, didConnect peripheral: CBPeripheral) &#123; statusLabel.text = "è¿žæŽ¥æˆåŠŸï¼Œæ­£åœ¨æ‰«æä¿¡æ¯..." peripheral.delegate = self peripheral.discoverServices(nil)&#125;// è¿žæŽ¥åˆ°è®¾å¤‡å¤±è´¥func centralManager(_ central: CBCentralManager, didFailToConnect peripheral: CBPeripheral, error: Error?) &#123; loadingInd.stopAnimating() statusLabel.text = "è¿žæŽ¥è®¾å¤‡å¤±è´¥" scanButton.isEnabled = true&#125;// æ‰«ææœåŠ¡func peripheral(_ peripheral: CBPeripheral, didDiscoverServices error: Error?) &#123; if ((error) != nil) &#123; statusLabel.text = "æŸ¥æ‰¾æœåŠ¡å¤±è´¥" loadingInd.stopAnimating() scanButton.isEnabled = true return &#125; else &#123; for service in peripheral.services! &#123; peripheral.discoverCharacteristics(nil, for: service) &#125; &#125;&#125;// æ‰«æåˆ°ç‰¹å¾å€¼func peripheral(_ peripheral: CBPeripheral, didDiscoverCharacteristicsFor service: CBService, error: Error?) &#123; if ((error) != nil) &#123; statusLabel.text = "æŸ¥æ‰¾æœåŠ¡å¤±è´¥" loadingInd.stopAnimating() scanButton.isEnabled = true return &#125; else &#123; for characteristic in service.characteristics! &#123; peripheral.setNotifyValue(true, for: characteristic) if (characteristic.uuid.uuidString == BATTERY) &#123; peripheral.readValue(for: characteristic) &#125; else if (characteristic.uuid.uuidString == DEVICE) &#123; peripheral.readValue(for: characteristic) &#125; else if (characteristic.uuid.uuidString == VIBRATE) &#123; theVibrator = characteristic &#125; &#125; &#125;&#125;// æ‰«æåˆ°å…·ä½“è®¾å¤‡func peripheral(_ peripheral: CBPeripheral, didUpdateValueFor characteristic: CBCharacteristic, error: Error?) &#123; if ((error) != nil) &#123; statusLabel.text = "ä»Žè®¾å¤‡èŽ·å–å€¼å¤±è´¥" return &#125; else &#123; if(characteristic.uuid.uuidString == BATTERY) &#123; var batteryBytes = [UInt8](characteristic.value!) var batteryVal:Int = Int.init(batteryBytes[0]) self.resultField.text = String.init(format: "%@ç”µé‡ï¼š%d%%\n", resultField.text, batteryVal) &#125; loadingInd.stopAnimating() scanButton.isEnabled = true statusLabel.text = "ä¿¡æ¯æ‰«æå®Œæˆï¼" if (isVibrating) &#123; vibrateAction(Any) &#125; &#125;&#125;// ä¸Žè®¾å¤‡æ–­å¼€è¿žæŽ¥func centralManager(_ central: CBCentralManager, didDisconnectPeripheral peripheral: CBPeripheral, error: Error?) &#123; statusLabel.text = "è®¾å¤‡å·²æ–­å¼€" scanButton.isEnabled = true if(!isDisconnected) &#123; theManager.scanForPeripherals(withServices: nil, options: nil) &#125;&#125; è¡¥å……ï¼šå°ç±³æ‰‹çŽ¯æŒ¯åŠ¨çš„UUIDæ˜¯2A06ï¼Œ0ä»£è¡¨ä¸æŒ¯ï¼Œ1ä¸ºçŸ­æŒ¯ï¼Œ2ä¸ºé•¿æŒ¯ã€‚ GitHubï¼šhttps://github.com/MinecodecraftDemoé“¾æŽ¥ï¼šhttps://github.com/Minecodecraft/MiBandDemo]]></content>
      <categories>
        <category>iOSæŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Cocoa</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ ‘çŠ¶æ•°ç»„çš„å‡ ç§æ¨¡åž‹]]></title>
    <url>%2F2016%2F08%2F13%2F%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E7%9A%84%E5%87%A0%E7%A7%8D%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[æ ‘çŠ¶æ•°ç»„åŸºæœ¬å®šä¹‰ï¼šæ ‘çŠ¶æ•°ç»„æ˜¯åˆ©ç”¨äºŒåˆ†çš„æ€æƒ³ä½¿å¾—æŸ¥è¯¢å’Œä¿®æ”¹çš„å¤æ‚åº¦éƒ½ä¸ºlog(n)çš„æ•°æ®ç»“æž„ï¼Œä¸»è¦ç”¨äºŽæŸ¥è¯¢æ•°ç»„å‰ç¼€å’Œã€åŒºé—´å’Œå¹¶ä¸”ç»å¸¸æ›´æ”¹æ•°æ®ã€‚ æ•°æ®ç»“æž„æ€æƒ³ï¼šå¦‚ä¸Šå›¾ï¼Œ2çš„kæ¬¡æ–¹çš„ä½ç½®å­˜æ”¾1ä¸€ç›´åˆ° 2^k è¿™äº›æ•°çš„å’Œï¼Œç„¶åŽå†ä¸æ–­äºŒåˆ†ã€‚å…·ä½“å®žçŽ°å¯ä»¥ç”¨äºŒè¿›åˆ¶è§£é‡Šï¼Œä¹Ÿå°±æ˜¯ä¾‹å¦‚XXX100ä¸­å‚¨å­˜çš„æ˜¯XXX000~XXX100è¿™ä¸€ä¸ªåŒºé—´çš„æ‰€æœ‰æ•° åŸºæœ¬æ“ä½œï¼šè€Œè¦å®žçŽ°è¿™ä¸€ç‚¹ï¼Œå°±è¦æ±‚ä¸€ä¸ªäºŒè¿›åˆ¶æ•°çš„æœ€ä½Žä½1ï¼Œè¿™ä¸ªå¯ä»¥ç”¨lowbitæ“ä½œå®žçŽ°ï¼šä¸€ä¸ªäºŒè¿›åˆ¶æ•°xå¯¹å…¶è¿›è¡Œx&amp;(-x)çš„æ“ä½œï¼Œå°±å¯ä»¥ä¿ç•™å…¶æœ€ä½Žä½çš„1ï¼Œè€Œè®²å…¶ä»–å…¨éƒ¨ä½å…¨æ¸…é›¶æ‰€ä»¥ä¸€ä¸ªæ•°åŠ ä¸Šè‡ªå·±çš„lowbitï¼Œå°±åˆ°äº†ä¸Šä¸€çº§åŒ…å«è‡ªå·±çš„åŒºé—´ï¼Œä¾‹å¦‚110(6)åŠ ä¸Š10å˜æˆäº†1000(8)ï¼Œå› ä¸º1000å¯¹åº”çš„0~1000åŒæ ·ï¼Œå‡åŽ»è‡ªå·±çš„lowbitå°±ç›¸å½“äºŽåŽ»å°¾ã€‚ æ¨¡åž‹1ï¼šæ”¹ç‚¹æ±‚ç‚¹æ±‚æ®µ123456789101112131415161718192021//è®¾Mä¸ºæœ€å¤§æ•°çš„ä¸Šé™ï¼Œtreerayå­˜æ ‘çŠ¶æ•°ç»„void add(int k,int num)//åƒæŸä¸ªä½ç½®æ·»åŠ çš„æ“ä½œ&#123; while(k&lt;=M)//é˜²æ­¢ä¸Šç•Œæº¢å‡º &#123; treeray[k]+=num; k+=k&amp;(-k);//ä¸æ–­åŠ ä¸Šlowbitæ¥å‘ä¸Šæ›´æ–°åŒ…å«è‡ªå·±çš„åŒºé—´ &#125; return;&#125;int read(int k)//è¯»å–ä»¥æŸä¸ªä½ç½®ä¸ºç»ˆç‚¹çš„å‰ç¼€å’Œ&#123; int sum=0; while(k)//ä¸€å®šè¦æ³¨æ„æ ‘çŠ¶æ•°ç»„ä¸èƒ½å‚¨å­˜0è¿™ä¸ªä½ç½® &#123; sum+=treeray[k]; k-=k&amp;(-k);//ä¸æ–­å‡lowbitæ¥åŠ ä¸Šå‰é¢åŒºé—´çš„å’Œ &#125; return sum;&#125; æ¨¡åž‹2ï¼šæ”¹æ®µæ±‚ç‚¹å½“éœ€è¦æ”¹æ®µæ±‚ç‚¹æ—¶ï¼Œåˆ©ç”¨æ ‘çŠ¶æ•°ç»„æ–¹ä¾¿æ±‚å‰ç¼€å’Œçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨è®°å½•å˜åŒ–é‡çš„æŠ€å·§ï¼Œå°±å¯ä»¥ä½¿å¾—ä¸€ä¸ªæ•°çš„å‰ç¼€å’Œå˜æˆä»–ä¹‹å‰æ‰€æœ‰çš„å˜åŒ–é‡ï¼Œä¾¿å¯å¾—åˆ°è¿™ä¸ªæ•°æœ¬èº«ã€‚åœ¨æ ‘çŠ¶æ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ•°åˆå§‹åŒ–ä¸º0ï¼Œç„¶åŽæ¯ä¸ªä½ç½®è®°å½•å®ƒä¸Žå·¦è¾¹çš„å·®å€¼ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 123456//addä¸Žreadå‡½æ•°åŒä¸Š//å½“åœ¨aä¸Žbé—´å…¨éƒ¨åŠ ä¸Šcæ—¶add(a,c);add(b+1,c);//å½“è¦å¾—åˆ°kçš„å€¼æ—¶read(k); æ¨¡åž‹3ï¼šæ”¹æ®µæ±‚æ®µå½“éœ€è¦æ”¹æ®µæ±‚æ®µæ—¶ï¼Œä¸Žå‰ä¸€ç§ç±»åž‹çš„åŒºåˆ«æ˜¯ï¼Œéœ€è¦æ±‚æŸä¸€ç‚¹â€œçœŸæ­£çš„â€å‰ç¼€å’Œã€‚è€ƒè™‘å‰ä¸€ç§æ–¹æ³•ï¼ŒåªçŸ¥é“è¯¥ç‚¹æœ¬èº«ä¸Žå‰é¢æ‰€æœ‰å˜åŒ–é‡çš„æ€»å’Œï¼Œå´ä¸çŸ¥é“è¿™äº›å˜åŒ–æ˜¯ä»Žå“ªé‡Œå¼€å§‹çš„ï¼Œæ— æ³•æ–¹ä¾¿åœ°æ±‚å‡ºå‰ç¼€å’Œã€‚æˆ‘ä»¬å…ˆå‡è®¾è¿™ä¸ªç‚¹ä¹‹å‰æ‰€æœ‰æ•°éƒ½ä¸Žè¿™ä¸ªç‚¹ç›¸ç­‰ï¼Œè¿™æ ·å¿…ç„¶ä¼šå¤šå‡ºå‰é¢çš„ä¸€äº›å˜åŒ–å€¼å˜åŒ–é•¿åº¦è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬å†ç”¨ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œå…¶ä¸­åœ¨æ¯ä¸€ä¸ªå˜åŒ–ç‚¹è®°å½•å˜åŒ–å€¼å˜åŒ–é•¿åº¦ï¼Œé‚£ä¹ˆæœ€ç»ˆç®—æŸä¸ªç‚¹çš„å’Œï¼Œåªéœ€è¦å†å‡åŽ»è¿™ä¸ªæ ‘çŠ¶æ•°ç»„çš„åœ¨è¯¥ç‚¹çš„å€¼ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š12345678910111213141516171819202122232425262728293031323334353637int A[],B[]; //ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„void tadd(int a[],int x,int c)&#123; while(x&lt;=N) &#123; a[x] += c; x += lowbit(x); &#125; return;&#125;int tread(int a[],int x)&#123; int sum=0; while(x&gt;0) &#123; sum += a[x]; x -= lowbit(x); &#125; return sum;&#125;void update(int a,int b,int c)&#123; tadd(A,a,c); tadd(A,b+1,-c); tadd(B,a,c*(a-1)); //å åŠ å‰ç¼€å˜åŒ–é‡ tadd(B,b+1,-c*b); return;&#125;int querry(int a,int b)&#123; int sum1=tread(A,a-1)*(a-1)-tread(B,a-1); int sum2=tread(A,b)*b-tread(B,b); return sum2-sum1;&#125; æ¨¡åž‹4ï¼šå¤šç»´æ ‘çŠ¶æ•°ç»„ï¼ˆä»¥äºŒç»´ä¸ºä¾‹ï¼‰å¤šç»´æ ‘çŠ¶æ•°ç»„åªéœ€æŠŠå¤šç»´çš„æ¯ä¸€ç»´åº¦åˆ†åˆ«å½“ä½œä¸€ç»´æ ‘çŠ¶æ•°ç»„å³å¯ï¼Œé‚£ä¹ˆNç»´çš„æŸä¸€ç‚¹çš„å‰ç¼€å’Œï¼Œå…¶å®žå°±æ˜¯ï¼Œå„ä¸ªç»´åº¦çš„å‰ç¼€å’Œåˆ†åˆ«æ˜ å°„åˆ°å…¶ä»–ç»´åº¦çš„å‰ç¼€å’Œæ‰€ä»¥è¿™é‡Œç»™å‡ºäºŒç»´æ ‘çŠ¶æ•°ç»„çš„ä»£ç å®žçŽ°ï¼Œå…·ä½“å¯ä»¥è§ä¸‹é¢çš„ä¾‹é¢˜POJ1195ï¼š12345678910111213141516void tadd(int i,int j,int c)&#123; for(int x=i;x&lt;=N;x+=lowbit(x)) for(int y=j;y&lt;=N;y+=lowbit(y)) //ä¸€å®šè¦æ³¨æ„è¿™é‡Œä¸èƒ½å†ç›´æŽ¥ç”¨ä¼ å…¥çš„å½¢å‚jäº†ï¼Œå› ä¸ºæ¯æ¬¡å¾ªçŽ¯éƒ½è¦ä½¿ä¹‹æˆä¸ºåˆšä¼ å…¥çš„å€¼ base[x][y]+=c; return;&#125;int tread(int i,int j)&#123; int sum=0; for(int x=i;x&gt;0;x-=lowbit(x)) for(int y=j;y&gt;0;y-=lowbit(y)) sum+=base[x][y]; return sum;&#125; æ³¨æ„æç¤º1.æ ‘çŠ¶æ•°ç»„ä¸­ä¸€å®šä¸èƒ½æœ‰0å…ƒï¼Œå¦‚æžœé¢˜ç›®ä¸­æœ‰è¦æ³¨æ„å¤„ç†ã€‚é€šå¸¸æ˜¯æ•´ä½“æ•°æ®åŠ 1ï¼Œè¿™æ ·åŽåŒæ—¶ä¹Ÿè¦æ³¨æ„å˜åŒ–åŽçš„æ•°æ®ä¸Šé™2.æ ‘çŠ¶æ•°ç»„å¯ä»¥ç”¨æ¥æ±‚é€†åºæ•°ï¼Œå®žçŽ°æ–¹æ³•ä½¿è®©æ•°å­—æˆä¸ºæ ‘çŠ¶æ•°ç»„çš„å…ƒç´ ï¼Œæ¯”æŸä¸ªæ•°å°çš„æ•°æœ‰å¤šå°‘å°±æ˜¯è¿™ä¸ªæ•°åœ¨æ•°ç»„ä¸­çš„å‰ç¼€å’Œ]]></content>
      <categories>
        <category>æ•°æ®ç»“æž„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æž„</tag>
        <tag>ACM</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++å€¼ä¼ é€’ã€å¼•ç”¨ä¼ é€’ã€æŒ‡é’ˆä¼ é€’åŒºåˆ«]]></title>
    <url>%2F2016%2F07%2F14%2FC%2B%2B%E5%80%BC%E4%BC%A0%E9%80%92%E3%80%81%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E3%80%81%E6%8C%87%E9%92%88%E4%BC%A0%E9%80%92%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[åœ¨C/C++ä¸­ç»å¸¸ä¼šé‡åˆ°ä¼ å€¼é—®é¢˜ï¼Œæ€»ç»“ä¸€ä¸‹ä¼ å‚åŒºåˆ«ã€‚ ç®€ä»‹å€¼ä¼ é€’: å€¼ä¼ é€’ä»…ä¼ é€’äº†å®žå‚çš„æ‹·è´ï¼Œåœ¨ä¼ å‚æ—¶ä¼šåœ¨æ ˆåŒºå¼€è¾Ÿå†…å­˜ç©ºé—´å¹¶å°†å®žå‚å€¼æ‹·è´å…¶ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´å€¼ä¼ é€’çš„å½¢å‚ä»»ä½•æ—¶å€™éƒ½åªæ˜¯å®žå‚çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä»…æ”¹å˜äº†è¯¥å‡½æ•°æ ˆå†…çš„å±€éƒ¨å˜é‡å€¼ã€‚ å¼•ç”¨ä¼ é€’: å¼•ç”¨ä¼ é€’å®žé™…æ˜¯ä¸ºå®žå‚è®¾ç½®äº†åˆ«åï¼Œå…¶åœ¨æ ˆåŒºå¼€è¾Ÿå†…å­˜ç©ºé—´åŽå¹¶ä¸è¿›è¡Œæ‹·è´ï¼Œè€Œæ˜¯å­˜æ”¾å®žå‚çš„åœ°å€ï¼Œä»Žè€Œå¯¹å½¢å‚çš„æ“ä½œå®žé™…ä¸Šæ˜¯é€šè¿‡å¯¹å®žå‚çš„é—´æŽ¥å¯»å€æ¥å®žçŽ°ï¼Œæ“ä½œçš„æ˜¯å®žå‚ã€‚ æŒ‡é’ˆä¼ é€’: æŒ‡é’ˆä¼ é€’å…¶å®žæ˜¯ç‰¹æ®Šçš„å€¼ä¼ é€’ï¼ŒåŒºåˆ«æ˜¯å…¶ä¼ é€’çš„å€¼æ˜¯åœ°å€è€Œå€¼ä¼ é€’æ˜¯ä¼ é€’äº†å®žå‚çš„å€¼ã€‚æŒ‡é’ˆä¼ é€’æ—¶ä¼šåœ¨æ ˆåŒºå¼€è¾Ÿå†…å­˜ç©ºé—´å¹¶å­˜æ”¾æŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆæŒ‡å‘å®žå‚çš„åœ°å€ã€‚é€šè¿‡è¿™ä¸€æ–¹æ³•ï¼Œæ“ä½œæŒ‡é’ˆä¹Ÿå°±è¾¾åˆ°äº†æ“ä½œå®žå‚çš„æ•ˆæžœã€‚ è¯•éªŒæˆ‘ä»¬æ¥å°è¯•å¦‚ä¸‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536// å€¼ä¼ é€’void change1(int num) &#123; cout &lt;&lt; "(å€¼ä¼ é€’) å½¢å‚åœ°å€: " &lt;&lt; &amp;num &lt;&lt; endl; cout &lt;&lt; "(å€¼ä¼ é€’) æ”¹å˜å‰ , num = " &lt;&lt; num &lt;&lt; endl; num++;&#125;// å¼•ç”¨ä¼ é€’void change2(int &amp;num) &#123; cout &lt;&lt; "(å¼•ç”¨ä¼ é€’) å½¢å‚åœ°å€: " &lt;&lt; &amp;num &lt;&lt; endl; cout &lt;&lt; "(å¼•ç”¨ä¼ é€’) æ”¹å˜å‰, num = " &lt;&lt; num &lt;&lt; endl; num++;&#125;// æŒ‡é’ˆä¼ é€’void change3(int *num) &#123; cout &lt;&lt; "(æŒ‡é’ˆä¼ é€’) å½¢å‚åœ°å€: " &lt;&lt; num &lt;&lt; endl; cout &lt;&lt; "(æŒ‡é’ˆä¼ é€’) æ”¹å˜å‰, num = " &lt;&lt; *num &lt;&lt; endl; // æ³¨æ„åŒºåˆ†æŒ‡é’ˆåœ°å€è‡ªå¢žå’ŒæŒ‡é’ˆå€¼è‡ªå¢žçš„åŒºåˆ« (*num)++;&#125;int main(int argc, const char * argv[]) &#123; int num = 1; cout &lt;&lt; "å®žå‚çš„åœ°å€: " &lt;&lt; &amp;num &lt;&lt; endl; change1(num); cout &lt;&lt; "(å€¼ä¼ é€’) æ”¹å˜åŽ, num = " &lt;&lt; num &lt;&lt; endl &lt;&lt; endl; change2(num); cout &lt;&lt; "(å¼•ç”¨ä¼ é€’) æ”¹å˜åŽ, num = " &lt;&lt; num &lt;&lt; endl &lt;&lt; endl; change3(&amp;num); cout &lt;&lt; "(æŒ‡é’ˆä¼ é€’) æ”¹å˜åŽ, num = " &lt;&lt; num &lt;&lt; endl &lt;&lt; endl; return 0;&#125; è¿è¡ŒåŽç»“æžœä¸º: 123456789101112å®žå‚çš„åœ°å€: 0x7ffeefbff5ac(å€¼ä¼ é€’) å½¢å‚åœ°å€: 0x7ffeefbff54c(å€¼ä¼ é€’) æ”¹å˜å‰ , num = 1(å€¼ä¼ é€’) æ”¹å˜åŽ, num = 1(å¼•ç”¨ä¼ é€’) å½¢å‚åœ°å€: 0x7ffeefbff5ac(å¼•ç”¨ä¼ é€’) æ”¹å˜å‰, num = 1(å¼•ç”¨ä¼ é€’) æ”¹å˜åŽ, num = 2(æŒ‡é’ˆä¼ é€’) å½¢å‚åœ°å€: 0x7ffeefbff5ac(æŒ‡é’ˆä¼ é€’) æ”¹å˜å‰, num = 2(æŒ‡é’ˆä¼ é€’) æ”¹å˜åŽ, num = 3 é€šè¿‡å¯¹æ¯”ï¼Œæˆ‘ä»¬ä¸éš¾å‘çŽ°ï¼Œå¼•ç”¨ä¼ é€’å’ŒæŒ‡é’ˆä¼ é€’æ—¶å½¢å‚å­˜æ”¾çš„åœ°å€æ˜¯ç›¸åŒçš„ï¼Œè€Œå€¼ä¼ é€’åˆ™æ˜¯å¯¹å®žå‚è¿›è¡Œäº†æ‹·è´ã€‚é‚£ä¹ˆå¼•ç”¨å’ŒæŒ‡é’ˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æ¥è¿›ä¸€æ­¥è®¨è®ºã€‚ å¼•ç”¨ä¼ é€’å’ŒæŒ‡é’ˆä¼ é€’çš„åŒºåˆ«1. æ˜¯å¦å¯ç©º æˆ‘ä»¬å…ˆçœ‹å‡½æ•°åŽŸåž‹ä»¥åŠä¼ å…¥ç©ºåœ°å€çš„æƒ…å†µ: 12345void change2(int &amp;num); // å¼•ç”¨ä¼ é€’void change3(int *num) // æŒ‡é’ˆä¼ é€’change2(NULL); // æŠ¥é”™ï¼Œä¸èƒ½å¼•ç”¨ç©ºåœ°å€change3(NULL); // é€šè¿‡ï¼Œå¯ä»¥ä¼ å…¥ç©ºåœ°å€ å¯ä»¥çœ‹å‡ºï¼Œå¼•ç”¨å¿…é¡»å¯¹åº”ä¸€ä¸ªæœ‰æ•ˆçš„å†…å­˜åœ°å€ï¼Œå› ä¸ºå…¶æœ¬è´¨ä¸Šæ˜¯å®žå‚çš„åˆ«åï¼Œè€ŒæŒ‡é’ˆå¯ä»¥æŒ‡å‘ä¸€ä¸ªç©ºåœ°å€ï¼Œå› ä¸ºå…¶æœ¬è´¨ä¸Šæ˜¯å¯ä»¥æŒ‡å‘æŸåœ°å€çš„æŒ‡é’ˆã€‚ 2. æ˜¯å¦ä¸ºå®žä½“ æˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‡é’ˆå®žé™…ä¸Šä¹Ÿæ˜¯ä¸€ç§ç±»åž‹ï¼Œå…¶æŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå…¶ä¸Žç›®æ ‡å˜é‡ä¹‹é—´å¹¶æ— å…³ç³»ã€‚è€Œå¼•ç”¨å®žé™…ä¸Šæ˜¯ä½œä¸ºå˜é‡åˆ«åæ¥å­˜åœ¨ï¼Œå¹¶éžä¸€ä¸ªç‹¬ç«‹çš„å®žä½“ã€‚ åœ¨ä½¿ç”¨æ—¶ï¼Œå¼•ç”¨ä¸èƒ½æ”¹å˜å…¶å¼•ç”¨åœ°å€ï¼Œåªèƒ½æ”¹å˜ç›®æ ‡å˜é‡çš„å€¼ï¼Œè€ŒæŒ‡é’ˆå¯ä»¥æ”¹å˜åœ°å€å’Œè¢«æŒ‡å‘å˜é‡çš„å€¼ï¼Œè¿™ä¸€ç‚¹æ˜¾ç¤ºäº†åŽè€…æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®žä½“ã€‚ 3. sizeof æˆ‘ä»¬çŸ¥é“sizeofç”¨æ¥è®¡ç®—å˜é‡å¤§å°ï¼Œå½“æˆ‘ä»¬å¯¹å¼•ç”¨å–sizeofæ—¶ï¼Œå¾—åˆ°çš„æ˜¯å…¶å¼•ç”¨å˜é‡çš„å¤§å°ï¼Œè€Œå¯¹æŒ‡é’ˆä½¿ç”¨sizeofï¼Œå¾—åˆ°çš„åªæ˜¯æŒ‡é’ˆå˜é‡çš„å¤§å°ï¼Œä¸Žè¢«æŒ‡å‘å˜é‡æ— å…³ã€‚ 4. ç¼–è¯‘æ—¶çš„åŒºåˆ« åœ¨ç¼–è¯‘æ—¶ï¼Œå¼•ç”¨å’ŒæŒ‡é’ˆåœ¨ç¬¦å·è¡¨çš„å¤„ç†ä¸ŠåŒæ ·æœ‰åŒºåˆ«ï¼Œä½“çŽ°åœ¨ç¬¦å·è¡¨å˜é‡åå’Œå˜é‡åœ°å€ä¸Šã€‚ å¼•ç”¨çš„åœ°å€æ˜¯ç›®æ ‡å˜é‡çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´å¼•ç”¨å¹¶éžä»¥ä¸€ä¸ªç‹¬ç«‹å®žä½“æ¥å­˜åœ¨ã€‚è€ŒæŒ‡é’ˆçš„åœ°å€æ˜¯è¿™ä¸ªæŒ‡é’ˆç±»åž‹å˜é‡çš„åœ°å€ï¼Œç›®æ ‡å˜é‡çš„åœ°å€åªæ˜¯å­˜åœ¨äºŽæŒ‡é’ˆå˜é‡å†…éƒ¨ï¼Œå¹¶æ²¡æœ‰åœ¨è¯¥æŒ‡é’ˆç¬¦å·è¡¨ä¸­å­˜åœ¨ã€‚ ç”±äºŽç¬¦å·è¡¨ä¸å¯å˜ï¼Œæ‰€ä»¥ä¸éš¾çœ‹å‡ºï¼Œå¼•ç”¨å¹¶ä¸èƒ½æ”¹å˜å…¶ç›®æ ‡å˜é‡ï¼Œè€ŒæŒ‡é’ˆå¯ä»¥ä»»æ„æ”¹å˜å…¶æŒ‡å‘çš„åœ°å€ã€‚]]></content>
      <categories>
        <category>æ•°æ®ç»“æž„</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç»“æž„</tag>
        <tag>ç¼–è¯‘åŽŸç†</tag>
        <tag>ACM</tag>
      </tags>
  </entry>
</search>
